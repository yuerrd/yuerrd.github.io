{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"YR-Notes","text":""},{"location":"#_1","title":"\u9879\u76ee\u8d44\u6e90\u63a8\u8350","text":"\u9879\u76ee\u540d\u79f0 Github \u63cf\u8ff0 Logi-KafkaManager https://github.com/didi/Logi-KafkaManager.git kafka\u7ba1\u7406 wayne https://github.com/Qihoo360/wayne.git K8S\u7ba1\u7406\u5e73\u53f0 jetlinks-community https://github.com/jetlinks/jetlinks-community.git \u7269\u8054\u7f51\u5f00\u6e90\u5e73\u53f0 hello-algorithm https://github.com/geekxh/hello-algorithm.git \u5c0f\u6d69\u7b97\u6cd5 \u4e9a\u9a6c\u900aAndroid-SDK https://github.com/aws-amplify/aws-sdk-android MQTT \u5ba2\u6237\u7aef \u91d1\u878d\u7ea7\u4e91\u539f\u751f\u67b6\u6784 https://github.com/sofastack \u91d1\u878d\u3001\u5206\u5e03\u5f0f Redis\u4ee3\u7406 https://github.com/twitter/twemproxyhttps://github.com/joyieldInc/predixy.git Twitterprdixy"},{"location":"#_2","title":"\u5e38\u7528\u8d44\u6599","text":"\u8d44\u6599\u540d\u79f0 \u5730\u5740 \u63cf\u8ff0 java \u5b98\u65b9\u6587\u6863 https://docs.oracle.com/javase/specs/index.html java\uff0cjvm MQTT https://docs.emqx.net/broker/latest/cn/development/protocol.html EMQ\u534f\u8bae\u4ecb\u7ecd Reactor\u6a21\u578b http://gee.cs.oswego.edu/dl/cpjslides/nio.pdf Doug Lea"},{"location":"ai/basic-math/","title":"\u57fa\u7840\u6570\u5b66","text":""},{"location":"ai/basic-math/#_2","title":"\u4e00\u3001\u5fae\u79ef\u5206","text":""},{"location":"ai/basic-math/#_3","title":"\u5bfc\u6570","text":"<p>\u5b9a\u4e49: \u5bfc\u51fd\u6570\u503c\uff0c\u5fae\u5546\u3002</p> <p>\u8bb0\u4f5c: \\(f^\u2018(x_0) \u6216 \\frac{df(x_0)}{dx} \u6216 \\frac{dy}{dx}\\)</p> <p>\u4f5c\u7528\uff1a\u6c42\u6781\u503c</p>"},{"location":"ai/basic-math/#_4","title":"\u5de6\u53f3\u5bfc\u6570\u4e0e\u53ef\u5bfc\u51fd\u6570","text":""},{"location":"ai/basic-math/#_5","title":"\u795e\u7ecf\u7f51\u7edc\u6fc0\u6d3b\u51fd\u6570","text":"<ul> <li>Sigmoid\u6fc0\u6d3b\u51fd\u6570</li> </ul> <p>\\(\\sigma = \\frac{1}{1+e^{-x}}\\)</p> <ul> <li>Tanh\u6fc0\u6d3b\u51fd\u6570</li> </ul> <p>\\(tanh(x) = 2\\sigma(2x)-1\\)</p> <ul> <li>Softmax \u6fc0\u6d3b\u51fd\u6570</li> </ul> <p>Softmax \u51fd\u6570\u5c06\u591a\u4e2a\u6807\u91cf\u6620\u5c04\u4e3a\u4e00\u4e2a\u6982\u7387\u5206\u5e03</p> <p>\\(y_i=softmax(z_i)=\\frac{e^{z_i}}{\\sum_{j=1}^Ce^{zj}}\\)</p> <p>\\(y_i\\)\u8868\u793a\u7b2ci\u4e2a\u8f93\u51fa\u503c\uff0c\u5373\u5c5e\u4e8e\u7c7b\u522bi\u7684\u6982\u7387 \\(\\sum_{j=1}^Cy_i=1\\)</p> <p>\\(z=W^tx\\) \u8868\u793a\u7ebf\u6027\u65b9\u7a0b\uff0cSoftmax\u51fd\u6570\u7528\u4e8e\u591a\u5206\u7c7b</p>"},{"location":"ai/basic-math/#_6","title":"\u6cf0\u52d2\u51fd\u6570","text":"<p>\u51fd\u6570f(x) \u5728\\(x_o\\)\u7684\u67d0\u4e2a\u5f00\u533a\u95f4(a,b)\u4e0a\u5177\u6709(n+1)\u9636\u5bfc\u6570\uff0c\u90a3\u4e48\u5bf9\u4e8e\u4efb\u610f \\(x\\in(a,b)\\)</p> <p>\u67d0\u4e00\u70b9\u7684\u5404\u9636\u5bfc\u6570\u503c\u505a\u7cfb\u6570\uff0c\u6784\u5efa\u4e00\u4e2a\u591a\u9879\u5f0f\u6765\u8fd1\u4f3c\u8868\u8fbe\u8fd9\u4e2a\u51fd\u6570</p> <ul> <li>\u4e00\u9636\u6cf0\u52d2\u516c\u5f0f</li> </ul> <p>\\(f(x+\u2206x)\\approx   \\frac{f(x)}{0!} + \\frac{f^\u2018(x)}{1!}\u2206x\\)</p> <ul> <li>\u4e8c\u9636\u6cf0\u52d2\u516c\u5f0f</li> </ul> <p>\\(f(x+\u2206x)\\approx   \\frac{f(x)}{0!} + \\frac{f^\u2018(x)}{1!}\u2206x  + \\frac{f^{\u2018\u2018}(x)}{2!}\u2206x^2\\)</p>"},{"location":"ai/basic-math/#_7","title":"\u4e8c\u3001\u7ebf\u6027\u4ee3\u6570","text":"<ol> <li> <p>\u03bb(\u03bcA) =   \u03bb\u03bc(A)</p> </li> <li>(\u03bb +\u03bc)A = \u03bb A + \u03bcA , \u03bb(A+B) =  \u03bbA + \u03bbB</li> <li>AB = BA</li> <li>(A+B)C = AC+BC</li> <li> <p>(\u03bbA).B = \u03bb(AB)</p> </li> <li> </li> </ol> <p>\u8303\u6570\u7684\u516c\u5f0f\u662f\u5411\u91cf\u6bcf\u4e2a\u5206\u91cf\u7edd\u5bf9\u503c\u7684P\u6b21\u65b9\uff0c\u5728\u7528\u5e42\u51fd\u6570\u8ba1\u7b97P\u5206\u4e4b\u4e00\uff0cP\u662f\u6574\u6570 1\uff0c2\uff0c3\uff0c\u3002\u3002\u3002\u221e</p> <p>\u5411\u91cf\u7684\u8303\u6570\u5c31\u662f\u628a\u5411\u91cf\u53d8\u6210\u4e00\u4e2a\u6807\u91cf\uff0c \u8303\u6570\u7684\u8868\u793a\u5c31\u662f\u4e24\u4e2a\u7ad6\u7ebf\u8868\u793a\uff0c\u8ba9\u540e\u53f3\u4e0b\u89d2\u5199\u4e0aP</p> <ul> <li> <p>\u8303\u6570(\u66fc\u54c8\u987f\u8ddd\u79bb)       \\(\\lVert A \\lVert_1=\\sum_{i=1}^n\\lvert x_i\\lvert\\) </p> <p>\u5411\u91cf\u5143\u7d20\u7edd\u5bf9\u503c\u4e4b\u548c \u8868\u793aX\u5230\u96f6\u70b9\u7684\u66fc\u54c8\u987f\u8ddd\u79bb</p> </li> <li> <p>2\u8303\u6570(\u6b27\u5f0f\u8ddd\u79bb) \\(\\lVert A \\lVert_2= \\sqrt{\\sum_{i=1}^n x_i^2}\\) </p> <p>\u5411\u91cf\u5143\u7d20\u7684\u5e73\u65b9\u5728\u5f00\u65b9\uff0c\u6b27\u51e0\u91cc\u5f97\u8303\u6570 \uff0c\u5e38\u8ba1\u7b97\u5411\u91cf\u957f\u5ea6\uff0c\u8868\u793aX\u5230\u96f6\u70b9\u7684\u6b27\u5f0f\u8ddd\u79bb</p> </li> <li> <p>P\u8303\u6570 \\(\\lVert A \\lVert_P=\\left[ \\sum_{i=1}^n\\lvert x_i\\lvert ^p\\right]^{\\frac{1}{p}}\\)</p> <p>\u5411\u91cf\u5143\u7d20\u7edd\u5bf9\u503c\u7684P\u6b21\u65b9\u548c\\({\\frac{1}{p}}\\)\u6b21\u5e42\uff0c\u8868\u793aX\u5230\u96f6\u70b9\u7684P\u9636\u95f5\u6c0f\u8ddd\u79bb</p> </li> <li> <p>\u221e\u8303\u6570 \\(\\lVert A \\lVert _\u221e=max_i\\lvert x_i \\lvert\\)</p> <p>\u5f53P\u8d8b\u5411\u4e8e\u6b63\u65e0\u7a77\u65f6\uff0c\u6240\u6709\u5411\u91cf\u5143\u7d20\u7edd\u5bf9\u503c\u4e2d\u7684\u6700\u5927\u503c\uff0c\u8868\u793a\u5207\u6bd4\u96ea\u592b\u8ddd\u79bb</p> </li> <li> </li> <li> <p>0\u5411\u91cf</p> <p>[0,0,0,0,0]</p> </li> <li> <p>\u5355\u4f4d\u5411\u91cf</p> <p>2\u8303\u6570\u4e3a1 \u6a21\u4e3a1\uff0c\u957f\u5ea6\u4e3a1\u7684\u5411\u91cf</p> <p>\u5411\u91cf \\(\\overrightarrow{AB}\\)\u7684\u957f\u5ea6\u53eb\u505a\u5411\u91cf\u7684\u6a21\uff0c\u8bb0\u4f5c \\(\\lvert\\overrightarrow{AB}\\lvert\\)</p> <p>\u8ba1\u7b97\u516c\u5f0f:(x,y) \u6a21\u957f \\(\\sqrt{x^2+y^2}\\)</p> </li> <li> </li> <li> <p>\u65b9\u9635 m=n</p> <p>\\(A=\\begin{bmatrix} 1 &amp; 2 &amp; 3 \\\\ 3 &amp; 4 &amp;5 \\\\ 3 &amp; 4 &amp;5 \\\\ \\end{bmatrix}\\)</p> </li> <li> <p>\u5bf9\u79f0\u77e9\u9635 \\(a_{ij}=a_{ji}\\)</p> <p>\\(A=\\begin{bmatrix} 1 &amp; 2 &amp; 3 \\\\ 2 &amp; 4 &amp;5 \\\\ 3 &amp; 5 &amp;7 \\\\ \\end{bmatrix}\\)</p> </li> <li> <p>\u5355\u4f4d\u77e9\u9635 \u5bf9\u89d2\u7ebf\u90fd\u662f1,\u5176\u4ed6\u4f4d\u7f6e\u662f0\uff0c\u5355\u4f4d\u77e9\u9635\u5199\u4f5c\u4e3a\\(I\\)\u7b49\u540c\u4e8e\u6570\u5b571</p> <p>\\(A= \\begin{bmatrix} 1 &amp; 0 &amp; 0 \\\\ 0 &amp; 1 &amp;0 \\\\ 0 &amp; 0 &amp;1 \\\\ \\end{bmatrix}\\)</p> </li> <li> <p>\u5bf9\u89d2\u77e9\u9635\uff0c\u4e3b\u5bf9\u89d2\u7ebf\u975e0\uff0c\u5176\u4ed6\u4f4d\u7f6e\u662f0</p> <p>\\(A= \\begin{bmatrix} \u03bb_1 &amp; 0 &amp; 0 \\\\ 0 &amp; \u03bb_2 &amp;0 \\\\ 0 &amp; 0 &amp; \u03bb_3 \\\\ \\end{bmatrix}\\)</p> </li> <li> </li> <li> <p>A+B+C =  (A+B)+C</p> </li> <li>(AB)C = A(BC)</li> <li>(A+B)C = AC+BC</li> <li>AB \u2260 BA</li> <li> <p>\\((AB)^T=A^TB^T\\)</p> </li> <li> </li> <li> <p>\u5b9a\u4e49</p> <p>\\(AB=I \u6216\u8005 BA=I\\)</p> <p>\\(A=B^{-1}\\)</p> <p>\\(B=A^{-1}\\)</p> <p>A\u7684\u9006\u77e9\u9635 \\(A^{-1}\\)</p> <p>\\(AA^{-1}=I=1\\)</p> </li> <li> <p>\u4f5c\u7528\u53ca\u516c\u5f0f</p> <p>\\(XW=Y\\) \\(X^{-1}XW=X^{-1}Y\\)</p> <p>\\(IW=X^{-1}Y\\)</p> <p>\\(W=X^{-1}Y\\)</p> </li> <li> </li> </ul> <p>\u884c\u5217\u5f0f\u628a\u77e9\u9635\u53d8\u6210\u4e00\u4e2a\u6807\u91cf</p> <p>\\(\\begin{bmatrix} a_{11} &amp; a_{12} \\\\ a_{21} &amp; a_{22}  \\\\  \\end{bmatrix} =a_{11}a_{22}-a_{12}a_{21}\\)</p> <p>\\(\\begin{bmatrix} a_{11} &amp; a_{12}&amp; a_{13} \\\\ a_{21} &amp; a_{22} &amp; a_{23} \\\\  a_{31} &amp; a_{32} &amp; a_{33} \\\\  \\end{bmatrix}\\) \\(=a_{11}a_{22}a_{33}+a_{12}a_{22}a_{31}+a_{13}a_{21}a_{32}-a_{13}a_{22}a_{31}-a_{13}a_{22}a_{31}-a_{12}a_{21}a_{33}-a_{11}a_{23}a_{32}\\)</p> <ol> <li> </li> <li> <p>\u4ee3\u6570\u4f59\u5b50\u5f0f  \\(A_{ij}=(-1)^{i+j}M_{ij}\\)</p> <p>\\(A= \\begin{bmatrix} a_{11} &amp; a_{12}&amp; a_{13} \\\\ a_{21} &amp; a_{22} &amp; a_{23} \\\\  a_{31} &amp; a_{32} &amp; a_{33} \\\\  \\end{bmatrix}\\)</p> <p>\\(A_{33}= \\begin{bmatrix} a_{11} &amp; a_{12}\\\\ a_{21} &amp; a_{22}  \\end{bmatrix}\\)</p> </li> <li> <p>\u4f34\u968f\u77e9\u9635</p> <p>\\(A= \\begin{bmatrix} a_{11} &amp; a_{12}&amp; a_{13} \\\\ a_{21} &amp; a_{22} &amp; a_{23} \\\\  a_{31} &amp; a_{32} &amp; a_{33} \\\\  \\end{bmatrix}\\)</p> <p>\\(A^*= \\begin{bmatrix} A_{11} &amp; A_{21}&amp; a_{31} \\\\ A_{12} &amp; A_{22} &amp; A_{32} \\\\  A_{13} &amp; A_{23} &amp; A_{33} \\\\  \\end{bmatrix}\\)</p> <p>\u4ee3\u6570\u4f59\u5b50\u5f0f\u7684\u884c\u5217\u5f0f\uff1a</p> <p>\\(A_{11}=a_{22}a_{33}-a_{23}a_{32}\\) </p> </li> <li> <p>\u4f34\u968f\u77e9\u9635\u7684\u6027\u8d28</p> <p>\\(AA^*=A^*A=|A|I\\)</p> </li> <li> <p>\u516c\u5f0f</p> <p>\\(AA^*=|A|AA^{-1}\\)</p> <p>\\(A^*=|A|A^{-1}\\)</p> <p>\\(A^{-1}=\\frac{A^*}{\\lvert A\\lvert}\\)</p> </li> <li> </li> <li> <p>\u5b9a\u4e49\uff1aA\u662f\u4f60\u9636\u65b9\u9635\uff0c\u5982\u679c\u5b58\u5728\u6570\u03bb\u548c\u975e\u96f6\u5e74\u4e3a\u5217\u5411\u91cf\u00b5,\u4f7f\u7684\\(A \\overrightarrow{v} = \u03bb\\overrightarrow{v}\\)\u6210\u7acb\uff0c\u5219\u79f0\u03bb\u5f0f\u77e9\u9635A\u7684\u4e00\u4e2a\u7279\u5f81\u503c\uff0c\\(\\overrightarrow{v}\\)\u662f\u7279\u5f81\u503c\u03bb\u7684\u7279\u5f81\u5411\u91cf</p> <p>\u5b9e\u5bf9\u79f0\u77e9\u9635\u7279\u5f81\u503c\u4e3a\u5b9e\u6570\uff0c\u975e\u5bf9\u79f0\u4e3e\u6b62\u548c\u590d\u77e9\u9635\u7279\u5f81\u503c\u53ef\u80fd\u4e3a\u590d\u6570</p> </li> <li> <p>\u6ee1\u79e9\u77e9\u9635\uff1a</p> <p>A\u662fn\u9636\u77e9\u9635\uff0c\u82e5r(A)= n \u5219\u79f0A\u4e3a\u6ee1\u79e9\u77e9\u9635,\u4f46\u6ee1\u79e9\u77e9\u9635\u4e0d\u9650\u4e8en\u9636\u77e9\u9635\uff0c\u82e5\u77e9\u9635\u7b49\u4e8e\u884c\u6570\uff0c\u79f0\u4e3a\u884c\u6ee1\u79e9\u3002\u82e5\u77e9\u9635\u7b49\u4e8e\u5217\u6570\uff0c\u79f0\u4e3a\u5217\u6ee1\u79e9\u3002\u65e2\u662f\u884c\u6ee1\u79e9\u53c8\u662f\u5217\u6ee1\u79e9\u5219\u4e3an\u9636\u77e9\u9635\u53can\u9636\u65b9\u9635</p> </li> <li> <p>\u793a\u4f8b</p> <p>\u6240\u6709\u7684\u7279\u5f81\u503c\u7684\u4e58\u79ef\u7b49\u4e8eA\u7684\u884c\u5217\u5f0f</p> <p>\\(\\prod_{i=1}^n\u03bb_i=\\lvert A\\lvert\\)</p> </li> <li> <p>\u7279\u5f81\u503c\u5206\u89e3</p> <p>\u7279\u5f81\u503c\u5206\u89e3\uff0c\u5c31\u662f\u5c06\u77e9\u9635A\u5206\u89e3\u4e3a\u5982\u4e0b\u5f0f\uff1a</p> <p>\\(A=Q\\sum Q^{-1}\\)</p> <p>\u5176\u4e2d\uff0cQ\u662f\u77e9\u9635A\u7684\u7279\u5f81\u5411\u91cf\u7ec4\u6210\u7684\u77e9\u9635\uff0c\\(\\sum\\)\u5219\u662f\u5bf9\u89d2\u9635\uff0c\u5bf9\u89d2\u7ebf\u4e0a\u7684\u5143\u7d20\u5c31\u662f\u7279\u5f81\u503c\u3002</p> <p>\\(\\sum= \\begin{bmatrix} \u03bb_1 &amp;  &amp;  \\\\  &amp; \u03bb_2 &amp; \\\\  &amp;  &amp; \u03bb_n \\\\ \\end{bmatrix}\\)</p> <p>\u5bf9\u79f0\u77e9\u9635\u90a3\u4e48Q\u662f\u6b63\u4ea4\u77e9\u9635(\u5217\u548c\u884c\u76f8\u7b49)\uff0c\u6b63\u4ea4\u77e9\u9635\u7684\u5b9a\u4e49Q\u7684\u9006\u7b49\u4e8eQ\u7684\u8f6c\u7f6e</p> <p>\\(Q^{-1}=Q^T\\)</p> <p>\u610f\u4e49\uff1a\u7279\u5f81\u503c\u7684\u5927\u5c0f\u8868\u793a\u8fd9\u4e2a\u7279\u5f81\u5230\u5e95\u6709\u591a\u91cd\u8981\uff0c\u63d0\u53d6\u8fd9\u4e2a\u77e9\u9635\u6700\u91cd\u8981\u7684\u7684\u7279\u5f81</p> </li> <li> </li> <li> </li> </ol>"},{"location":"ai/basic-math/#_8","title":"\u5411\u91cf\u8fd0\u7b97\u6cd5\u5219","text":""},{"location":"ai/basic-math/#_9","title":"\u5411\u91cf\u8303\u6570","text":""},{"location":"ai/basic-math/#_10","title":"\u7279\u6b8a\u5411\u91cf","text":""},{"location":"ai/basic-math/#_11","title":"\u5e38\u89c1\u77e9\u9635","text":""},{"location":"ai/basic-math/#_12","title":"\u77e9\u9635\u7684\u8fd0\u7b97\u6cd5\u5219","text":""},{"location":"ai/basic-math/#_13","title":"\u9006\u77e9\u9635","text":""},{"location":"ai/basic-math/#_14","title":"\u884c\u5217\u5f0f","text":""},{"location":"ai/basic-math/#_15","title":"\u4f34\u968f\u77e9\u9635","text":""},{"location":"ai/basic-math/#_16","title":"\u7279\u5f81\u503c\u4e0e\u7279\u5f81\u5411\u91cf","text":""},{"location":"ai/basic-math/#_17","title":"\u77e9\u9635\u7684\u5411\u91cf\u7684\u6c42\u5bfc\u516c\u5f0f","text":""},{"location":"ai/basic-math/#svd","title":"\u5947\u5f02\u503c\u5206\u89e3(SVD)","text":""},{"location":"ai/basic-math/#_18","title":"\u4e09\u3001\u591a\u5143\u51fd\u6570\u5fae\u79ef\u5206","text":""},{"location":"ai/basic-math/#_19","title":"\u504f\u5bfc\u6570","text":""},{"location":"ai/basic-math/#_20","title":"\u9ad8\u9636\u504f\u5bfc\u6570","text":""},{"location":"ai/basic-math/#_21","title":"\u68af\u5ea6","text":""},{"location":"ai/basic-math/#_22","title":"\u96c5\u53ef\u6bd4\u77e9\u9635","text":""},{"location":"ai/basic-math/#hessian","title":"Hessian\u77e9\u9635","text":""},{"location":"ai/basic-math/#_23","title":"\u4e8c\u6b21\u578b","text":""},{"location":"ai/basic-math/#_24","title":"\u56db\u3001\u6982\u7387\u8bba","text":""},{"location":"ai/basic-math/#_25","title":"\u968f\u673a\u4e8b\u4ef6","text":""},{"location":"ai/basic-math/#_26","title":"\u6761\u4ef6\u6982\u7387","text":""},{"location":"ai/basic-math/#_27","title":"\u968f\u673a\u53d8\u91cf","text":""},{"location":"ai/basic-math/#_28","title":"\u6570\u5b66\u671f\u671b\u4e0e\u65b9\u5dee","text":""},{"location":"ai/basic-math/#_29","title":"\u4e94\u3001\u6700\u4f18\u5316","text":""},{"location":"ai/basic-math/#_30","title":"\u6c42\u5bfc\u4e0e\u8fed\u4ee3\u6c42\u89e3","text":""},{"location":"ai/basic-math/#_31","title":"\u68af\u5ea6\u4e0b\u964d","text":"<p>\\(\\theta_n=\\theta_{n-1} -\\eta\\nabla f(\\theta_{n-1})\\) \u6b65\u957f: \\(\\eta\\) \u5bfc\u6570: \\(\\nabla f(\\theta_{n-1})\\)</p>"},{"location":"ai/basic-math/#_32","title":"\u725b\u987f\u6cd5","text":"<p>\\(x_n=x_{n-1}-\\frac {f(x_{n-1})}{f^\u2018(_{n-1})}\\)</p> <p>\u6700\u4f18\u5316\u516c\u5f0f\uff1a\\(x_{k+1}=x_{k}-H^{-1}_k*g_k\\)</p> <p>\\(g_k=f^\u2018(x_k)\\)</p> <p>\\(H_k=f^{\u2018\u2018}(x_k)\\)</p> <p></p> <ul> <li>\u9006\u725b\u987f\u6cd5</li> </ul> <p>\u5e38\u6709\u7b97\u6cd5\uff1aDFP,BFGS,L_BFGS</p>"},{"location":"ai/basic-math/#_33","title":"\u5750\u6807\u4e0b\u964d\u6cd5","text":""},{"location":"ai/basic-math/#_34","title":"\u6700\u4f18\u5316\u7b97\u6cd5\u74f6\u9888","text":"<ul> <li>\u5c40\u90e8\u503c\u95ee\u9898</li> <li>\u978d\u70b9\u95ee\u9898</li> </ul>"},{"location":"ai/computing-library/","title":"\u79d1\u5b66\u8ba1\u7b97\u5e93","text":""},{"location":"ai/computing-library/#1-numpy","title":"1. NumPy","text":"<p>##### 1. \u6570\u7ec4\u521b\u5efa</p> <pre><code>import numpy as np\n\nprint(np.ones(shape=10))\nprint(np.zeros(shape=10))\nprint(np.full(shape=10, fill_value=2))\nprint(np.random.randint(0, 100, size=10))\nprint(np.random.randn(10))  # \u6b63\u592a\u5206\uff0c\u5e03\u5e73\u5747\u503c0\uff0c\u6807\u51c6\u5dee1\nprint(np.linspace(1, 99, 50))  # \u7b49\u5dee\u6570\u5217\nprint(np.arange(start=0, stop=10, step=2))\nprint(np.logspace(1, 10, base=2, num=10))  # \u7b49\u6bd4\u6570\u5217\nprint(np.random.randint(0, 100, size=(3, 3)))  # \u4e8c\u7ef4\u6570\u7ec4\n</code></pre>"},{"location":"ai/computing-library/#2","title":"2. \u6570\u7ec4\u7684\u4fdd\u5b58\u8bfb\u53d6","text":"<ol> <li> <p>\u4fdd\u5b58</p> <pre><code>import numpy as np\n\nx = np.random.randn(5)\ny = np.arange(0,10,1) \n#save\u65b9\u6cd5\u53ef\u4ee5\u5b58\u4e00\u4e2a\nndarray np.save(\"x_arr\",x) \n#\u5982\u679c\u8981\u5b58\u591a\u4e2a\u6570\u7ec4\uff0c\u8981\u662f\u7528savez\u65b9\u6cd5\nnp.savez(\"some_array.npz\",xarr = x,yarr=y)\n</code></pre> </li> <li> <p>\u8bfb\u53d6</p> <pre><code>import numpy as np\n\nnp.load('x_arr.npy')  \n# \u901a\u8fc7key\u52a0\u8f7d\u4fdd\u5b58\u7684\u6570\u7ec4\u6570\u636e \nnp.load('some_array.npz')['yarr']\n</code></pre> </li> <li> <p>\u8bfb\u5199csv\u6587\u4ef6</p> <pre><code>import numpy as np\n\narr = np.random.randint(0, 10, size=(3, 3))\nnp.savetxt(\"arr.csv\", arr, delimiter=',')\nnp.loadtxt(\"arr.csv\", delimiter=',', dtype=np.int32)\n</code></pre> </li> <li> </li> <li> <p>\u52a0\u51cf\u4e58\u9664\u8fd0\u7b97</p> <pre><code>import numpy as np \n\narr1 = np.random.randint(0, 100, size=10)\narr2 = np.random.randint(0, 100, size=10)\narr1 - arr2 # \u51cf\u6cd5\narr1 * arr2 # \u4e58\u6cd5 \narr1 / arr2 # \u9664\u6cd5 \narr1**arr2  # \u5e42\u8fd0\u7b97\n</code></pre> </li> <li> <p>\u903b\u8f91\u8fd0\u7b97</p> <pre><code>import numpy as np \n\narr1 = np.array([1,2,3,4,5,6,7,8,9,10]) \narr2 = np.array([1,3,5,6,2,8,2,10,9,4]) \narr1 &lt; 10 \narr1 &gt;= 10 \narr1 == 10\narr1 == arr2 \narr1 &gt; arr2\n</code></pre> </li> <li> <p>*=\u3001+=\u3001-= \u64cd\u4f5c</p> <pre><code>import numpy as np \n\narr1 = np.arange(10) \narr1 +=10\narr1 -=10\narr1 *=10\n# arr1 /=10 \u4e0d\u652f\u6301\u8fd0\u7b97\n</code></pre> </li> <li> </li> </ol> <pre><code>import numpy as np \n\narr = np.array([0,1,2,3,4,5,6,7,8,9])\narr[2]   #\u7d22\u5f15 \u8f93\u51fa 2 \narr[1:4] #\u5207\u7247\u8f93\u51fa:array([1, 2, 3])\n\narr1 = np.array([[1,2,3],\n                 [4,5,6],\n                 [7,8,9]])\narr1[0,-1]  #\u7d22\u5f15 \u7b49\u4e8e3\narr1[:2,:2] \n#[[1 2]\n#    [4 5]]\n\n\narr1 = np.array([[1, 2, 3],\n                 [4, 5, 6],\n                 [7, 8, 9]])\n\nindex = np.ix_([0, 1], [0, 2])\narr1[index]\n#[[1 3]\n# [4 6]]\n</code></pre> <ol> <li> </li> <li> <p>reshape</p> <pre><code>import numpy as np\n\narr1 = np.random.randint(0, 100, size=(3, 4))\narr2 = arr1.reshape(4, 3)  # \u5f62\u72b6\u6539\u53d8\uff0c\u8fd4\u56de\u65b0\u6570\u7ec4\narr3 = arr1.reshape(-1, 6) # \u81ea\u52a8\u6574\u5f62\uff0c\u81ea\u52a8\u8ba1\u7b97\n</code></pre> </li> <li> <p>\u53e0\u52a0</p> <pre><code>import numpy as np\n\narr1 = np.array([[1, 2, 3]])\narr2 = np.array([[4, 5, 6]])\n\narr3 = np.concatenate([arr1, arr2], axis=0)  # \u884c\u5408\u5e76 \u9ed8\u8ba4\u503c\narr3 = np.vstack((arr1, arr2))\n\narr4 = np.concatenate([arr1, arr2], axis=1)  # \u5217\u5408\u5e76\narr4 = np.hstack((arr1, arr2))\n</code></pre> </li> <li> <p>\u62c6\u5206</p> <pre><code>import numpy as np\n\narr1 = np.random.randint(0, 10, size=(6, 5)) \narr2 = np.split(arr1, indices_or_sections=[2, 3], axis=0)  # \u884c\u7684\u62c6\u5206\narr2 = np.hsplit(arr1,indices_or_sections=[2, 3]) #\narr3 = np.split(arr1, indices_or_sections=[2, 3], axis=1)  # \u5217\u7684\u62c6\u5206\nnp.vsplit(arr,indices_or_sections=3)\n</code></pre> </li> <li> <p>\u8f6c\u7f6e</p> <pre><code>import numpy as np\n\narr1 = np.random.randint(0, 10, size=(3, 5))  # shape(3,5)\narr2 = arr1.T  # shape(5,3)\n\narr3 = np.random.randint(0, 10, size=(3, 4, 5))  # shape(3,4,5)\narr4 = np.transpose(arr3, axes=(2, 0, 1))  # shape(5,3,4)\n</code></pre> </li> <li> </li> </ol> <pre><code>import numpy as np\n\narr1 = np.random.randint(0, 10, size=(3, 5))  # shape(3,5)\narr2 = np.random.randint(0, 10, 5)\narr3 = arr1 + arr2 # \u5e7f\u64ad\n# \u6253\u5370\u7ed3\u679c\n#[[2 3 5 4 6]\n# [8 1 3 1 9]\n# [4 0 5 5 2]]\n#----------------------\n#[2 3 3 1 0]\n#----------------------\n#[[ 4  6  8  5  6]\n# [10  4  6  2  9]\n# [ 6  3  8  6  2]]\n\narr1 = np.random.randint(0, 10, size=(3, 5))  # shape(3,5)\narr2 = np.random.randint(0, 10, 3).reshape(3, 1)\narr3 = arr1 + arr2\n# \u6253\u5370\u7ed3\u679c\n#[[5 0 2 5 5]\n# [9 0 8 5 9]\n# [5 4 7 1 8]]\n#----------------------\n#[[9]\n# [6]\n# [7]]\n----------------------\n#[[14  9 11 14 14]\n# [15  6 14 11 15]\n# [12 11 14  8 15]]\n</code></pre>"},{"location":"ai/computing-library/#_2","title":"\u6570\u7ec4\u8fd0\u7b97","text":""},{"location":"ai/computing-library/#_3","title":"\u5207\u7247\u7d22\u5f15","text":""},{"location":"ai/computing-library/#_4","title":"\u6570\u636e\u5f62\u72b6\u6539\u53d8","text":""},{"location":"ai/computing-library/#_5","title":"\u5e7f\u64ad\u673a\u5236","text":""},{"location":"ai/computing-library/#2-pandas","title":"2. Pandas","text":""},{"location":"ai/computing-library/#_6","title":"\u6570\u636e\u7ed3\u6784","text":"<ul> <li>Series(\u4e00\u7ef4\u6570\u636e)</li> </ul> <pre><code>import pandas as pd\nimport numpy as np\n\ndata = np.arange(2, 10, 1)\n\ns1 = pd.Series(data=data)\ns2 = pd.Series(data=data, index=list('abcdefhi'))\ns3 = pd.Series(data={'a': 2, 'b': 3, 'c': 4})\n</code></pre> <ul> <li>DataFrame (\u4e8c\u7ef4\u6570\u636e)</li> </ul> <pre><code>import numpy as np\nimport pandas as pd\n\ndf = pd.DataFrame(data=np.random.randint(0, 100, size=(10, 2)),\n                  columns=['column1', 'column2'])\n</code></pre>"},{"location":"ai/computing-library/#_7","title":"\u6570\u636e\u7684\u5b58\u50a8","text":"<pre><code>import numpy as np\nimport pandas as pd\n\ndf = pd.DataFrame(data=np.random.randint(0, 100, size=(10, 2)),\n                  columns=['column1', 'column2'])\n# \u4fdd\u5b58\ndf.to_csv('./data.csv', header=True, index=True)\n# \u52a0\u8f7d\ndata = pd.read_csv('./data.csv', header=[0], index_col=0)\n</code></pre>"},{"location":"ai/computing-library/#_8","title":"\u6570\u636e\u6e05\u6d17","text":"<pre><code># 1\u3001\u91cd\u590d\u6570\u636e\u8fc7\u6ee4 \ndf.duplicated() # \u5224\u65ad\u662f\u5426\u5b58\u5728\u91cd\u590d\u6570\u636e \ndf.drop_duplicates() # \u5220\u9664\u91cd\u590d\u6570\u636e\n\n# 2\u3001\u7a7a\u6570\u636e\u8fc7\u6ee4 \ndf.isnull() # \u5224\u65ad\u662f\u5426\u5b58\u5728\u7a7a\u6570\u636e\uff0c\u5b58\u5728\u8fd4\u56deTrue\uff0c\u5426\u5219\u8fd4\u56deFalse \ndf.dropna(how = 'any') # \u5220\u9664\u7a7a\u6570\u636e \ndf.fillna(value=-1) # \u586b\u5145\u7a7a\u6570\u636e\n\n# 3\u3001\u6307\u5b9a\u884c\u6216\u8005\u5217\u8fc7\u6ee4 \ndel df['color'] # \u76f4\u63a5\u5220\u9664\u67d0\u5217 d\nf.drop(labels = ['price'],axis = 1)# \u5220\u9664\u6307\u5b9a\u5217 \ndf.drop(labels = [0,1,5],axis = 0) # \u5220\u9664\u6307\u5b9a\u884c\n</code></pre>"},{"location":"ai/computing-library/#3-matplotlib","title":"3. Matplotlib","text":"<ol> <li> <p>\u56fe\u50cf\u7ed8\u5236</p> <pre><code>import numpy as np\nimport matplotlib.pyplot as plt\n\n# \u56fe\u5f62\u7ed8\u5236\nx = np.linspace(0, 2 * np.pi)  # x\u8f74\ny = np.sin(x)  # y\u8f74\n\nplt.figure(figsize=(9, 6))  # \u8c03\u6574\u5c3a\u5bf8\nplt.plot(x, y)  # \u7ed8\u5236\u7ebf\u5f62\u56fe\nplt.show()\n</code></pre> </li> </ol>"},{"location":"ai/computing-library/#4","title":"4. \u591a\u5143\u7ebf\u6027\u65b9\u7a0b","text":"<ol> <li> <p>\u6b63\u89c4\u65b9\u7a0b</p> <p>\\(J(\u03b8)=\\frac{1}{2}\\sum_{i=0}^n(h_{\u03b8(x_i)}-y_i)^2\\)</p> <p>\\(J(\u03b8)=\\frac{1}{2}\\sum_{i=0}^n(h_{\u03b8(x_i)}-y_i)(h_{\u03b8(x_i)}-y_i)\\)</p> <p>\\(J(\u03b8)=\\frac{1}{2}(h\u03b8-y)^T(h\u03b8-y)\\)</p> <p>\\(W = (X^TX)^{-1}X^Ty\\) </p> <pre><code>w = np.linalg.inv(X.T.dot(X)).dot(X.T).dot(y)\n</code></pre> </li> <li></li> </ol>"},{"location":"ai/python-base/","title":"Python-Base","text":"<pre><code>a,b = 10,20\n#\u4ea4\u6362\na,b = b,a\n</code></pre> <ol> <li> <p>\u5217\u8868  []</p> <ul> <li>\u5207\u7247[\u5f00\u59cb\u4f4d\u7f6e:\u7ed3\u675f\u4f4d\u7f6e:\u6b65\u957f]</li> </ul> </li> <li>\u5b57\u5178 {\"name\":\"\u5f20\u4e09\"}  <ul> <li>zip([],[])</li> </ul> </li> <li>\u5143\u7ec4 ()  <ul> <li>('python',)</li> </ul> </li> <li> <p>\u96c6\u5408{1,2,3,4,4,6}</p> <ul> <li>\u4e0d\u80fd\u91cd\u590d</li> <li>set(rang(6))</li> <li>\u96c6\u5408\u5173\u7cfb</li> </ul> </li> <li> </li> <li> <p>\u9a7b\u7559\u673a\u5236(\u5171\u4eab\u5185\u5b58)</p> <ul> <li>\u5171\u4eab\u5185\u5b58</li> <li>\u7279\u6b8a\u5b57\u7b26\u6ca1\u6709\u9a7b\u7559</li> <li>[-5,256] \u6574\u6570\u6570\u5b57</li> </ul> </li> <li> <p>\u7279\u6b8a\u7684\u5b57\u7b26\u9a7b\u7559</p> </li> <li> </li> <li> <p>\u53ef\u53d8\u7684\u4f4d\u7f6e\u884c\u53c2</p> <pre><code>def fun(*args):\n  print(args)\nfun(1,2)\n</code></pre> </li> <li> <p>\u53ef\u53d8\u7684\u5173\u952e\u5b57\u884c\u53c2</p> <pre><code>def fun(**args):\n  print(args)\nfun(a=1,b=2)\n</code></pre> </li> <li> </li> </ol> <p>\u4fdd\u5b58\u751f\u4ea7\u5143\u7d20\u7684\u7b97\u6cd5\uff0c\u8bb0\u5f55\u6e38\u6807\u7684\u4f4d\u7f6e</p> <pre><code>g  = (x for x in range(10))\nnext(g)\n# \u901a\u8fc7\u51fd\u6570\u521b\u5efa\u751f\u6210\u5668\nyield b\n</code></pre> <ol> <li> </li> <li> </li> <li> </li> <li> </li> <li> </li> <li> </li> </ol> <p>###### \u4ee3\u7801\u793a\u4f8b</p> <pre><code># \u88c5\u9970\u5668\nfrom functools import wraps\ndef decor_a(fun):\n    @wraps(fun)\n    def decor_b():\n        print('I am decor_b')\n        fun()\n        print('I am fun')\n    return decor_b\n@decor_a\ndef decor_c():\n    print('I am decor_c')\n\ndecor_c()\n</code></pre> <ol> <li> </li> <li> <p>\u5c5e\u6027\u9650\u5236</p> <pre><code>__slots__ = [\"name\"]\n</code></pre> </li> <li> <p>\u679a\u4e3e\u7c7b</p> <pre><code>from enum import Enum Month = Enum('Month', ('Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'))\n</code></pre> </li> <li> <p>\u5143\u7c7b</p> <ul> <li> <p>type\u521b\u5efa\u4e00\u4e2aclass</p> <pre><code>type(name, bases, dict) \nname -- \u7c7b\u7684\u540d\u79f0\u3002 \nbases -- \u57fa\u7c7b\u7684\u5143\u7ec4\u3002\ndict -- \u5b57\u5178\uff0c\u7c7b\u5185\u5b9a\u4e49\u7684\u547d\u540d\u7a7a\u95f4\u53d8\u91cf\u3002\n</code></pre> <pre><code>if __name__ == '__main__':\n    def fn(self, name='world'):\n        print(f'Hello,{name}')\n\n    Hello = type('Hello', (object,), dict(hello=fn))\n    hello = Hello()\n    hello.hello()\n</code></pre> </li> <li> <p>metaclass\u521b\u5efa\u7c7b\u6a21\u7248</p> <pre><code>class HelloMetaclass(type):\n    def __new__(mcs, name, bases, attrs):\n        def fn(self, name='world'):\n            print(f'Hello,{name}')\n\n        attrs['hello'] = fn\n        return type.__new__(mcs, name, bases, attrs)\n\n\nif __name__ == '__main__':\n    class Hello(object, metaclass=HelloMetaclass):\n        pass\n\n\n    hello = Hello()\n    hello.hello()\n</code></pre> </li> </ul> </li> </ol>"},{"location":"ai/python-base/#_1","title":"\u8fd0\u7b97\u7b26","text":""},{"location":"ai/python-base/#_2","title":"\u6570\u636e\u7ed3\u6784","text":""},{"location":"ai/python-base/#_3","title":"\u5b57\u7b26\u4e32","text":""},{"location":"ai/python-base/#_4","title":"\u51fd\u6570","text":""},{"location":"ai/python-base/#_5","title":"\u751f\u6210\u5668","text":""},{"location":"ai/python-base/#_6","title":"\u9ad8\u9636\u51fd\u6570","text":""},{"location":"ai/python-base/#_7","title":"\u533f\u540d\u51fd\u6570","text":"<pre><code>lambda [list] : \u8868\u8fbe\u5f0f\n</code></pre> <p>###### \u53c2\u6570\u8be6\u89e3\uff1a</p> <pre><code>[list]:\u8868\u793a\u53c2\u6570\u5217\u8868\n\u8868\u8fbe\u5f0f :\u8ba1\u7b97\u903b\u8f91\n\u8fd4\u56de\u503c :\u8fd4\u56de\u51fd\u6570\u8ba1\u7b97\u7684\u7ed3\u679c \n</code></pre> <p>###### \u4ee3\u7801\u793a\u4f8b:</p> <pre><code>sum = lambda x,y : x+y\nprint(sum(1,2))\n</code></pre>"},{"location":"ai/python-base/#map","title":"map \u51fd\u6570","text":"<pre><code> map(func, *iterables) --&gt; map objec\n</code></pre> <p>###### \u53c2\u6570\u8be6\u89e3\uff1a</p> <pre><code>func: \u4f20\u5165\u53c2\u6570\u4e3a\u51fd\u6570\n*iterables: \u53ef\u8fed\u4ee3\u5bf9\u8c61 \n\u8fd4\u56de\u503c: \u8fd4\u56de\u51fd\u6570\u8ba1\u7b97\u7684\u7ed3\u679c \n</code></pre> <p>###### \u4ee3\u7801\u793a\u4f8b:</p> <pre><code>list1 = [1, 2, 3, 4, 5]\nprint(list(map(lambda x: x ** 2, list1)))\n</code></pre>"},{"location":"ai/python-base/#reduce","title":"reduce\u51fd\u6570","text":"<pre><code>from functools import reduce \nreduce(function, sequence[, initial]) -&gt; value\n</code></pre> <p>###### \u53c2\u6570\u8be6\u89e3:</p> <pre><code>function: \u4e24\u4e2a\u53c2\u6570\u7684\u51fd\u6570 \nsequence: \u53ef\u8fed\u4ee3\u5bf9\u8c61\ninitial: \u53ef\u9009\uff0c\u521d\u59cb\u53c2\u6570 \n\u8fd4\u56de\u503c:   \u8fd4\u56de\u51fd\u6570\u8ba1\u7b97\u7684\u7ed3\u679c \n</code></pre> <p>###### \u4ee3\u7801\u793a\u4f8b:</p> <pre><code>from functools import reduce\n\nlist1 = [1, 2, 3, 4, 5]\nprint(reduce(lambda x, y: x + y, list1))\n</code></pre>"},{"location":"ai/python-base/#filter","title":"filter\u51fd\u6570","text":"<pre><code>filter(function, iterable)\n</code></pre> <p>###### \u53c2\u6570\u8be6\u89e3:</p> <pre><code>function\uff1a\u5224\u65ad\u51fd\u6570\u3002\niterable\uff1a\u53ef\u8fed\u4ee3\u5bf9\u8c61\u3002 \n\u8fd4\u56de\u503c\uff1a\u8fd4\u56deTrue\u7684\u5143\u7d20\u65b0\u5217\u8868\u503c\n</code></pre> <p>###### \u4ee3\u7801\u793a\u4f8b:</p> <pre><code>def not_odd(num):\n  return num % 2 == 0\nnewlist = filter(not_odd, [1, 2, 3, 4, 5, 6, 7, 8, 9, 10])\nprint(list(newlist)) \n# \u8fd0\u7b97\u7ed3\u679c [2, 4, 6, 8, 10]\n</code></pre>"},{"location":"ai/python-base/#_8","title":"\u88c5\u9970\u5668","text":""},{"location":"ai/python-base/#_9","title":"\u7c7b\u4fe1\u606f","text":""},{"location":"algorithm/douglas-peucker/","title":"\u9053\u683c\u62c9\u65af-\u666e\u514b\u7b97\u6cd5(Douglas\u2013Peucker algorithm)","text":"<p>\u7b97\u6cd5\u63cf\u8ff0:</p> <p>(1\uff09\u5728\u66f2\u7ebf\u9996\u5c3e\u4e24\u70b9A\uff0cB\u4e4b\u95f4\u8fde\u63a5\u4e00\u6761\u76f4\u7ebfAB\uff0c\u8be5\u76f4\u7ebf\u4e3a\u66f2\u7ebf\u7684\u5f26\uff1b</p> <p>\uff082\uff09\u5f97\u5230\u66f2\u7ebf\u4e0a\u79bb\u8be5\u76f4\u7ebf\u6bb5\u8ddd\u79bb\u6700\u5927\u7684\u70b9C\uff0c\u8ba1\u7b97\u5176\u4e0eAB\u7684\u8ddd\u79bbd\uff1b</p> <p>\uff083\uff09\u6bd4\u8f83\u8be5\u8ddd\u79bb\u4e0e\u9884\u5148\u7ed9\u5b9a\u7684\u9608\u503cthreshold\u7684\u5927\u5c0f\uff0c\u5982\u679c\u5c0f\u4e8ethreshold\uff0c\u5219\u8be5\u76f4\u7ebf\u6bb5\u4f5c\u4e3a\u66f2\u7ebf\u7684\u8fd1\u4f3c\uff0c\u8be5\u6bb5\u66f2\u7ebf\u5904\u7406\u5b8c\u6bd5\u3002</p> <p>\uff084\uff09\u5982\u679c\u8ddd\u79bb\u5927\u4e8e\u9608\u503c\uff0c\u5219\u7528C\u5c06\u66f2\u7ebf\u5206\u4e3a\u4e24\u6bb5AC\u548cBC\uff0c\u5e76\u5206\u522b\u5bf9\u4e24\u6bb5\u53d6\u4fe1\u8fdb\u884c1~3\u7684\u5904\u7406\u3002</p> <p>\uff085\uff09\u5f53\u6240\u6709\u66f2\u7ebf\u90fd\u5904\u7406\u5b8c\u6bd5\u65f6\uff0c\u4f9d\u6b21\u8fde\u63a5\u5404\u4e2a\u5206\u5272\u70b9\u5f62\u6210\u7684\u6298\u7ebf\uff0c\u5373\u53ef\u4ee5\u4f5c\u4e3a\u66f2\u7ebf\u7684\u8fd1\u4f3c\u3002 \u4f7f\u7528\u7684\u7b97\u6cd5\u516c\u5f0f:\u6d77\u4f26\u516c\u5f0f</p> <p>\u4ee3\u7801\u53c2\u8003\u5730\u5740:https://rosettacode.org/wiki/Ramer-Douglas-Peucker_line_simplification</p>"},{"location":"algorithm/hyper-log-log/","title":"HyperLogLog","text":""},{"location":"algorithm/hyper-log-log/#_1","title":"\u4f2f\u52aa\u5229\u8bd5\u9a8c","text":"<p>\u200b       \u5047\u8bbe\u4e00\u76f4\u629b\u786c\u5e01\uff0c\u76f4\u5230\u5b83\u51fa\u73b0\u6b63\u9762\u4e3a\u6b62\uff0c\u6211\u4eec\u8bb0\u5f55\u4e3a\u4e00\u6b21\u5b8c\u6574\u7684\u8bd5\u9a8c\uff0c\u95f4\u4e2d\u53ef\u80fd\u629b\u4e86\u4e00\u6b21\u5c31\u51fa\u73b0\u4e86\u6b63\u9762\uff0c\u4e5f\u53ef\u80fd\u629b\u4e864\u6b21\u624d\u51fa\u73b0\u6b63\u9762\u3002\u65e0\u8bba\u629b\u4e86\u591a\u5c11\u6b21\uff0c\u53ea\u8981\u51fa\u73b0\u4e86\u6b63\u9762\uff0c\u5c31\u8bb0\u5f55\u4e3a\u4e00\u6b21\u8bd5\u9a8c\u3002\u8fd9\u4e2a\u8bd5\u9a8c\u5c31\u662f<code>\u4f2f\u52aa\u5229\u8bd5\u9a8c</code></p> \u8bd5\u9a8c\u6b21\u6570/n \u629b\u63b7\u6b21\u6570/k_max 1 3 2 2 3 6 n 12 <p>\u4f30\u7b97n\u7b49\u4e8e\u591a\u5c11\uff1a \\(n=2 ^ {k\\_max}\\)     $  n= 2 ^{12}$ </p> <p>\\(3 \\neq 2^6\\)   \u5f53\u8bd5\u9a8c\u6b21\u6570\u5f88\u5c0f\u7684\u65f6\u5019\uff0c\u8fd9\u79cd\u4f30\u7b97\u65b9\u6cd5\u7684\u8bef\u5dee\u662f\u5f88\u5927</p>"},{"location":"algorithm/hyper-log-log/#loglong-dv_ll-constant-m-2overliner","title":"\u4f30\u7b97\u7684\u4f18\u5316(LogLong) \\(DV_{LL} = constant * m * 2^\\overline{R}\\)","text":"<ul> <li> <p>\\(DV_{LL}\\) \u4ee3\u8868n</p> </li> <li> <p>constant \u4fee\u6b63\u56e0\u5b50</p> </li> <li> <p>m \u8bd5\u9a8c\u6b21\u6570</p> </li> <li> <p>R \u5e73\u5747\u6570    \\(\\frac{k\\_max\\_1+ \\cdots  + k\\_max\\_m}{m}\\)</p> </li> <li> <p>\u8c03\u548c\u5e73\u5747\u6570 \\(H_n=\\frac{1}{\\frac{1}{n}\\sum_{i=1}^{n}\\frac{1}{x_i}} = \\frac{n}{\\sum_{i=1}^{n}\\frac{1}{x_i}}\\)</p> <p>\\(H_n=\\frac{m}{\\frac{1}{k\\_max\\_1}+\\cdots+\\frac{1}{k\\_max\\_m}}\\)</p> </li> <li> <p>\u6bd4\u7279\u4e32</p> </li> <li> <p>\u901a\u8fc7hash\u51fd\u6570\u5c06\u6570\u636e\u8f6c\u6362\u4e3a64\u4e3a\u6bd4\u7279\u4e32</p> </li> <li> <p>0:\u4ee3\u8868\u53cd\u9762 1:\u4ee3\u8868\u6b63\u9762</p> <pre><code>1th  0111010110001000    3\n2th  0101000010000000    7\n3th  0001010010100000    5\n4th  1001010000000000    9\nnth  1001010000000000    k\n      k16=========&gt; n=?\n</code></pre> </li> <li> <p>\u5206\u6876</p> </li> <li> <p>\u5206\u7ec4  [\u7b2c0\u7ec4] [\u7b2c1\u7ec4] ....[\u7b2c16833\u7ec4]      [000 000] [000 000] .... [000 000]       \u5360\u7528\u5185\u5b58\u4e3a16834*6/8/1024 =12K</p> </li> <li> <p>\u9009\u540e14\u4f4d\u6765\u8868\u8fbe\u6876\u7684\u7f16\u53f7\\(\\(2^{14}=16384\\)\\)      \u5269\u4e0b50\u4f4d\u51fa\u73b01\u7684\u4f4d\u7f6e50 \u8f6c\u6362\u4e3a2\u8fdb\u5236\u4ed6\u662f110010 \u6bcf\u4e2a\u6876\u662f6bit</p> </li> <li> <p>\u5bf9\u5e94</p> </li> </ul> <p>\u5206\u6876: \u6bcf\u4e2a\u6bd4\u7279\u4e32\u524d\u591a\u5c11\u4f4d\u8f6c\u6362\u4e3a10\u8fdb\u5236\u540e\u5176\u503c\u5c31\u662f\u6876\u7684\u7f16\u53f7</p> <p>\u5b58\u50a8: \u5269\u4e0b\u7684\u6bd4\u7279\u4e32\u4ece\u4f4e\u4f4d\u5f80\u9ad8\u4f4d\u770b\u7b2c\u4e00\u6b21\u51fa\u73b01\u7684\u4f4d\u7f6e\u5c31\u662fk_max</p> <p>\u66f4\u65b0: 14\u4f4d\u7f6e\u662f\u4e00\u6837\u65f6,\u66f4\u65b0\u4e3a\u5927\u7684k_max</p>"},{"location":"algorithm/hyper-log-log/#hyperloglog_1","title":"HyperLogLog\u6b65\u9aa4","text":""},{"location":"algorithm/rsa/","title":"RSA\u52a0\u5bc6","text":""},{"location":"algorithm/rsa/#1","title":"1. \u9009\u62e9\u4e24\u4e2a\u8d28\u6570","text":"<pre><code>p=3 \uff0cq=11\n</code></pre>"},{"location":"algorithm/rsa/#2","title":"2.\u8ba1\u7b97","text":"<p>n =\uff08 p * q \uff09 <pre><code>n =  3 * 11\n</code></pre></p>"},{"location":"algorithm/rsa/#3","title":"3.\u8ba1\u7b97\u6b27\u62c9\u51fd\u6570","text":"<p>\u03c6(n) = ( p \u2212 1 )( q \u2212 1 ) <pre><code>\u03c6(n)  = ( 3 - 1 )( 11 -1 )\n\u03c6(n) = 20\n</code></pre></p>"},{"location":"algorithm/rsa/#4","title":"4.\u516c\u94a5","text":"<p>e 1 &lt; e &lt; \u03c6(n) \u4e14\uff08e, \u03c6(n) ) = 1 \u4e92\u8d28 <pre><code> 1 &lt; e  &lt; 20\n e = 3\n</code></pre></p>"},{"location":"algorithm/rsa/#5","title":"5.\u79c1\u94a5","text":"<p>d (e * d ) % m = 1 <pre><code> d = 7\n</code></pre></p>"},{"location":"algorithm/rsa/#6","title":"6.\u52a0\u5bc6\u7b97\u6cd5","text":"<p>m(\u660e\u6587)^e % n = c(\u5bc6\u6587) <pre><code>4^3 % 33 = 31\n</code></pre></p>"},{"location":"algorithm/rsa/#7","title":"7.\u89e3\u5bc6\u7b97\u6cd5","text":"<p>c(\u5bc6\u6587)^d % n = m(\u660e\u6587) <pre><code>31^7 % 33 = 4\n</code></pre></p>"},{"location":"command/git/","title":"Git","text":"<p>\u4fee\u6539commit\u6ce8\u91ca</p> <pre><code>git commit --amend\n</code></pre> <p>\u4fee\u6539\u6700\u540e\u4e00\u6b21commit\u7528\u6237\u540d\u548c\u90ae\u7bb1</p> <pre><code>git commit --amend --author=\"Author Name &lt;email@address.com&gt;\"\n</code></pre>"},{"location":"command/hbase/","title":"HBASE","text":"<pre><code># \u8fde\u63a5\nhbase shell\n\n# \u67e5\u770b\u6240\u6709\u8868\nlist\n\n# \u83b7\u53d6\u4e00\u4e2aid\u7684\u6240\u6709\u6570\u636er\nget 'member','rowKey'\n\n# \u83b7\u5f97\u4e00\u4e2aid\uff0c\u4e00\u4e2a\u5217\u7c07\uff08\u4e00\u4e2a\u5217\uff09\u4e2d\u7684\u6240\u6709\u6570\u636e\nget 'member', 'rowKey', 'famil'\n\n# \u67e5\u8be2\u6574\u8868\u6570\u636e\nscan 'member'\n\n# \u67e5\u770b\u8868\u7ed3\u6784\ndescribe 'member'\n\n# \u521b\u5efa\u8868\ncreate 'member', {NAME =&gt; 'base', VERSIONS =&gt; '3', BLOCKSIZE =&gt; '65536'}\n\n# \u8868\u4e2d\u6dfb\u52a0\u5217\u7c07\nalter 'member','base'\n\n# \u5220\u9664\u5217\u7c07\nalter 'member','delete'=&gt;'base'\n\n# \u6e05\u7a7a\u6570\u636e\ntruncate 'member'\n\n# \u5220\u9664\u8868\ndisable 'member'\ndrop    'member'\n</code></pre>"},{"location":"command/linux/","title":"Linux\u547d\u4ee4","text":""},{"location":"command/linux/#1python","title":"1.Python \u7b80\u5355\u547d\u4ee4","text":"<ol> <li>\u542f\u52a8\u4e00\u4e2a\u7b80\u5355\u670d\u52a1</li> </ol> <pre><code>python -m SimpleHTTPServer 18765\n</code></pre> <ol> <li>pm2\u542f\u52a8\u4e00\u4e2a\u670d\u52a1</li> </ol> <pre><code> pm2 start npm --name autopai-push -- run serve\n</code></pre>"},{"location":"command/linux/#2cpu","title":"2.\u67e5\u770bCPU\u53d8\u9ad8\u6392\u67e5","text":"<ol> <li>\u5148\u6267\u884ctop \uff0c\u627e\u5230CPU\u5360\u7528\u6bd4\u8f83\u9ad8\u7684\u8fdb\u7a0b</li> </ol> <pre><code>top\n</code></pre> <ol> <li>jistack  \u8fdb\u7a0bID  </li> </ol> <pre><code>jstack \u8fdb\u7a0bID  &gt;show.txt\n</code></pre> <ol> <li>\u627e\u5230\u7ecf\u5e38\u4e2dcpu\u5360\u7528\u6bd4\u8f83\u9ad8\u7684\u7ebf\u7a0b\uff0c\u7ebf\u7a0bId\u8f6c\u4e3a16\u8fdb\u5236</li> </ol> <pre><code>top  -p \u8fdb\u7a0bID - H  ## \u67e5\u770b\u8fdb\u7a0b\u4e2d\u7684\u7ebf\u7a0b\u60c5\u51b5\n</code></pre> <ol> <li>\u901a\u8fc7\u7ebf\u7a0bID\u67e5\u627e\u7ebf\u7a0b\u60c5\u51b5</li> </ol>"},{"location":"command/linux/#3","title":"3.\u6587\u4ef6","text":"<pre><code>lsof   #\u6253\u5f00\u7684\u6587\u4ef6\npcstat #\u7f13\u5b58\u4f7f\u7528\u60c5\u51b5\n</code></pre>"},{"location":"command/linux/#4","title":"4.\u53e5\u67c4","text":""},{"location":"command/linux/#_1","title":"\u5c40\u90e8\u6587\u4ef6\u53e5\u67c4\u9650\u5236","text":"<p>\u67e5\u770b</p> <pre><code>ulimit -n\nulimit -n 102400\n</code></pre> <p>\u4fee\u6539</p> <pre><code>sudo vim /etc/security/limits.conf\n\n#   \u5b9e\u9645\u7684\u9650\u5236\n*   hard nofile 102400\n#   \u8b66\u544a\u7684\u9650\u5236\n*   soft nofile 102400 \n</code></pre>"},{"location":"command/linux/#_2","title":"\u5168\u5c40\u6587\u4ef6\u53e5\u67c4\u9650\u5236","text":"<p>\u67e5\u770b</p> <pre><code>cat /proc/sys/fs/file-max\n</code></pre> <p>\u4e34\u65f6\u4fee\u6539</p> <pre><code>echo 1000000 &gt; /proc/sys/fs/file-max\n</code></pre> <p>\u4fee\u6539</p> <pre><code>suod vim /etc/sysctl.conf\nfs.file-max=1000000\nsudo sysctl -p\n</code></pre>"},{"location":"command/linux/#tcptime_wait","title":"TCP\u91ca\u653e\u65f6\u95f4\uff0c\u51cf\u5c0f\uff0c\u8c03\u4f4etime_wait\u72b6\u6001\u7aef\u53e3\u7b49\u5f85\u65f6\u95f4","text":"<pre><code># \u8c03\u4f4e\u7aef\u53e3\u91ca\u653e\u540e\u7684\u7b49\u5f85\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4e3a60s\uff0c\u4fee\u6539\u4e3a15~30s\nsysctl -w net.ipv4.tcp_fin_timeout=30\n# \u4fee\u6539tcp/ip\u534f\u8bae\u914d\u7f6e\uff0c\n# \u901a\u8fc7\u914d\u7f6e/proc/sys/net/ipv4/tcp_tw_resue, \u9ed8\u8ba4\u4e3a0\uff0c\u4fee\u6539\u4e3a1\uff0c\u91ca\u653eTIME_WAIT\u7aef\u53e3\u7ed9\u65b0\u8fde\u63a5\u4f7f\u7528\nsysctl -w net.ipv4.tcp_timestamps=1\n# \u4fee\u6539tcp/ip\u534f\u8bae\u914d\u7f6e\uff0c\u5feb\u901f\u56de\u6536socket\u8d44\u6e90\uff0c\u9ed8\u8ba4\u4e3a0\uff0c\u4fee\u6539\u4e3a1\nsysctl -w net.ipv4.tcp_tw_recycle=1\n# \u4fee\u6539\u53c2\u6570\uff1a\n$ vi /etc/sysctl.conf\n#\u00a0-----\u610f\u5473\u774010000~65000\u7aef\u53e3\u53ef\u7528\nnet.ipv4.ip_local_port_range = 10000 \u00a0 \u00a0 65000 \u00a0 \u00a0 \n</code></pre>"},{"location":"command/linux/#iptalbesnf_conntrack","title":"\u5b89\u88c5iptalbes\u4f1a\u4f7f\u7528nf_conntrack\u6a21\u5757\u8ddf\u8e2a\u8fde\u63a5","text":"<p>\u8ddf\u8e2a\u7684\u8fde\u63a5\u8d85\u8fc7\u8fd9\u4e2a\u6700\u5927\u503c\uff0c\u5c31\u4f1a\u5bfc\u81f4\u8fde\u63a5\u5931\u8d25</p> <pre><code># \u67e5\u770b\u6700\u5927\u503c\n# wc -l /proc/net/nf_conntrack\n# cat /proc/sys/net/nf_conntrack_max\n1024000\n# vi /etc/sysctl.conf\nnet.nf_conntrack_max = 2000500\n# or\nsysctl -w net.nf_conntrack_max=2000500\n</code></pre>"},{"location":"command/linux/#5sudo","title":"5.sudo \u514d\u5bc6","text":"<pre><code># \u8fdb\u5165root\u7528\u6237\n# \u6587\u4ef6\u6dfb\u52a0\u5199\u5165\u7684\u6743\u9650\nchmod u+w /etc/sudoers\nvim /etc/sudoers\nroot ALL=(ALL) ALL\ntest ALL=(ALL)  NOPASSWD:  ALL\n# \u6587\u4ef6\u7684\u5199\u5165\u5c5e\u6027\u53bb\u6389\nchmod u-w /etc/sudoers\n</code></pre>"},{"location":"command/linux/#6","title":"6.\u67e5\u627e\u5927\u6587\u4ef6","text":"<pre><code># \u67e5\u627e\u6587\u4ef6\nfind / -type f -size +800M  -print0 | xargs -0 du -h\n\n# \u67e5\u770b\u76ee\u5f55\u6587\u4ef6\u5927\u5c0f\ndu /* -sh\n\n# \u6587\u4ef6\u5927\u5c0f\u6392\u5e8f\ndu -h --max-depth=1 / |sort -hr\n</code></pre>"},{"location":"command/supervisor/","title":"Supervisor","text":""},{"location":"command/supervisor/#_1","title":"\u540d\u8bcd\u89e3\u91ca","text":"<p>supervisor\uff1a\u8981\u5b89\u88c5\u7684\u8f6f\u4ef6\u7684\u540d\u79f0\u3002 supervisord\uff1a\u88c5\u597dsupervisor\u8f6f\u4ef6\u540e\uff0csupervisord\u7528\u4e8e\u542f\u52a8supervisor\u670d\u52a1\u3002 supervisorctl\uff1a\u7528\u4e8e\u7ba1\u7406supervisor\u914d\u7f6e\u6587\u4ef6\u4e2dprogram\u3002</p>"},{"location":"command/supervisor/#_2","title":"\u5b89\u88c5","text":"<pre><code>yum install epel-release\nyum install -y supervisor\n# \u5f00\u673a\u81ea\u542f\u52a8\nsystemctl enable supervisord\n# \u542f\u52a8supervisord\u670d\u52a1\nsystemctl start supervisord \n# \u67e5\u770bsupervisord\u670d\u52a1\u72b6\u6001\nsystemctl status supervisord \n # \u67e5\u770b\u662f\u5426\u5b58\u5728supervisord\u8fdb\u7a0b\nps -ef|grep supervisord\n</code></pre>"},{"location":"command/supervisor/#_3","title":"\u5e38\u7528\u547d\u4ee4","text":"<pre><code>supervisorctl status \u67e5\u770b\u8fdb\u7a0b\u8fd0\u884c\u72b6\u6001\nsupervisorctl start \u8fdb\u7a0b\u540d \u542f\u52a8\u8fdb\u7a0b\nsupervisorctl stop \u8fdb\u7a0b\u540d \u5173\u95ed\u8fdb\u7a0b\nsupervisorctl restart \u8fdb\u7a0b\u540d \u91cd\u542f\u8fdb\u7a0b\nsupervisorctl update \u91cd\u65b0\u8f7d\u5165\u914d\u7f6e\u6587\u4ef6\nsupervisorctl shutdown \u5173\u95edsupervisord\nsupervisorctl clear \u8fdb\u7a0b\u540d \u6e05\u7a7a\u8fdb\u7a0b\u65e5\u5fd7\nsupervisorctl \u8fdb\u5165\u5230\u4ea4\u4e92\u6a21\u5f0f\u4e0b\u3002\u4f7f\u7528help\u67e5\u770b\u6240\u6709\u547d\u4ee4\u3002\nstart stop restart + all \u8868\u793a\u542f\u52a8\uff0c\u5173\u95ed\uff0c\u91cd\u542f\u6240\u6709\u8fdb\u7a0b\u3002\n</code></pre>"},{"location":"command/supervisor/#_4","title":"\u914d\u7f6e","text":"<p>\u914d\u7f6e\u6587\u4ef6\u8def\u5f84  /etc/supervisord.cof</p> <p>\u5b50\u8fdb\u7a0b\u914d\u7f6e\u6587\u4ef6\u8def\u5f84   /etc/supervisord.d</p> <ul> <li> <p>\u5b50\u8fdb\u7a0b\u914d\u7f6e\u6587\u4ef6\u63cf\u8ff0</p> <pre><code>#\u9879\u76ee\u540d\n[program:blog]\n#\u811a\u672c\u76ee\u5f55\ndirectory=/opt/bin\n#\u811a\u672c\u6267\u884c\u547d\u4ee4\ncommand=/usr/bin/python /opt/bin/test.py\n\n#supervisor\u542f\u52a8\u7684\u65f6\u5019\u662f\u5426\u968f\u7740\u540c\u65f6\u542f\u52a8\uff0c\u9ed8\u8ba4True\nautostart=true\n#\u5f53\u7a0b\u5e8fexit\u7684\u65f6\u5019\uff0c\u8fd9\u4e2aprogram\u4e0d\u4f1a\u81ea\u52a8\u91cd\u542f,\u9ed8\u8ba4unexpected\uff0c\u8bbe\u7f6e\u5b50\u8fdb\u7a0b\u6302\u6389\u540e\u81ea\u52a8\u91cd\u542f\u7684\u60c5\u51b5\uff0c\u6709\u4e09\u4e2a\u9009\u9879\uff0cfalse,unexpected\u548ctrue\u3002\u5982\u679c\u4e3afalse\u7684\u65f6\u5019\uff0c\u65e0\u8bba\u4ec0\u4e48\u60c5\u51b5\u4e0b\uff0c\u90fd\u4e0d\u4f1a\u88ab\u91cd\u65b0\u542f\u52a8\uff0c\u5982\u679c\u4e3aunexpected\uff0c\u53ea\u6709\u5f53\u8fdb\u7a0b\u7684\u9000\u51fa\u7801\u4e0d\u5728\u4e0b\u9762\u7684exitcodes\u91cc\u9762\u5b9a\u4e49\u7684\nautorestart=false\n#\u8fd9\u4e2a\u9009\u9879\u662f\u5b50\u8fdb\u7a0b\u542f\u52a8\u591a\u5c11\u79d2\u4e4b\u540e\uff0c\u6b64\u65f6\u72b6\u6001\u5982\u679c\u662frunning\uff0c\u5219\u6211\u4eec\u8ba4\u4e3a\u542f\u52a8\u6210\u529f\u4e86\u3002\u9ed8\u8ba4\u503c\u4e3a1\nstartsecs=30\n\n#\u811a\u672c\u8fd0\u884c\u7684\u7528\u6237\u8eab\u4efd \nuser = root\n\n#\u65e5\u5fd7\u8f93\u51fa \nstderr_logfile=/tmp/blog_stderr.log \nstdout_logfile=/tmp/blog_stdout.log \n#\u628astderr\u91cd\u5b9a\u5411\u5230stdout\uff0c\u9ed8\u8ba4 false\nredirect_stderr = true\n#stdout\u65e5\u5fd7\u6587\u4ef6\u5927\u5c0f\uff0c\u9ed8\u8ba4 50MB\nstdout_logfile_maxbytes = 20MB\n#stdout\u65e5\u5fd7\u6587\u4ef6\u5907\u4efd\u6570\nstdout_logfile_backups = 20\n</code></pre> </li> </ul>"},{"location":"command/wsl2/","title":"4.5WSL\u914d\u7f6e","text":""},{"location":"command/wsl2/#wsl2","title":"WSL2\u914d\u7f6e","text":""},{"location":"command/wsl2/#docker","title":"\u5b89\u88c5docker","text":"<pre><code># install docker\ncurl -fsSL get.docker.com -o get-docker.sh\nsh get-docker.sh\n\nif [ ! $(getent group docker) ];\nthen\nsudo groupadd docker;\nelse\necho \"docker user group already exists\"\nfi\n\nsudo gpasswd -a $USER docker\nsudo service docker restart\n\nrm -rf get-docker.sh#\n</code></pre>"},{"location":"command/wsl2/#zsh","title":"\u5b89\u88c5zsh","text":"<pre><code>sudo apt install zsh\n</code></pre> <p>ohmyzsh zsh-autosuggestions\u63d2\u4ef6</p> <pre><code>vim ~/.zshrc\n</code></pre> <p>\u6dfb\u52a0\u81ea\u52a8\u63d0\u793a\u63d2\u4ef6</p> <pre><code>plugins=(\ngit\nzsh-autosuggestions\n)\n</code></pre>"},{"location":"command/wsl2/#_1","title":"\u8bbe\u7f6e\u7f51\u7edc\u4ee3\u7406","text":"<pre><code>vim ~/.zshr\n</code></pre> <pre><code>export hostip=$(cat /etc/resolv.conf |grep -oP '(?&lt;=nameserver\\ ).*')\nalias setss='export https_proxy=\"http://${hostip}:10811\";export http_proxy=\"http://${hostip}:10811\";export all_proxy=\"socks5://${hostip}:10810\";'\nalias unsetss='unset all_proxy'\n</code></pre>"},{"location":"command/wsl2/#python","title":"Python\u73af\u5883","text":"<pre><code>sudo apt install python3-pip\nsduo apt install python3-venv\npython3 -m venv env\nsource env/bin/activate\n</code></pre>"},{"location":"component/mysql/","title":"Mysql","text":"<pre><code> python3 -m pip install --upgrade pip\n pip3 install mycli\n</code></pre> <pre><code>[\u5b89\u88c5\u5730\u5740](https://www.mycli.net/install)\n</code></pre> <p>Note\uff1aPython 3.6+ </p> <ol> <li> <p>\u8fde\u63a5\u5668\uff1a \u8fde\u63a5\u7528\u6237\u7684\u8fde\u63a5</p> </li> <li>\u5206\u6790\u5668\uff1a \u8bcd\u6cd5\u5206\u6790\uff0c\u8bed\u6cd5\u5206\u6790</li> <li>\u4f18\u5316\u5668\uff1a \u4f18\u5316SLQ\u8bed\u53e5\uff0c\u89c4\u5b9a\u6267\u884c\u6d41\u7a0b</li> <li> <p>\u6267\u884c\u5668 \uff1aSQL\u8bed\u53e5\u7684\u6267\u884c</p> </li> <li> </li> <li> <p>show profiling</p> </li> <li>Performance Schema</li> <li>\u5c3d\u91cf\u907f\u514dnull</li> <li> <p>\u9009\u62e9\u6700\u5c0f\u7684\u6570\u636e\u7c7b\u578b</p> </li> <li> </li> <li> <p>\u6574\u578b\u7c7b\u578b </p> \u7c7b\u578b \u7a7a\u95f4 \u6709\u7b26\u53f7\u7684\u6700\u5c0f\u503c \u6709\u7b26\u53f7\u7684\u6700\u5927\u503c \u65e0\u7b26\u53f7\u6700\u5c0f\u503c \u65e0\u7b26\u53f7\u6700\u5927\u503c TINYINT 8 -128 127 0 255 SMALLINT 16 -32768 32767 0 65535 MEDIUMINT 24 -8388608 8388607 0 16777215 INT 32 -2147483648 2147483647 0 4294967295 BIGINT 64 -2 ^63 2 ^63-1 0 2^64-1 </li> <li> <p>\u5b57\u7b26\u4e32</p> Value <code>CHAR(4)</code> Storage Required <code>VARCHAR(4)</code> Storage Required <code>''</code> <code>'  '</code> 4 bytes <code>''</code> 1 byte <code>'ab'</code> <code>'ab '</code> 4 bytes <code>'ab'</code> 3 bytes <code>'abcd'</code> <code>'abcd'</code> 4 bytes <code>'abcd'</code> 5 bytes <code>'abcdefgh'</code> <code>'abcd'</code> 4 bytes <code>'abcd'</code> 5 bytes <p>varchar \u4f1a\u75281\u4e2a\u5b57\u8282\u62162\u4e2a\u5b57\u8282\u957f\u5ea6\u7684\u524d\u7f00\u6570\u636e  \u4e0d\u8d85\u8fc7255 \u4e00\u4e2a\u5b57\u8282\u4f7f\u75281\u4e2a\u957f\u5ea6\uff0c\u8d85\u8fc7255 \u5b57\u8282\u4f7f\u75282\u4e2a\u5b57\u8282\u957f\u5ea6</p> <p>char \u6700\u5927\u503c255 varchar\u6700\u5927\u503c65535</p> </li> <li> <p>\u65f6\u95f4\u7c7b\u578b</p> Data Type \u201cZero\u201d Value rang Storage Required <code>DATE</code> <code>'0000-00-00'</code> 1000-01-01 ~ 9999-12-31 3bytes <code>TIME</code> <code>'00:00:00'</code> <code>DATETIME</code> <code>'0000-00-00 00:00:00'</code> 1000-01-01 00:00:00 ~ 9999-12-31 23:59:59 8bytes \u6beb\u79d2 <code>TIMESTAMP</code> <code>'0000-00-00 00:00:00'</code> 1970-01-01 00:00:01 ~ 2038-01-19 03:14:07 4bytes \u79d2 <code>YEAR</code> <code>0000</code> datetime\uff1a  \u5360\u7528\u7a7a\u95f4\u5927\uff0c\u635f\u5931\u65e5\u671f\u7c7b\u51fd\u6570 \u4e0e\u65f6\u533a\u65e0\u5173\uff0c\u5b57\u7b26\u4e32 <p>timestamp\uff1a \u91c7\u7528\u6574\u578b\u5b58\u50a8\uff0c\u4f9d\u8d56\u65f6\u533a\uff0c</p> <p>date\uff1a \u53ef\u4ee5\u4f7f\u7528\u65e5\u671f\u7c7b\u51fd\u6570\uff0c\u5b57\u7b26\u4e32 </p> </li> <li> </li> </ol> MyISAM InnoDB \u652f\u6301\u7248\u672c 5.5\u4e4b\u524d 5.5\u4e4b\u540e \u4e8b\u52a1 N Y \u8868\u9501 Y Y \u884c\u9501 N Y \u5916\u952e N Y count \u4fdd\u5b58\u6709\u8868\u7684\u603b\u884c\u6570 \u6ca1\u6709\u4fdd\u5b58\u8868\u7684\u603b\u884c\u6570 CURD\u64cd\u4f5c \u5927\u91cf\u7684SELECT \u5927\u91cf\u7684DELETE,INSERT,UPDATE B+tree \u53f6\u5b50\u8282\u70b9\u5b58\u653e\u6570\u636e\u7d22\u5f15 \u53f6\u5b50\u8282\u70b9\u5b58\u653e\u6570\u636e <ol> <li> </li> </ol> <pre><code>+----+--+------+------------+------+---------------+--------+---------+--------+------+----------+--------+\n| id |select_type|table|partitions | type | possible_keys | key | key_len | ref    | rows | filtered | Extra  |\n+----+----+-------+------------+------+--    -------+--------+---------+--------+------+----------+--------+\n| 1  | SIMPLE | staff | &lt;null&gt;| ALL  | &lt;null&gt;     | &lt;null&gt; | &lt;null&gt;  | &lt;null&gt; | 2    | 100.0    | &lt;null&gt; |\n+----+---+-------+----------+------+---------------+--------+---------+--------+------+----------+--------+\n</code></pre> <p>type\u4f18\u5148\u7ea7\uff1a </p> <p>system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null&gt;index_merge&gt;unique_subquery&gt;index_sumquery&gt;range&gt;index&gt;alll</p> <ol> <li> </li> <li> <p>\u56de\u8868</p> <ol> <li>\u666e\u901a\u7d22\u5f15\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952eid</li> <li>\u67e5\u5230\u4e3b\u952eid\u518d\u67e5\u4e3b\u952eid\u6570\u7684\u6570\u636e</li> </ol> </li> <li> <p>\u7d22\u5f15\u8986\u76d6  </p> <pre><code>select id from user where name= 1\n</code></pre> </li> <li> <p>\u6700\u5de6\u5339\u914d</p> <pre><code>select * from user where age=? and name =?\nselect * from user whre\n</code></pre> </li> <li> <p>\u7d22\u5f15\u4e0b\u63a8 \u7ec4\u5408\u7d22\u5f15</p> <p>\u591a\u4e2a\u6761\u4ef6 \u8fd4\u56de\u6570\u636e\u96c6\u5408\uff0c\u8fd4\u56de\u540e\u5224\u65ad\uff0c\u8fd4\u56de\u524d\u5224\u65ad</p> </li> <li> </li> </ol> <pre><code>source  /xxx/xxx.sql\n</code></pre> <ol> <li> </li> <li> <p>\u67e5\u8be2\u6267\u884c\u65f6\u95f4</p> <pre><code>set profiling=1;\nshow profiles;\n#\u6700\u540e\u4e00\u6b21\u67e5\u8be2\u65f6\u95f4\nshow status like '%last_query_const%'\n</code></pre> </li> <li> <p>order by \u6392\u5e8f</p> <pre><code># \u6ca1\u8d85\u8fc7\u4f7f\u7528\u5355\u6b21\u6392\u5e8f\uff0c \u8d85\u8fc7\u662f\u6709\u4e24\u6b21\u6392\u5e8f\nshow variables like '%max_length_for_sort_data%';\n</code></pre> <ol> <li> <p>\u4f7f\u7528\u7d22\u5f15\u6392\u5e8f</p> </li> <li> <p>\u6392\u5e8f\u90fd\u662f aes or desc</p> </li> <li> <p>\u7b2c\u4e00\u5217\u4f7f\u7528\u8303\u56f4\u67e5\u8be2\u4e0d\u80fd\u5728\u4f7f\u7528\u7d22\u5f15\u6392\u5e8f</p> </li> <li> <p>\u4e24\u6b21\u4f20\u8f93\u6392\u5e8f</p> <ul> <li> <p>\u4e00\u6b21\u53ea\u67e5\u8be2\u6392\u5e8f\u5b57\u6bb5</p> </li> <li> <p>\u4e8c\u6b21\u67e5\u8be2\u6392\u5e8f\u5b8c\u7684\u6570\u636e</p> </li> </ul> </li> <li> <p>\u5355\u6b21\u4f20\u8f93\u6392\u5e8f</p> <ul> <li>\u8bfb\u53d6\u6570\u636e\u7684\u6240\u6709\u5217\u5e76\u6392\u5e8f</li> </ul> </li> <li></li> </ol> </li> <li> <p>\u7c7b\u578b\u8f6c\u6362\u4f1a\u4ea7\u751f\u5168\u8868\u7d22\u5f15 </p> <p><code>sql  select name,age,phone from user wehre phone =143XXXX8423  select name,age,phone from user wehre phone ='143XXXX8423'</code></p> </li> <li> <p>\u5efa\u7acb\u7d22\u5f15\u4f18\u5316</p> <ol> <li> <p>\u533a\u5206\u4e0d\u5927\u7684\u5217\u4e0d\u5efa\u7d22\u5f15</p> </li> <li> <p>\u4f7f\u7528\u533a\u5206\u5ea6\u89c4\u5212\u7d22\u5f15 80%</p> <p><code>sql select count(destinct(\"\u5217\u540d\")/count(*)) from table;</code></p> </li> <li> <p>\u4e00\u5f20\u8868\u7d22\u5f15\u6570\u91cf\u4e0d\u8981\u8d85\u8fc75\u4e2a</p> </li> <li> <p>join \u4e0d\u8d85\u8fc73\u5f20\u8868</p> </li> </ol> </li> <li> <p>\u67e5\u8be2\u4f18\u5316</p> <ol> <li>\u7cfb\u7edf\u6027\u80fd</li> <li>\u4e0d\u5efa\u8bae\u4f7f\u7528select * </li> <li>\u7b49\u503c\u4f20\u64ad\uff08\u672f\u8bed\uff09 \u591a\u5f20\u8868where\u52a0\u76f8\u540c\u7684\u67e5\u8be2\u6761\u4ef6\u5199\u4e00\u4e2a\u6761\u4ef6\u5c31\u53ef\u4ee5</li> </ol> </li> <li> <p>join\u4f18\u5316</p> <pre><code># \u9ed8\u8ba4256k\nshow variables like '%join_buffer_size%';\n# optimizer_switch block_nested_loop \u8bbe\u7f6e\u4e3aon \u9ed8\u8ba4\u5f00\u542f\nshow variables like '%optimizer_switch%';\n</code></pre> </li> <li> <p>Limit \u4f18\u5316</p> <pre><code>select * from user limit 10000,10;\nselect * from user a join(select id from user limit 10000,10) b on a.id = b.id;\n</code></pre> </li> <li></li> <li> </li> <li> </li> <li> </li> <li> </li> <li> <p>\u8df3\u8fc7\u8ba4\u8bc1\u63d2\u4ef6</p> <pre><code># \u914d\u7f6e vim /etc/my.cnf\n--skip-grant-tables[={OFF|ON}]\n\u7c7b\u578b    \u5e03\u5c14\u503c\n\u9ed8\u8ba4\u503c   OFF\n</code></pre> </li> <li> <p>\u8fde\u63a5</p> <pre><code># \u67e5\u770b\u6700\u5927\u8fde\u63a5\u6570\nshow variables like '%max_connections%';\n+-----------------+-------+\n| Variable_name   | Value |\n+-----------------+-------+\n| max_connections | 151   |\n+-----------------+-------+\nset global max_connections=3000\n# \u9650\u5236\u7528\u6237\u7684\u8fde\u63a5\u6570\nshow variables like '%max_user_connections%';\n+----------------------+-------+\n| Variable_name        | Value |\n+----------------------+-------+\n| max_user_connections | 0     |\n+----------------------+-------+\nset global max_user_connections = 10;\n# \u7b49\u5f85\u961f\u5217\nshow variables like '%back_log%';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| back_log      | 80    |\n+---------------+-------+\n\n# \u914d\u7f6e vim /etc/my.cnf\n# max_connections = 3000\n# max_user_connections=10\n# back_log=80\n</code></pre> </li> <li> <p>\u67e5\u8be2\u8bed\u53e5</p> <pre><code># \u67e5\u770b\u6267\u884c\u7684\u4fe1\u606f\nshow processlist\n</code></pre> </li> <li> <p>variables</p> <pre><code># log_bin\nshow variables like '%log_bin%';\n+---------------------------------+--------------------------------+\n| Variable_name                   | Value                          |\n+---------------------------------+--------------------------------+\n| log_bin                         | ON                             |\n| log_bin_basename                | /var/lib/mysql/mysql-bin       |\n| log_bin_index                   | /var/lib/mysql/mysql-bin.index |\n| log_bin_trust_function_creators | OFF                            |\n| log_bin_use_v1_row_events       | OFF                            |\n| sql_log_bin                     | ON                             |\n+---------------------------------+--------------------------------+\n# vim /etc/my.cnf\nlog-bin=mysql-bin\nserver-id=1\n# \u4e8c\u8fdb\u5236\u65e5\u5fd7\u683c\u5f0f\nbinlog_format=ROW\n# \u6307\u5b9a\u800c\u7cbe\u81f4\u65e5\u5fd7\u7684\u6570\u636e\u5e93\nbinlog-do-db=db_name\n# \u5ffd\u7565\u7684db\u6570\u636e\u5e93\nbinlog-ignore-db=db_name\n\n# \u67e5\u8be2\u65e5\u5fd7\nshow variables like '%general_log%';\n+------------------+-----------------------------------+\n| Variable_name    | Value                             |\n+------------------+-----------------------------------+\n| general_log      | OFF                               |\n| general_log_file | /var/lib/mysql/VM-21-8-centos.log |\n+------------------+-----------------------------------+\n# \u6162\u67e5\u8be2\nshow variables like '%slow_query_log%';\n+---------------------+----------------------------------------+\n| Variable_name       | Value                                  |\n+---------------------+----------------------------------------+\n| slow_query_log      | OFF                                    |\n| slow_query_log_file | /var/lib/mysql/VM-21-8-centos-slow.log |\n+---------------------+----------------------------------------+\n# \u6162\u67e5\u8be2\u65f6\u95f4\nshow variables like '%query_time%';\n+-----------------+-----------+\n| Variable_name   | Value     |\n+-----------------+-----------+\n| long_query_time | 10.000000 |\n+-----------------+-----------+\n# \u67e5\u8be2\u7f13\u5b58\nshow variables like '%query_cach%';\n+------------------------------+---------+\n| Variable_name                | Value   |\n+------------------------------+---------+\n| have_query_cache             | YES     |\n| query_cache_limit            | 1048576 |\n| query_cache_min_res_unit     | 4096    |\n| query_cache_size             | 1048576 |\n| query_cache_type             | OFF     |\n| query_cache_wlock_invalidate | OFF     |\n+------------------------------+---------+\n# \u7f13\u5b58\u72b6\u6001\u67e5\u8be2\nshow status like '%Qcache%';\n+-------------------------+---------+\n| Variable_name           | Value   |\n+-------------------------+---------+\n| Qcache_free_blocks      | 1       |\n| Qcache_free_memory      | 1031832 |\n| Qcache_hits             | 0       |\n| Qcache_inserts          | 0       |\n| Qcache_lowmem_prunes    | 0       |\n| Qcache_not_cached       | 12      |\n| Qcache_queries_in_cache | 0       |\n| Qcache_total_blocks     | 1       |\n+-------------------------+---------+\n# \u6392\u5e8f\u7f13\u5b58\nshow variables  like '%sort_buffer_size%';\n+-------------------------+---------+\n| Variable_name           | Value   |\n+-------------------------+---------+\n| innodb_sort_buffer_size | 1048576 |\n| myisam_sort_buffer_size | 8388608 |\n| sort_buffer_size        | 262144  |\n+-------------------------+---------+\n</code></pre> </li> <li> </li> <li> <p>MySAM  \u8868\u9501</p> <ol> <li>\u5171\u4eab\u8bfb\u9501</li> <li>\u72ec\u5360\u8840\u9501</li> </ol> <pre><code>lock table user read;\nlock table user write;\nunlock table;\n# \u72b6\u6001\u67e5\u8be2\nshow status like \"%table_locks%\"\n+-----------------------+-------+\n| Variable_name         | Value |\n+-----------------------+-------+\n| Table_locks_immediate | 122   |\n| Table_locks_waited    | 0     |\n+-----------------------+-------+\n</code></pre> </li> <li> <p>InnoDB</p> <pre><code>autocommit=1 # \u7acb\u5373\u751f\u6548\uff0c\u81ea\u52a8\u63d0\u4ea4\nautocommit=0 # \u4e0d\u751f\u6548\uff0ccommit\u547d\u63d0\u4ea4\n</code></pre> <ol> <li> <p>\u5171\u4eab\u9501</p> <pre><code>select * from user where id =1 lock in share mode;\n</code></pre> </li> <li> <p>\u6392\u5b83\u9501</p> <pre><code>select * from user where id =1 for update;\n</code></pre> </li> </ol> </li> </ol>"},{"location":"component/mysql/#mycli-centos7","title":"mycli \u5b89\u88c5centos7","text":""},{"location":"component/mysql/#_1","title":"\u529f\u80fd","text":""},{"location":"component/mysql/#_2","title":"\u8c03\u4f18","text":""},{"location":"component/mysql/#_3","title":"\u6570\u636e\u7c7b\u578b","text":""},{"location":"component/mysql/#_4","title":"\u5b58\u50a8\u5f15\u64ce","text":""},{"location":"component/mysql/#explain","title":"EXPLAIN","text":""},{"location":"component/mysql/#_5","title":"\u7d22\u5f15","text":""},{"location":"component/mysql/#_6","title":"\u6570\u636e\u5bfc\u5165","text":""},{"location":"component/mysql/#_7","title":"\u4f18\u5316","text":""},{"location":"component/mysql/#_8","title":"\u5206\u533a","text":""},{"location":"component/mysql/#_9","title":"\u5206\u533a\u7c7b\u578b","text":"<ol> <li>\u8303\u56f4\u5212\u5206</li> </ol> <pre><code>CREATE TABLE employees (\nid INT NOT NULL,\nfname VARCHAR(30),\nlname VARCHAR(30),\nhired DATE NOT NULL DEFAULT '1970-01-01',\nseparated DATE NOT NULL DEFAULT '9999-12-31',\njob_code INT NOT NULL,\nstore_id INT NOT NULL\n)\nPARTITION BY RANGE (store_id) (\nPARTITION p0 VALUES LESS THAN (6),\nPARTITION p1 VALUES LESS THAN (11),\nPARTITION p2 VALUES LESS THAN (16),\nPARTITION p3 VALUES LESS THAN (21)\n);\n</code></pre> <ol> <li>\u5217\u8868\u5206\u533a</li> </ol> <pre><code>CREATE TABLE employees (\nid INT NOT NULL,\nfname VARCHAR(30),\nlname VARCHAR(30),\nhired DATE NOT NULL DEFAULT '1970-01-01',\nseparated DATE NOT NULL DEFAULT '9999-12-31',\njob_code INT,\nstore_id INT\n)\nPARTITION BY LIST(store_id) (\nPARTITION pNorth VALUES IN (3,5,6,9,17),\nPARTITION pEast VALUES IN (1,2,10,11,19,20),\nPARTITION pWest VALUES IN (4,12,13,14,18),\nPARTITION pCentral VALUES IN (7,8,15,16)\n);\n</code></pre> <ol> <li> <p>\u5217\u5206\u533a</p> </li> <li> <p>hash\u5206\u533a</p> </li> </ol> <pre><code>CREATE TABLE employees (\nid INT NOT NULL,\nfname VARCHAR(30),\nlname VARCHAR(30),\nhired DATE NOT NULL DEFAULT '1970-01-01',\nseparated DATE NOT NULL DEFAULT '9999-12-31',\njob_code INT,\nstore_id INT\n)\nPARTITION BY HASH(store_id)\nPARTITIONS 4;\n</code></pre> <ol> <li>key\u5206\u533a</li> </ol> <pre><code>CREATE TABLE tm1 (\ns1 CHAR(32) PRIMARY KEY\n)\nPARTITION BY KEY(s1)\nPARTITIONS 10;\n</code></pre> <ol> <li>\u5b50\u5206\u533a</li> </ol>"},{"location":"component/mysql/#_10","title":"\u7ba1\u7406","text":"<ol> <li>\u4f7f\u7528\u5206\u533a\u9009\u62e9\u6765\u83b7\u53d6\u6b64\u4fe1\u606f</li> </ol> <pre><code>mysql&gt; SELECT * FROM tr PARTITION (p2);\n+------+-------------+------------+\n| id   | name        | purchased  |\n+------+-------------+------------+\n|    2 | alarm clock | 1997-11-05 |\n|   10 | lava lamp   | 1998-12-25 |\n+------+-------------+------------+\n2 rows in set (0.00 sec)\n</code></pre> <ol> <li>\u5220\u9664\u5206\u533a</li> </ol> <pre><code>ALTER TABLE tr DROP PARTITION p2;\n</code></pre> <ol> <li>\u6dfb\u52a0\u5206\u533a</li> </ol> <pre><code>mysql&gt; ALTER TABLE members\n&gt;     ADD PARTITION (\n&gt;     PARTITION n VALUES LESS THAN (1970));\n</code></pre> <ol> <li></li> </ol>"},{"location":"component/mysql/#_11","title":"\u914d\u7f6e","text":""},{"location":"component/mysql/#_12","title":"\u9501","text":""},{"location":"component/redis/","title":"Redis","text":"<pre><code>##\u4e0b\u8f7d\u6587\u4ef6\nwget https://github.com/redis/redis/archive/refs/tags/5.0.5.tar.gz\ntar xf 5.0.5.tar.gz\n\n##\u5b89\u88c5\nyum install gcc\nmake \nsrc \u751f\u6210 *.sh\nmake PREFIX=/some/other/directory\nvi /etc/profile   PATH /some/other/directory\n\n##\u73af\u5883\u53d8\u91cf\nexport REDIS_HOME =/some/other/directory\nexport PATH=$PATH:$REDIS\nsource /etc/profile\n\n##\u751f\u6210service\u670d\u52a1\ncd utils\n./install_server.sh\n\n##\u670d\u52a1\u542f\u52a8\u811a\u672c\ncd /etc/init.d \n</code></pre> <pre><code>help @string\nhelp @list\nhelp @hash\nhelp @set\nhelp @sorted_set\n</code></pre> <pre><code>// WATCH  \u76d1\u89c6key\n// MULTI \u5f00\u542f\u4e8b\u52a1\n// EXEC \u6267\u884c\u4e8b\u52a1\nMULTI \u5f00\u542f\u4e8b\u52a1\n--------\nset k1 aa\nQUEUED\n--------\nset k2 bbb\nQUEUED\n--------\nexec \u6267\u884c\nOK\nOK\n</code></pre> <p>\u6a21\u5757\u5730\u5740\uff1a https://redis.io/modules</p> <p>\u5e03\u9686\u8fc7\u6ee4\u5668\u5b98\u7f51\u5730\u5740\uff1a https://github.com/RedisBloom/RedisBloom</p> <pre><code>#redis.conft\u6dfb\u52a0\u6a21\u5757\nloadmodule /opt/redis5/RedisBloom-2.2.5/redisbloom.so #\u52a0\u8f7d\u6a21\u5757\nBF.ADD k1 test\n(integer) 1\nBF.EXISTS k1 test\n(integer) 0\n</code></pre> <p>\u5e03\u8c37\u9e1f\u8fc7\u6ee4\u5668</p> <ol> <li> <p>\u8fc7\u671f\u7b56\u7565</p> <pre><code>1.\u88ab\u52a8\u662f\u8bbf\u95ee\u5224\u5b9a\n2.\u5468\u671f\u8f6e\u8bad\u5224\u5b9a\uff08\u589e\u91cf\uff09\n  2.1 \u8fc7\u671f\u65f6\u95f4\u7684\u952e\u96c6\u5408\n  2.2 \u6bcf\u6b21\u4ece\u8fd9\u4e2a\u96c6\u5408\u4e2d\u968f\u673a\u68c0\u6d4b20\u4e2a\u952e\u67e5\u770b\u4ed6\u4eec\u662f\u5426\u8fc7\u671f\n  2.3 \u8d85\u8fc725%\u7684\u96c6\u5408\u4e2d\u7684\u952e\u5df2\u7ecf\u8fc7\u671f  \u7ee7\u7eed\u68c0\u6d4b\u8fc7\u671f\u96c6\u5408\n</code></pre> </li> <li> <p>\u5185\u5b58\u6700\u5927</p> <pre><code>maxmemory  \u6700\u5927\u5185\u5b58\nmaxmemory-policy \u56de\u6536\u7b56\u7565\nLRU \u6700\u4e45\u6ca1\u6709\u4f7f\u7528\u7684\u952e\nLFU \u9891\u7387\u6700\u5c11\u7684\u952e\n\u7b56\u7565\uff1a\nallkeys-lru     \u6700\u4e45\u6ca1\u6709\u4f7f\u7528\u7684\u952e\nvolatile-lru    \u8fc7\u671f\u65f6\u95f4\u7684\u952e\u96c6\u5408\u4e2d\u9a71\u9010\u6700\u4e45\u6ca1\u6709\u4f7f\u7528\u7684\u952e\nallkeys-random  \u6240\u6709key\u968f\u673a\u5220\u9664\nvolatile-random \u8fc7\u671f\u952e\u7684\u96c6\u5408\u4e2d\u968f\u673a\u9a71\u9010\nvolatile-ttl    \u9a71\u9010\u9a6c\u4e0a\u5c31\u8981\u8fc7\u671f\u7684\u952e\nvolatile-lfu    \u8fc7\u671f\u65f6\u95f4\u7684\u952e\u4e2d\u9a71\u9010\u4f7f\u7528\u9891\u7387\u6700\u5c11\u7684\u952e\nallkeys-lfu     \u6240\u6709\u952e\u4e2d\u9a71\u9010\u4f7f\u7528\u9891\u7387\u6700\u5c11\u7684\u952e\n</code></pre> </li> <li> </li> <li> </li> <li>"},{"location":"component/redis/#_1","title":"\u5b89\u88c5","text":""},{"location":"component/redis/#type-key","title":"\u6570\u636e\u7c7b\u578b(type key)","text":""},{"location":"component/redis/#string","title":"String","text":"<pre><code>  object encoding key #embstr int raw\n  set\n</code></pre> <ul> <li> <p>\u5b57\u7b26\u4e32</p> </li> <li> <p>\u6570\u503c   </p> </li> <li> <p>bitmap</p> <pre><code>SETBIY            \u8bbe\u7f6e\u503c\nBITCOUNT key 0,-1 \u7edf\u8ba1\u503c\nBITPOS            \u67e5\u8be2\u7b2c\u4e00\u6b21\u51fa\u73b01/0\u7684\u503c\nBITTOP            \u8054\u5408\u67e5\u8be2 and or xor not\n</code></pre> </li> </ul>"},{"location":"component/redis/#list","title":"List","text":""},{"location":"component/redis/#_2","title":"\u5806\u6808","text":"<pre><code> LPUSH k1  a b c  Link c--b--a\n LPOP  k1  c\n LRANG k1 0 ,-1\n -------------------------------\n RPUSH k2 a b c  link a--b--c\n RPOP  k2 c\n</code></pre>"},{"location":"component/redis/#_3","title":"\u961f\u5217","text":"<p><code>LRANG k1 0 -1  LINSERT k1 after/before \u5143\u7d20 \u503c</code></p>"},{"location":"component/redis/#_4","title":"\u6570\u7ec4","text":"<pre><code>INDEX                 \u67e5\u8be2\u4f4d\u7f6e\nLSET                  \u8bbe\u7f6e\u4f4d\u7f6e\nLREM key count VALUE  \u79fb\u9664\n</code></pre>"},{"location":"component/redis/#_5","title":"\u963b\u585e","text":"<pre><code>BLPOP\nBRPOP\n</code></pre>"},{"location":"component/redis/#hash","title":"Hash","text":""},{"location":"component/redis/#set","title":"Set","text":""},{"location":"component/redis/#_6","title":"\u4ea4\u96c6\uff0c\u5e76\u96c6 ,\u5dee\u96c6","text":"<pre><code>SADD key1 1 2 3 4\nSADD key2 4 5 6 7\nSINTER  key1 key2  #\u4ea4\u96c6 4\nSDIFF key1 key2    #\u5dee\u5f02   1 2 3\nSDIFF key2 key1    #4 5 6   7\nSUNION key1 key2   #1 2 3 4 5 6 7 \nSRANDMEMBER k1 5   #1 2 3 4 \nSRANDMEMBER k1 -5  #2 3 4 3 3 \u968f\u673a\u4e8b\u4ef6\nSPOP \u53d6\u51fa\u4e00\u4e2a\n</code></pre>"},{"location":"component/redis/#sorted-set","title":"Sorted set","text":""},{"location":"component/redis/#_7","title":"\u6392\u5e8f","text":"<pre><code>ZADD key1 score1 x score2 xx \nZSCORE key1            #\u5206\u503c\nZRANG key1             #\u4ece\u5c0f\u5230\u5927\nZREVRANGE key          #\u4ece\u5927\u5230\u5c0f\nINCRBY key1 score1 x  #\u4fee\u6539\u5206\u6570\n</code></pre>"},{"location":"component/redis/#_8","title":"\u96c6\u5408\u64cd\u4f5c","text":"<pre><code>                      \u6743\u91cd         \u805a\u5408\u51fd\u6570\nZUNIONSTORE key1 key2 WEIGHTS 1 0.5 SUM|MIN|MAX\n</code></pre>"},{"location":"component/redis/#skip-list","title":"skip list","text":"<pre><code>1 - - - 5 - - - 9\n|               |\n1 - 3 - 5 - 7 - 9\n|   |   |   |   |\n1 2 3 4 5 6 7 8 9\n</code></pre>"},{"location":"component/redis/#_9","title":"\u4e8b\u52a1","text":""},{"location":"component/redis/#_10","title":"\u5e03\u9686\u8fc7\u6ee4\u5668\u6a21\u5757","text":""},{"location":"component/redis/#_11","title":"\u914d\u7f6e\u76f8\u5173","text":""},{"location":"component/redis/#rdbsave-the-db-on-disk","title":"RDB\uff08Save the DB on disk\uff09","text":""},{"location":"component/redis/#fork","title":"Fork","text":"<p>\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b \u62f7\u8d1d\u7236\u7c7b\u6240\u6709key\u7684\u5f15\u7528</p> <p>\u7236\u8fdb\u7a0b\u7684\u4fee\u6539\u4e0d\u4f1a\u5f71\u54cd\u5b50\u8fdb\u7a0b \u5b50\u8fdb\u7a0b\u7684\u4fee\u6539\u4e0d\u4f1a\u5f71\u54cd\u7236\u8fdb\u7a0b</p> <p>copy on write \u5199\u65f6\u590d\u5236</p>"},{"location":"component/redis/#_12","title":"\u89e6\u53d1\u89c4\u5219","text":"<p>save \u624b\u52a8\u89e6\u53d1</p> <p>bgsave\uff1a save  <li> <p>RDB\u548cAOF\u53ef\u4ee5\u540c\u65f6\u5f00\u542f</p> </li> <li> <p>\u5f00\u542f\u4e86AOF\u53ea\u4f1a\u7528AOF\u6062\u590d</p> </li> <li> <p>\u6062\u590d\u6570\u636e\u4f18\u5316</p> <pre><code>\u89e6\u53d1\u5408\u5e76\u4f18\u5316 BGREWRITEAOF  \n4.0 \u4ee5\u524d \u91cd\u5199  \u5408\u5e76\u91cd\u590d\u7684\u547d\u4ee4 \n4.0 \u4ee5\u540e \u91cd\u5199  \u5148\u4fdd\u5b58rdb\u683c\u5f0f\u6570\u636e\uff0c\u5728\u5199\u589e\u91cf\u7684\u6570\u636eaof\u6587\u4ef6\n\nauto-aof-rewrite-percentage 100%  \nauto-aof-rewrite-min-size 64mb    #\u8fbe\u523064MB\u91cd\u5199 \u8bb0\u5f55\u4e0a\u6b21BGREWRITEAOF\u540e\u7684\u5927\u5c0f\n</code></pre> </li> <li> <p>\u914d\u7f6e</p> <pre><code>appendonly yes #\u5f00\u542fAOF\u6587\u4ef6\n\u89e6\u53d1\u89c4\u5219 \u5199\u7684buffer \u89e6\u53d1flush\n#appendfsync always  \u6bcf\u6b21\nappendfsync everysec  \u6bcf\u79d2\n#appendfsync no      IO buffer \u6ee1\u4e86\n</code></pre> </li> <li> </li> <pre><code> ###\u4e3b\u4ece\n REPLICAOF ip port                        #\u8bbe\u7f6e\u4ece\u8282\u70b9\u547d\u4ee4\n replicaof &lt;masterip&gt; &lt;masterport&gt;        #\u914d\u7f6e\n REPLICAOF no one                         #\u81ea\u5df1\u53d8\u6210\u4e3b \n redis-server ./sentinel.conf --sentinel  #\u542f\u52a8sentinel \n</code></pre> <p>sentinel \u914d\u7f6e\u6587\u4ef6\u8be6\u60c5\uff1ahttps://redis.io/topics/sentinel</p> <pre><code>\u96c6\u7fa4\nredis-cli --cluster create 127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 \\\n--cluster-replicas 1\n\n###\u914d\u7f6e\nhttps://redis.io/topics/cluster-tutorial\ncluster-enabled yes\n</code></pre> <ol> <li> </li> <li> <p>\u51fb\u7a7f\uff1a\u9ad8\u5e76\u53d1 key\u8fc7\u671f\u4e86 \u5e76\u53d1\u8bbf\u95ee\u6570\u636e\u5e93</p> <pre><code>key \u8fc7\u671f\nLRU\nLFU \nsetnx() -&gt; \u9501\n1. \u53d1\u73b0key null\n2. setnx \u9501 \u8fc7\u671f\u65f6\u95f4\n3. \u53ea\u6709\u83b7\u53d6\u9501\u7684\u53bb\u8bbf\u95eeDB\n</code></pre> </li> <li> <p>\u7a7f\u900f\uff1a \u6570\u636e\u5e93\u6839\u672c\u4e0d\u5b58\u5728\u7684\u7684\u6570\u636e</p> <pre><code>1. \u5ba2\u6237\u7aef \u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\n2. redis \u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u6a21\u677f\n3. \u5e03\u8c37\u9e1f\u8fc7\u6ee4\u5668\n</code></pre> </li> <li> <p>\u96ea\u5d29\uff1a \u5927\u91cf\u7684key\u540c\u65f6\u5931\u6548 \u5927\u91cf\u7684\u8bf7\u6c42\u8bbf\u95eeDB</p> <pre><code>1. \u968f\u673a\u8fc7\u671f\u65f6\u95f4\n2. \u4f7f\u7528\u51fb\u7a7f\u65b9\u6848\n3. sentinel \u8d44\u6e90db\u9650\u6d41\n</code></pre> </li> <li> <p>\u5206\u5e03\u5f0f\u9501</p> <pre><code>setnx \u8fc7\u671f\u65f6\u95f4\nredssion\n\u5efa\u8bae\u7528 zk\u9501\n</code></pre> </li> <li> </li> </ol> <pre><code>lettuce \njedis\nredssion\nspring-data-redis\n</code></pre>"},{"location":"component/redis/#_13","title":"\u5b58\u50a8\u6587\u4ef6","text":"<p>var/lib/redis/6389/dump.rdb</p>"},{"location":"component/redis/#aof","title":"AOF\uff08\u5199\u64cd\u4f5c\u8bb0\u5f55\u5230\u6587\u4ef6\uff09","text":""},{"location":"component/redis/#_14","title":"\u96c6\u7fa4\u642d\u5efa","text":""},{"location":"component/redis/#_15","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"component/redis/#_16","title":"\u5ba2\u6237\u7aef","text":""},{"location":"component/zookeeper/","title":"Zookeeper","text":"<ol> <li> <p>\u6301\u4e45\u8282\u70b9</p> </li> <li> <p>\u4e34\u65f6\u8282\u70b9\uff08client session\uff09</p> </li> <li> <p>\u5e8f\u5217\u8282\u70b9</p> <pre><code>reate -s /node1\n/node10000000001\n</code></pre> </li> <li> <p>\u8282\u70b9\u5b58\u50a8\u6570\u636e\uff081MB\uff09</p> </li> <li> <p>\u89d2\u8272</p> <p><code>Leader  Follower \u624d\u80fd\u9009\u4e3e  Observer</code></p> </li> <li> <p>\u4fe1\u606f</p> <pre><code>cZxid =0X200000002  \u5168\u5c40\u4e8b\u52a1id  0X2 \u7b2c\u51e0\u5c4aleader\nmZxid =0X200000003  \u4fee\u6539\u4e8b\u52a1id   \n\u8fde\u63a5\u4fe1\u606f\u4e5f\u4f1a\u6d88\u8017 \u5168\u5c40\u4e8b\u52a1id\n</code></pre> </li> <li> </li> </ol> <pre><code>wget https://downloads.apache.org/zookeeper/zookeeper-3.7.0/apache-zookeeper-3.7.0-bin.tar.gz\n\nexport ZOO_HOME=/opt/apache-zookeeper-3.7.0-bin\nexport PATH=$PATH:${ZOO_HOME}/bin\nsource /etc/profile\n\n#\u4fee\u6539zoo.cfg\nserver.x=IP\u5730\u5740:\u63a5\u53d7\u6570\u636e:\u9009\u4e3b\u6295\u7968\nserver.1=localhost:2287:3387\nserver.2=localhost:2288:3388\nserver.3=localhost:2289:3389\nserver.4=localhost:2290:3390:observer\ndataDir=/opt/zoo/data/node1\n\necho 1 &gt;/opt/zoo/data/node1/myid\necho 2 &gt;/opt/zoo/data/node2/myid\necho 3 &gt;/opt/zoo/data/node3/myid\n\nzkServer.sh status /opt/zoo/config/zoo1.cfg\nzkServer.sh status /opt/zoo/config/zoo2.cfg\nzkServer.sh status /opt/zoo/config/zoo3.cfg\n</code></pre> <ol> <li> </li> <li> <p>paxos</p> </li> <li> <p>ZAB</p> <p>zxid \u6700\u65b0</p> <p>myid \u6700\u5927</p> </li> <li> <p>watch</p> <p><code>create  delete  change  children</code></p> </li> <li> </li> </ol> <pre><code>lock0000000001\nlock0000000002  watch  lock0000000001\nlock0000000003  watch  lock0000000002\nlock0000000004  watch  lock0000000003\nlock0000000005  watch  lock0000000004\n</code></pre>"},{"location":"component/zookeeper/#_1","title":"\u8282\u70b9\u4fe1\u606f","text":""},{"location":"component/zookeeper/#_2","title":"\u5b89\u88c5","text":""},{"location":"component/zookeeper/#_3","title":"\u534f\u8bae","text":""},{"location":"component/zookeeper/#_4","title":"\u5206\u5e03\u5f0f\u9501","text":""},{"location":"container/deploy-a-replica-set-mongodb/","title":"docker-compose.yamldocker\u90e8\u7f72mongo\u526f\u672c\u96c6","text":""},{"location":"container/deploy-a-replica-set-mongodb/#1","title":"1.\u670d\u52a1\u5668\u5730\u5740","text":"\u670d\u52a1\u5668IP \u57df\u540d \u8282\u70b9 192.168.201.4 mongodb-primary primary 192.168.201.5 mongodb-secondary secondary 192.168.201.6 mongodb-arbiter arbiter"},{"location":"container/deploy-a-replica-set-mongodb/#2hosts","title":"2.\u6dfb\u52a0hosts","text":"<pre><code>192.168.201.4 mongodb-primary\n192.168.201.5 mongodb-secondary\n192.168.201.6 mongodb-arbiter\n</code></pre>"},{"location":"container/deploy-a-replica-set-mongodb/#3keyfile","title":"3.\u751f\u6210keyfile\u6587\u4ef6","text":"<pre><code>sudo yum install openssl\nsudo yum install openssl-devel\nsudo openssl rand -base64 741 &gt; mongodb-keyfile\n\n# \u4fee\u6539\u6743\u9650\nchmod 600 mongodb-keyfile\nchown 999 mongodb-keyfile\n</code></pre>"},{"location":"container/deploy-a-replica-set-mongodb/#4docker-compose","title":"4.docker-compose","text":"<p>docker-compose.yaml</p>"},{"location":"container/deploy-a-replica-set-mongodb/#5","title":"5.\u542f\u52a8\u5bb9\u5668","text":"<pre><code>docker-compose up -d mongodb-primary\ndocker-compose up -d mongodb-secondary\ndocker-compose up -d mongodb-arbiter\n</code></pre>"},{"location":"container/deploy-a-replica-set-mongodb/#6","title":"6.\u8fde\u63a5\u5230\u526f\u672c\u96c6\u4e0a\u5e76\u4e14\u5b89\u88c5\u914d\u7f6e","text":"<pre><code># \u8fdb\u5165mongodb-primary\u5bb9\u5668\ndocker exec -it mongodb-primary bash\n\n# \u767b\u9646mongod\nmongo mongodb://admin:123456@mongodb-primary:27017\n\n# \u6267\u884c\u914d\u7f6e\u6587\u4ef6\nrs.initiate( {\n_id : \"rs0\",\n   members: [\n{ _id: 0, host: \"mongodb-primary:27017\" ,priority:2},\n      { _id: 1, host: \"mongodb-secondary:27017\",priority:1 },\n      { _id: 2, host: \"mongodb-arbiter:27017\",arbiterOnly:true}\n]\n})\n\n# \u67e5\u770bmongo\u8282\u70b9\u4fe1\u606f\nrs.status()\n</code></pre>"},{"location":"container/k8s/","title":"K8S\u5b89\u88c5","text":"<ol> <li> <p>\u5b89\u88c5\u4fe1\u606f</p> </li> <li> <p>Centos7</p> </li> <li> <p>k8s 1.17.3</p> </li> <li> <p>\u4fee\u6539hostname</p> </li> </ol> <pre><code>hostnamectl set-hostname node\n</code></pre> <ol> <li>\u6dfb\u52a0hosts</li> </ol> <pre><code>cat &lt;&lt;EOF &gt;&gt; /etc/hosts  \n10.0.24.5   node1\n10.0.24.6   node2\n10.0.24.7   node3\nEOF\n</code></pre> <ol> <li>\u5173\u95ed\u9632\u706b\u5899</li> </ol> <pre><code># \u67e5\u770b\u9632\u706b\u5899\u72b6\u6001\nfirewall-cmd --state\n# \u4e34\u65f6\u505c\u6b62\u9632\u706b\u5899\nsystemctl stop firewalld.service\n# \u7981\u6b62\u9632\u706b\u5899\u5f00\u673a\u542f\u52a8\nsystemctl disable firewalld.service\n</code></pre> <ol> <li>\u5173\u95edselinux</li> </ol> <pre><code># \u67e5\u770bselinux\u72b6\u6001\ngetenforce\n# \u4e34\u65f6\u5173\u95edselinux\nsetenforce 0\n# \u6c38\u4e45\u5173\u95edselinux\nsed -i 's/^ *SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config\n</code></pre> <ol> <li>\u5173\u95edswap</li> </ol> <pre><code># \u4e34\u65f6\u5173\u95edswap\nswapoff -a\n# \u6c38\u4e45\u5173\u95edswap\nsed -i.bak '/swap/s/^/#/' /etc/fstab\n# \u67e5\u770b\nfree -g\n</code></pre> <ol> <li>\u542f\u7528br_netfilter\u5185\u6838\u6a21\u5757</li> </ol> <pre><code>modprobe br_netfilter\necho '1' &gt; /proc/sys/net/bridge/bridge-nf-call-iptables\necho '1' &gt; /proc/sys/net/bridge/bridge-nf-call-ip6tables\necho '1' &gt; /proc/sys/net/ipv4/ip_forward\n# \u5728 /etc/sysctl.conf\u6dfb\u52a0\u8fd9\u4e24\u884c\nnet.bridge.bridge-nf-call-iptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.ipv4.ip_forward = 1\n# \u6267\u884c\u6b64\u547d\u4ee4\uff0c\u4f7f\u5176\u751f\u6548\nsysctl -p\n</code></pre> <ol> <li>\u5b89\u88c5docker</li> </ol> <pre><code>sudo yum install -y yum-utils\n# defalut\nsudo yum-config-manager \\\n--add-repo \\\nhttps://download.docker.com/linux/centos/docker-ce.repo\n# aliyun\nsudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n\nsudo yum install -y docker-ce docker-ce-cli containerd.io\n\nmkdir /etc/docker\n\ncat &gt; /etc/docker/daemon.json &lt;&lt;EOF\n{\n  \"registry-mirrors\":[\"https://ustc-edu-cn.mirror.aliyuncs.com\",\"https://mirror.ccs.tencentyun.com\"],\n  \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"log-driver\": \"json-file\",\n  \"log-opts\": {\n    \"max-size\": \"100m\"\n  },\n  \"storage-driver\": \"overlay2\",\n  \"storage-opts\": [\"overlay2.override_kernel_check=true\"]\n}\nEOF\n\n# \u5f00\u673a\u542f\u52a8\nsudo systemctl enable docker\n\n# \u52a0\u8f7d\u914d\u7f6e\nsudo systemctl daemon-reload\n\n# \u91cd\u542fdocker\u670d\u52a1\nsudo systemctl restart docker  </code></pre> <ol> <li>\u5b89\u88c5k8s</li> </ol> <p>k8s \u9ed8\u8ba4\u6e90</p> <pre><code># set repo\ncat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg\nEOF\n</code></pre> <p>aliyun \u6e90</p> <pre><code>#set aliyun\ncat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n# or\ncat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo\n[kubernetes] \nname=Kubernetes \nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64 \nenabled=1 \ngpgcheck=0 \nrepo_gpgcheck=0 \nEOF\n</code></pre> <pre><code>yum install -y kubelet-1.17.3 kubeadm-1.17.3 kubectl-1.17.3 --disableexcludes=kubernetes\n\n# \u542f\u52a8 kubernetes\nsudo systemctl start kubelet\n\n# \u5f00\u673a\u542f\u52a8\nsystemctl enable kubelet\n</code></pre> <ol> <li> <p>\u5b89\u88c5</p> <pre><code>kubeadm init \\\n--apiserver-advertise-address=10.0.24.5 \\\n--kubernetes-version v1.17.3 \\\n--pod-network-cidr=10.244.0.0/16  \\\n--image-repository registry.aliyuncs.com/google_containers \\\n--ignore-preflight-errors=Swap\n\nkubeadm join 10.0.24.5:6443 --token wn73pc.x0rrxf3ykrpm00gr \\\n--discovery-token-ca-cert-hash sha256:4c9369e8724e0b53218c777d394ac3dc59746b40d75252599f8e83470d3a2f36\n\n# \u5f53token\u5931\u6548\u662f\uff0c\u53ef\u4ee5\u7528\u4e0b\u9762\u547d\u4ee4\u91cd\u65b0\u751f\u6210\u65b0token\nkubeadm token create --print-join-command\n</code></pre> <pre><code>mkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n</code></pre> </li> <li> <p>k8s \u91cd\u7f6e</p> <pre><code>kubeadm reset\nrm -fr  $HOME/.kube/config\n</code></pre> </li> <li> <p>helm install</p> <pre><code>curl -O  https://get.helm.sh/helm-v3.8.2-linux-amd64.tar.gz\ntar -zxvf helm-v3.8.2-linux-amd64.tar.gz\nmv linux-amd64/helm /usr/local/bin/helm\n</code></pre> <pre><code># add repo\nhelm repo add bitnami https://charts.bitnami.com/bitnami\nhelm repo add stable http://mirror.azure.cn/kubernetes/charts/\nhelm repo add incubator https://charts.helm.sh/incubator\n</code></pre> </li> <li></li> </ol>"},{"location":"container/nfs/","title":"NFS\u5b89\u88c5","text":"<ol> <li>\u670d\u52a1\u7aef\u5b89\u88c5</li> </ol> <pre><code>sudo yum -y install nfs-utils rpcbind\n\nsudo systemctl start rpcbind nfs \nsudo systemctl enable rpcbind nfs \n\nsudo chown -R nfsnobody.nfsnobody /opt/nfsdata\n</code></pre> <ol> <li>\u670d\u52a1\u914d\u7f6e</li> </ol> <pre><code>cat &lt;&lt;EOF&gt; /etc/exports\n/opt/nfsdata *(rw,no_root_squash,sync)\nEOF\n\nsudo systemctl reload nfs\n# \u67e5\u770bnfs\u662f\u5426\u6ce8\u518c\u5230rpc\nsudo rpcinfo -p\n# \u67e5\u770b\u53ef\u6302\u8f7d\u8def\u5f84\nsudo showmount -e 10.0.24.5\n\nsudo mount -t nfs 10.0.24.5:/opt/nfsdata\n</code></pre> <ol> <li>\u57fa\u4e8enfs\u521b\u5efaStorageClass</li> </ol> <p>k8s: v1.173</p> <ul> <li> <p>nfs-client.yaml</p> <pre><code>cat &lt;&lt;EOF &gt; nfs-client.yaml\nkind: Deployment\napiVersion: apps/v1\nmetadata:\n  name: nfs-client-provisioner\nspec:\n  selector:\n    matchLabels:\n      app: nfs-client-provisioner\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nfs-client-provisioner\n    spec:\n      serviceAccountName: nfs-client-provisioner\n      containers:\n        - name: nfs-client-provisioner\n          # k8s 1.2.0 \u9700\u8981\u6362\u955c\u50cf\n          # easzlab/nfs-subdir-external-provisioner:v4.0.2\n          image: quay.io/external_storage/nfs-client-provisioner:latest\n          volumeMounts:\n            - name: nfs-client-root\n              mountPath: /persistentvolumes\n          env:\n            - name: PROVISIONER_NAME\n              value: fuseim.pri/ifs\n            - name: NFS_SERVER\n              value: 10.0.24.5\n            - name: NFS_PATH\n              value: /opt/nfsdata\n      volumes:\n        - name: nfs-client-root\n          nfs:\n            server: 10.0.24.5\n            path: /opt/nfsdata\nEOF\n</code></pre> </li> <li> <p>nfs-client-sa.yaml</p> <pre><code>cat &lt;&lt;EOF &gt; nfs-client-sa.yaml\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nfs-client-provisioner\n\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: nfs-client-provisioner-runner\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"endpoints\"]\n    verbs: [\"create\", \"delete\", \"get\", \"list\", \"watch\", \"patch\", \"update\"]\n\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: run-nfs-client-provisioner\nsubjects:\n  - kind: ServiceAccount\n    name: nfs-client-provisioner\n    namespace: default\nroleRef:\n  kind: ClusterRole\n  name: nfs-client-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\nEOF\n</code></pre> </li> <li> <p>nfs-client-storageclass.yaml</p> <pre><code>cat &lt;&lt;EOF &gt; nfs-client-storageclass.yaml\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  annotations:\n    storageclass.kubernetes.io/is-default-class: \"true\"\n  name: nfs\nprovisioner: fuseim.pri/ifs # or choose another name, must match deployment's env PROVISIONER_NAME'\nEOF\n</code></pre> </li> <li> <p>\u542f\u52a8</p> <pre><code>kubectl apply -f .\nkubectl get pod,sc\n</code></pre> </li> </ul>"},{"location":"container/prometheus-outside-k8s-cluster/","title":"prometheus\u96c6\u7fa4\u5916\u76d1\u63a7k8s","text":"<ol> <li>\u521b\u5efak8s\u8d26\u53f7</li> </ol> <p>role</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\nname: prometheus-k8s\nrules:\n- apiGroups:\n- \"\"\nresources:\n- nodes\n- services\n- endpoints\n- pods\n- nodes/proxy\nverbs:\n- get\n- list\n- watch\n- apiGroups:\n- \"\"\nresources:\n- configmaps\n- nodes/metrics\nverbs:\n- get\n- nonResourceURLs:\n- /metrics\nverbs:\n- get\n</code></pre> <p>RoleBinding</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\nname: prometheus-k8s\nroleRef:\napiGroup: rbac.authorization.k8s.io\nkind: ClusterRole\nname: prometheus-k8s\nsubjects:\n- kind: ServiceAccount\nname: prometheus-k8s\nnamespace: default\n</code></pre> <p>serviceAccount</p> <pre><code>apiVersion: v1\nkind: ServiceAccount\nmetadata:\nname: prometheus-k8s\n</code></pre> <ol> <li>\u83b7\u53d6token</li> </ol> <pre><code>kubectl get secret\nprometheus-k8s-token-fcdp6   kubernetes.io/service-account-token   3      5d\nkubectl  get secret prometheus-k8s-token-fcdp6  -o jsonpath={.data.token} | base64 -d\n</code></pre> <ol> <li>\u914d\u7f6eprometheus.yml</li> </ol> <pre><code> - job_name: 'kubernetes-pods'\nkubernetes_sd_configs:\n- role: pod\napi_server: https://192.168.31.16:6443\ntls_config:\nca_file: /etc/kubernetes/ca.crt\nbearer_token_file: /etc/kubernetes/token\nrelabel_configs:\n- action: keep\nregex: true\nsource_labels:\n- __meta_kubernetes_pod_annotation_prometheus_io_scrape\n- action: replace\nregex: (.+)\nsource_labels:\n- __meta_kubernetes_pod_annotation_prometheus_io_path\ntarget_label: __metrics_path__\n- action: replace\nregex: ([^:]+)(?::\\d+)?;(\\d+)\nreplacement: $1:$2\nsource_labels:\n- __address__\n- __meta_kubernetes_pod_annotation_prometheus_io_port\ntarget_label: __address__\n- action: labelmap\nregex: __meta_kubernetes_pod_label_(.+)\n- action: replace\nsource_labels:\n- __meta_kubernetes_namespace\ntarget_label: kubernetes_namespace\n- action: replace\nsource_labels:\n- __meta_kubernetes_pod_name\ntarget_label: kubernetes_pod_name\n</code></pre> <ol> <li>pod\u6dfb\u52a0annotations</li> </ol> <pre><code>metadata:\nlabels:\napp: spring-boot-example\nannotations:\nprometheus.io/path: /actuator/prometheus     #prometheus\u8bbf\u95ee\u7684\u63a5\u53e3\u5730\u5740\nprometheus.io/port: \"8080\"                   #\u670d\u52a1\u7684\u7aef\u53e3\u53f7\nprometheus.io/scrape: \"true\"                 #\u662f\u5426\u5f00\u542fprometheus\u76d1\u63a7\n</code></pre> <ol> <li>docker-compose.yml</li> </ol> <pre><code>version: \"3\"\nservices:\nprometheus:\ncontainer_name: prometheus\nimage: prom/prometheus:master\nuser: root\nvolumes:\n- ./prometheus.yml:/etc/prometheus/prometheus.yml\n- ./data:/prometheus\n- ./kubernetes/ca.crt:/etc/kubernetes/ca.crt\n- ./kubernetes/token:/etc/kubernetes/token\nports:\n- \"9090:9090\"\nrestart: on-failure\n</code></pre>"},{"location":"java/java/","title":"JAVA","text":""},{"location":"java/java/#juc","title":"\u4e00. JUC","text":"<ol> <li> <p>AQS</p> </li> <li> <p>CountDownLatch</p> </li> <li> <p>CyclicBarrier</p> </li> <li> <p>ReadWriteLock</p> </li> <li> <p>Semaphore</p> </li> <li> <p>Exchanger</p> </li> </ol>"},{"location":"java/java/#_1","title":"\u4e8c. \u5355\u4f8b\u6a21\u5f0f","text":"<ol> <li>\u997f\u6c57\u5f0f</li> </ol> <pre><code>public class SingleObject{\nprivate static final SingleObject INSTANCE = new SingleObject();\n\nprivate SingleObject(){}\n\npublic static getInstace(){\nreturn INSTANCE;\n}\n}\n</code></pre> <ol> <li>double checked </li> </ol> <pre><code>public class SingleObject {  private volatile static SingleObject singleton;  private SingleObject (){}  public static SingleObject getSingleton() {  if (singleton == null) {  synchronized (Singleton.class) {  if (singleton == null) {  singleton = new Singleton();  }  }  }  return singleton;  }  }\n</code></pre>"},{"location":"java/java/#_2","title":"\u4e09. \u5f15\u7528\u7c7b\u578b","text":"<pre><code>// -Xms20M -Xmx20M\npublic static void main(String[] args) {\nbyte[] bytes = new byte[1024 * 1024 * 20];\nSystem.out.println(bytes);\n}\n// Exception in thread \"main\" java.lang.OutOfMemoryError: Java heap space\n</code></pre> <pre><code>// -Xms20M -Xmx20M\npublic static void main(String[] args) throws InterruptedException {\nSoftReference&lt;byte[]&gt; softReference = new SoftReference&lt;&gt;(new byte[1024 * 1024 * 10]);\nSystem.out.println(softReference.get());\nSystem.gc();\n\nTimeUnit.MICROSECONDS.sleep(500);\n\nSystem.out.println(softReference.get());\n\nbyte[] bytes = new byte[1024 * 1024 * 10];\n\nSystem.out.println(softReference.get());\n\n}\n//[B@574caa3f\n//[B@574caa3f\n//null\n</code></pre> <pre><code>// -Xms20M -Xmx20M\npublic static void main(String[] args) {\nWeakReference&lt;byte[]&gt; softReference = new WeakReference&lt;&gt;(new byte[1024 * 1024 * 10]);\nSystem.out.println(softReference.get());\nSystem.gc();\nSystem.out.println(softReference.get());\n}\n//[B@574caa3f\n//null\n</code></pre> <p>ThreadLocal</p> <ul> <li>key\u5e94\u7528\u5b58\u5728\u5185\u5b58\u6cc4\u6f0f\u7528\u865a\u5f15\u7528\u89e3\u51b3</li> <li> <p>value\u8fd8\u662f\u5b58\u5728\u5185\u5b58\u6cc4\u6f0f\uff0cThreadLocal\u7528\u5b8c\u9700\u8981\u5220\u9664\u5bf9\u8c61</p> </li> <li> </li> </ul> <pre><code> public static void main(String[] args) throws InterruptedException {\n\nReferenceQueue&lt;byte[]&gt; queue = new ReferenceQueue&lt;&gt;();\nPhantomReference&lt;byte[]&gt; softReference = new PhantomReference(new byte[1024 * 1024 * 10], queue);\nwhile (true) {\nReference&lt;? extends byte[]&gt; poll = queue.poll();\nif (poll != null) {\nSystem.out.println(\"gc \u901a\u77e5\");\n}\n}\n}\n</code></pre>"},{"location":"java/java/#_3","title":"\u5f3a\u5f15\u7528  \u5185\u5b58\u4e0d\u591f\u5185\u5b58\u6ea2\u51fa","text":""},{"location":"java/java/#_4","title":"\u8f6f\u5f15\u7528  \u5185\u5b58\u4e0d\u591f\u88ab\u56de\u6536","text":""},{"location":"java/java/#gc","title":"\u5f31\u5f15\u7528 GC \u53d1\u751f\u88ab\u56de\u6536","text":""},{"location":"java/java/#_5","title":"\u865a\u5f15\u7528 \u83b7\u53d6\u4e0d\u5230\u503c \u00a0\u4f7f\u7528\u573a\u666f\u5806\u5916\u5185\u5b58","text":""},{"location":"java/java/#_6","title":"\u56db. \u7ebf\u7a0b","text":"<ol> <li> <p>\u7ee7\u627fThread</p> </li> <li>\u7ee7\u627fRunable</li> <li> <p>\u7ee7\u627fCallbable</p> </li> <li> </li> </ol> <pre><code> public enum State {\nNEW,               // \u7ebf\u7a0b\u521d\u59cb\u5316\uff0c\u6ca1\u6709\u542f\u52a8\nRUNNABLE,          // \u53ef\u8fd0\u884c\u72b6\u6001  1. running  2.Read\nBLOCKED,       // \u88ab\u963b\u585e synchronized  \nWAITING,      // \u7b49\u5f85\u5524\u9192 o.wait() t.join() LockSupport.park() Lock.lock()\nTIMED_WAITING // \u7b49\u5f85\u65f6\u95f4\u5524\u9192  Thread.sleep(time) o.wait(time) t.json(time)....\nTERMINATED;   // \u7ebf\u7a0b\u7ed3\u675f\n}\n</code></pre> <ol> <li>\u53ef\u89c1\u6027\uff0c\u6709\u5e8f\u6027 \uff0c\u539f\u5b50\u6027</li> </ol>"},{"location":"java/java/#_7","title":"\u521b\u5efa\u7ebf\u7a0b\u7684\u65b9\u6cd5","text":""},{"location":"java/java/#_8","title":"\u7ebf\u7a0b\u72b6\u6001","text":""},{"location":"java/java/#_9","title":"\u4e94. \u7ebf\u7a0b\u6c60","text":"<p>\u200b    \\(N_{threads}=N_{cpu} *U_{cpu} * (1 + W/C)\\) </p> <p>\u200b    \u9884\u4f30\u7ebf\u7a0b= cpu\u6838\u6570 \u4f7f\u7528\u7387\uff081 + \u7b49\u5f85\u7684\u65f6\u95f4/\u8ba1\u7b97\u7684\u65f6\u95f4\uff09</p> <p>\u200b     2 = 1 * 100%  *\uff081+0.5/0.5\uff09</p> <ol> <li> <p>corePoolSize</p> </li> <li>maximumPoolSize</li> <li>keepAliveTime</li> <li>TimeUnit</li> <li>BlockingQueue</li> <li>ThreadFactory</li> <li> <p>RejectedExecutionHandler</p> <ol> <li>Abort: \u629b\u5f02\u5e38</li> <li>Discard\uff1a\u6254\u6389</li> <li>DiscardOldest\uff1a\u6254\u6389\u6392\u961f\u65f6\u95f4\u6700\u4e45\u7684</li> <li>CalleRuns\uff1a\u8c03\u7528\u8005\u5904\u7406\u4efb\u52a1</li> </ol> <p></p> </li> <li> </li> </ol> <pre><code>\u5de6\u5b69\u5b50\u7684\u7d22\u5f15\u662f 2*n+1\n\u53f3\u5b69\u5b50\u7684\u7d22\u5f15\u662f 2*n+2\n\u7236\u8282\u70b9\u7684\u7d22\u5f15\u662f (n - 1) / 2\n</code></pre> <p></p> <ol> <li> </li> </ol>"},{"location":"java/java/#threadpoolexecutor","title":"ThreadPoolExecutor","text":""},{"location":"java/java/#sheduledthreadpollexecutor","title":"SheduledThreadPollExecutor","text":""},{"location":"java/java/#forkjoinpool","title":"ForkJoinPool","text":""},{"location":"java/jvm/","title":"JVM","text":""},{"location":"java/jvm/#1-classfile","title":"1. ClassFile \u7ed3\u6784","text":"<pre><code>ClassFile {\n \u00a0 \u00a0u4 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 magic;\n \u00a0 \u00a0u2 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 minor_version;\n \u00a0 \u00a0u2 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 major_version;\n \u00a0 \u00a0u2 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 constant_pool_count;\n \u00a0 \u00a0cp_info \u00a0 \u00a0 \u00a0 \u00a0constant_pool[constant_pool_count-1];\n \u00a0 \u00a0u2 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 access_flags;\n \u00a0 \u00a0u2 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 this_class;\n \u00a0 \u00a0u2 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 super_class;\n \u00a0 \u00a0u2 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 interfaces_count;\n \u00a0 \u00a0u2 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 interfaces[interfaces_count];\n \u00a0 \u00a0u2 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 fields_count;\n \u00a0 \u00a0field_info \u00a0 \u00a0 fields[fields_count];\n \u00a0 \u00a0u2 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 methods_count;\n \u00a0 \u00a0method_info \u00a0 \u00a0methods[methods_count];\n \u00a0 \u00a0u2 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 attributes_count;\n \u00a0 \u00a0attribute_info attributes[attributes_count];\n}\n</code></pre> <ul> <li> <p>constant_pool</p> <pre><code>cp_info {\n    u1 tag;\n    u1 info[];\n}\n</code></pre> </li> <li> <p>fields</p> <pre><code>field_info {\n    u2             access_flags;\n    u2             name_index;\n    u2             descriptor_index;\n    u2             attributes_count;\n    attribute_info attributes[attributes_count];\n}\n</code></pre> </li> <li> <p>methods</p> <pre><code>method_info { \u00a0\n  u2 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 access_flags; \u00a0\n  u2 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 name_index; \u00a0\n  u2 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 descriptor_index; \u00a0\n  u2 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 attributes_count; \u00a0  \n  attribute_info attributes[attributes_count];\n}\n</code></pre> </li> <li> <p>attributes</p> <pre><code>attribute_info { \u00a0 \n u2 attribute_name_index; \u00a0 \n u4 attribute_length; \u00a0  \n u1 info[attribute_length];\n}\n</code></pre> </li> </ul>"},{"location":"java/jvm/#2-","title":"2. \u7c7b\u52a0\u8f7d-\u9a8c\u8bc1-\u521d\u59cb\u5316","text":"<ul> <li> <p>Classloadr</p> <pre><code>public class Launcher {\n// BootClassPathHolder\nprivate static String bootClassPath = System.getProperty(\"sun.boot.class.path\");\n// AppClassLoader\nfinal String var1 = System.getProperty(\"java.class.path\");\n// ExtClassLoader\nString var0 = System.getProperty(\"java.ext.dirs\");\n}\n</code></pre> </li> <li></li> </ul>"},{"location":"java/jvm/#3-jmm","title":"3. JMM","text":"<p>**MESI-intel\uff08\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\uff09**</p> <p>\u4efb\u610f\u4e00\u5bf9\u7f13\u5b58\uff0c\u5bf9\u5e94\u7f13\u5b58\u884c\u7684\u76f8\u5bb9\u5173\u7cfb</p> <p>MESI</p>"},{"location":"java/jvm/#cache-line","title":"cache line","text":"<pre><code>|M/E/S/I\uff082\u4f4d\uff09 | cache line data |\n</code></pre>"},{"location":"java/jvm/#4","title":"4. \u8fd0\u884c\u6570\u636e\u533a","text":"<ul> <li>\u672c\u5730\u65b9\u6cd5\u6808\uff08Native Method Stack\uff09<ul> <li>\u672c\u5730\u65b9\u6cd5\u901a\u8fc7JNI\u8bbf\u95ee\u865a\u62df\u673a\u8fd0\u884c\u65f6\u7684\u6570\u636e\u533a</li> </ul> </li> <li>\u7a0b\u5e8f\u8ba1\u6570\u5668\uff08PC\uff09<ul> <li>\u8bb0\u5f55\u7a0b\u5e8f\u6267\u884c\u4f4d\u7f6e</li> </ul> </li> <li> <p>\u865a\u62df\u673a\u6808\uff08JVM Stack\uff09</p> <p>Frame - \u65b9\u6cd5\u6808\u9488\uff08main\u65b9\u6cd5\uff09</p> <ul> <li>\u5c40\u90e8\u5411\u91cf\u8868\uff08Local Variable Table\uff09</li> <li>\u64cd\u4f5c\u6808\uff08Operand Stack\uff09</li> <li>\u52a8\u6001\u94fe\u63a5\uff08Dynamic Linking\uff09</li> <li>\u8fd4\u56de\u5730\u5740\uff08return address\uff09</li> <li>\u5806\u533a(Heap)</li> <li>\u5bf9\u8c61\u5b9e\u4f8b</li> <li>\u5143\u7a7a\u95f4(Metaspace)</li> <li>\u5143\u6570\u636e-class</li> <li>\u5b57\u7b26\u5e38\u91cf\u6c601.7 \u6c38\u4e45\u4ee3\uff0c1.8 \u5806</li> </ul> </li> </ul>"},{"location":"java/jvm/#5-gc","title":"5. GC\u5e38\u7528\u7b97\u6cd5\u548c\u6536\u96c6\u5668","text":"<ul> <li>\u5bfb\u627e\u5783\u573e<ol> <li>\u5f15\u7528\u8ba1\u7b97\uff08\u4e0d\u80fd\u89e3\u51b3\u5faa\u73af\u5f15\u7528\uff09</li> <li>\u6839\u53ef\u8fbe<ul> <li>GC Roots<ol> <li>\u865a\u62df\u673a\u6808(\u6808\u6862\u4e2d\u672c\u5730\u53d8\u91cf\u8868)\u4e2d\u5f15\u7528\u7684\u5bf9\u8c61</li> <li>\u9759\u6001\u53d8\u91cf\u5f15\u7528\u7684\u5bf9\u8c61</li> <li>\u5e38\u91cf\u5f15\u7528\u7684\u5bf9\u8c61</li> <li>JNI\u5f15\u7528\u7684\u5bf9\u8c61</li> </ol> </li> </ul> </li> </ol> </li> <li>GC\u5e38\u7528\u7b97\u6cd5<ol> <li>\u6807\u8bb0\u6e05\u9664\uff08Mark-Sweep\uff09</li> <li>\u62f7\u8d1d\uff08copying\uff09</li> <li>\u6807\u8bb0\u538b\u7f29\uff08Mark-Compact\uff09</li> </ol> </li> </ul>"},{"location":"java/jvm/#6","title":"6. \u5e38\u89c1\u5783\u573e\u6536\u96c6\u5668","text":"<ul> <li> <p>Serial \u5e74\u8f7b\u4ee3  \u4e32\u884c\u56de\u6536</p> <p></p> </li> <li> <p>Parallel Scavenge\u5e74\u8f7b\u4ee3   \u5e76\u884c\u56de\u6536</p> <p></p> </li> <li> <p>SerialOld</p> </li> <li>ParallelOld</li> <li>ParNew(Parallel Scavenge\u589e\u5f3a\u914d\u5408CMS\u4f7f\u7528)</li> <li> <p>CMS(ConcurrentMarkSweep )</p> <p></p> <p>\u95ee\u9898</p> <ol> <li>\u5185\u5b58\u7684\u788e\u7247\u5316</li> <li>\u6d6e\u52a8\u5783\u573e</li> <li>G1</li> </ol> <p></p> <p></p> <p>\u4e09\u8272\u6807\u8bb0</p> <ol> <li>\u9ed1\u8272\u6807\u8bb0\uff08\u81ea\u5df1\u5df2\u7ecf\u6807\u8bb0\uff0cfields\u90fd\u6807\u8bb0\u5b8c\u6210\uff09</li> <li>\u7070\u8272\u6807\u8bb0\uff08\u81ea\u5df1\u5df2\u7ecf\u6807\u8bb0\uff0cfields\u8fd8\u6ca1\u6709\u6807\u8bb0\uff09</li> <li>\u767d\u8272\u6807\u8bb0\uff08\u8fd8\u6ca1\u6709\u6807\u8bb0\u5b8c\u6210\uff09</li> </ol> <p>YGC Mixed GC FULL GC</p> <p>STAB</p> </li> <li> <p>ZGC</p> </li> <li> <p>Shenandoah</p> <p>\u9ed8\u8ba4 PS + ParallelOld</p> <p>\u5e38\u7528\u5783\u573e\u6536\u7ec4\u5408</p> </li> <li> <p>\u9ed8\u8ba4GC\u67e5\u770b</p> <ul> <li>-XX:+PrintCommandLineFlags -version</li> <li>-XX:+PrintGC</li> </ul> </li> <li>\u8c03\u4f18<ul> <li>\u541e\u5410\u91cf\uff1a\u7528\u6237\u7a0b\u5e8f\u65f6\u95f4/(\u7528\u6237\u7a0b\u5e8f\u7684\u65f6\u95f4+ \u5783\u573e\u56de\u6536\u65f6\u95f4)</li> <li>\u54cd\u5e94\u65f6\u95f4\uff1a\u5783\u573e\u56de\u6536\u65f6\u95f4\u8d8a\u77ed\u3002</li> </ul> </li> </ul>"},{"location":"java/jvm/#7","title":"7. \u5e38\u7528\u547d\u4ee4\u5206\u6790","text":"<ul> <li> <p>CUP</p> <ol> <li> <p>\u5148\u6267\u884ctop \uff0c\u627e\u5230CPU\u5360\u7528\u6bd4\u8f83\u9ad8\u7684\u8fdb\u7a0b</p> <pre><code>top\n</code></pre> </li> <li> <p>jstack \u8fdb\u7a0bID</p> <pre><code>jstack \u8fdb\u7a0bID  &gt;show.txt\n</code></pre> </li> <li> <p>\u627e\u5230\u7ecf\u5e38\u4e2dcpu\u5360\u7528\u6bd4\u8f83\u9ad8\u7684\u7ebf\u7a0b\uff0c\u7ebf\u7a0bId\u8f6c\u4e3a16\u8fdb\u5236</p> <pre><code>top  -Hp \u8fdb\u7a0bID ## \u67e5\u770b\u8fdb\u7a0b\u4e2d\u7684\u7ebf\u7a0b\u60c5\u51b5\n</code></pre> </li> <li> <p>\u901a\u8fc7\u7ebf\u7a0bID\u67e5\u627e\u7ebf\u7a0b\u60c5\u51b5</p> </li> <li>\u5185\u5b58</li> <li> <p>\u67e5\u770bmap</p> <pre><code>jmap -histo pid | head - number\n</code></pre> </li> <li> <p>dump</p> <pre><code>jmap -dump:format=b,file=/var/logs/heap.hprof pid\n</code></pre> </li> </ol> </li> <li> <p>\u8fdb\u7a0b\u53c2\u6570</p> <pre><code>jinfo \u8fdb\u7a0bID\n</code></pre> </li> <li> <p>\u76d1\u63a7gc\u4fe1\u606f</p> <pre><code>jstack -gc \u8fdb\u7a0bID \u6beb\u79d2\n</code></pre> </li> <li> <p>jconsole\u8fdc\u7a0b\u8fde\u63a5</p> <pre><code>-Djava.rmi.server.hostname=192.160.0.8 #\u8fdc\u7a0b\u670d\u52a1\u5668ip\uff0c\u5373\u672c\u673aip\n-Dcom.sun.management.jmxremote #\u5141\u8bb8JMX\u8fdc\u7a0b\u8c03\u7528\n-Dcom.sun.management.jmxremote.port=5000 #\u81ea\u5b9a\u4e49jmx \u7aef\u53e3\u53f7\n-Dcom.sun.management.jmxremote.ssl=false # \u662f\u5426\u9700\u8981ssl \u5b89\u5168\u8fde\u63a5\u65b9\u5f0f\n-Dcom.sun.management.jmxremote.authenticate=false #\u662f\u5426\u9700\u8981\u79d8\u94a5\n\n#spring boot \nENV JAVA_TOOL_OPTIONS \"-Dcom.sun.management.jmxremote.ssl=false \\\n -Dcom.sun.management.jmxremote.authenticate=false \\\n -Dcom.sun.management.jmxremote.port=5000 \\\n -Dcom.sun.management.jmxremote.rmi.port=5000 \\\n -Dcom.sun.management.jmxremote.host=0.0.0.0 \\\n -Djava.rmi.server.hostname=0.0.0.0\"`\n</code></pre> </li> <li> <p>jprofiler(\u6536\u8d39)</p> <p>Java Profiler - JProfiler</p> </li> <li></li> </ul>"},{"location":"java/jvm/#8","title":"8. \u53c2\u6570","text":"<ul> <li> <p>GC\u5e38\u7528\u53c2\u6570</p> <pre><code># \u5e74\u8f7b\u4ee3 \u6700\u5c0f\u5806 \u6700\u5927\u5806 \u6808\u7a7a\u95f4\n-Xmn -Xms -Xmx -Xss\n# \u4f7f\u7528TLAB \u9ed8\u8ba4\u6253\u5f00\n-XX:+UseTLAB\n# \u6253\u5370TLAB\u4f7f\u7528\u60c5\u51b5\n-XX:+PrintTLAB\n# \u8bbe\u7f6eTLAB\u5927\u5c0f\n-XX:TLABSize \n# \u7981\u7528FGC\n-XX:+DisableExplictGC\n# \u6253\u5370GC\u4fe1\u606f\n-XX:+PrintGC\n# \u6253\u5370GC\u8be6\u7ec6\u4fe1\u606f\n-XX:+PrintGCDetails\n# GC \u6253\u5370\u5806\u6808\u60c5\u51b5\n-XX:+PrintHeapAtGC\n# \u6253\u5370JVM\u53c2\u6570\n-XX:+PrintVMOptions\n# \u521d\u59cb\u5316\u7684\u9ed8\u8ba4\u503c\njava -XX:+PrintFlagsFinal +XX:+PrintFlagsInitial\n# GC \u65e5\u5fd7\u6587\u4ef6\n-Xloggc:opt/log/gc.log\n# GC \u5347\u7ea7\u4ee3\u5e74\u9f84,\u6700\u5927\u503c15\n-XX:MaxTenuringThreshold=15\n</code></pre> </li> <li> <p>Parallel\u5e38\u7528\u53c2\u6570</p> <pre><code># Survivor(2\u4e2a)\u4e0eEden\u533a\u7684\u5927\u5c0f\u6bd4\u503c 2:8\n-XX:SurvivorRation=8\n</code></pre> </li> <li> <p>G1\u5e38\u7528\u53c2\u6570</p> <pre><code>-XX:+UseG1GC\n# \u8bbe\u7f6eG1\u6536\u96c6\u8fc7\u7a0b\u76ee\u6807\u65f6\u95f4\uff0c\u9ed8\u8ba4\u503c200ms\uff0c\u4e0d\u662f\u786c\u6027\u6761\u4ef6\n-XX:MaxGCPauseMillis \n# \u8bbe\u7f6eRegion\u5927\u5c0f\uff0c\u5e76\u975e\u6700\u7ec8\u503c 1M,2M,3M,4M,8M,16M,32M \n-XX:G1HeapRegionSize=n\n# \u65b0\u751f\u4ee3\u6700\u5c0f\u503c\uff0c\u9ed8\u8ba4\u503c5%\n-XX:G1NewSizePercent\n# \u65b0\u751f\u4ee3\u6700\u5927\u503c\uff0c\u9ed8\u8ba4\u503c60%\n-XX:G1MaxNewSizePercent\n# STW\u671f\u95f4\uff0c\u5e76\u884cGC\u7ebf\u7a0b\u6570\n-XX:ParallelGCThreads\n# \u5e76\u53d1\u6807\u8bb0\u9636\u6bb5\uff0c\u5e76\u884c\u6267\u884c\u7684\u7ebf\u7a0b\u6570\n-XX:ConcGCThreads=n\n# \u8bbe\u7f6e\u89e6\u53d1\u6807\u8bb0\u5468\u671f\u7684 Java \u5806\u5360\u7528\u7387\u9608\u503c\u3002\u9ed8\u8ba4\u503c\u662f45%\u3002\u8fd9\u91cc\u7684java\u5806\u5360\u6bd4\u6307\u7684\u662fnon_young_capacity_bytes\uff0c\u5305\u62ecold+humongous\n-XX:InitiatingHeapOccupancyPercent\n</code></pre> </li> </ul>"},{"location":"java/jvm/#9","title":"9. \u5f15\u7528","text":"<p>Getting Started with the G1 Garbage Collector</p> <p>Java Hotspot G1 GC\u7684\u4e00\u4e9b\u5173\u952e\u6280\u672f</p>"},{"location":"java/synchronized/","title":"Synchronized","text":"<p>\u200b        Synchronized \u4f7f\u7528\u76d1\u89c6\u5668\u5b9e\u73b0\u7684\u3002Java\u4e2d\u7684\u6bcf\u4e2a\u5bf9\u8c61\u90fd\u4e0e\u4e00\u4e2a\u76d1\u89c6\u5668\u5173\u8054,\u7ebf\u7a0b\u53ef\u4ee5\u9501\u5b9a\u548c\u89e3\u9501\u76d1\u89c6\u5668\u3002\u4e00\u6b21\u53ea\u80fd\u6709\u4e00\u4e2a\u7ebf\u7a0b\u5728\u76d1\u89c6\u5668\u4e0a\u4fdd\u6301\u9501\u3002\u4efb\u4f55\u5176\u4ed6\u8bd5\u56fe\u9501\u5b9a\u8be5\u76d1\u89c6\u5668\u7684\u7ebf\u7a0b\u90fd\u5c06\u88ab\u963b\u6b62\uff0c\u76f4\u5230\u5b83\u4eec\u53ef\u4ee5\u5728\u8be5\u76d1\u89c6\u5668\u4e0a\u83b7\u5f97\u9501\u5b9a\u4e3a\u6b62\u3002</p> \u9501\u7684\u5bf9\u8c61 \u5177\u4f53\u4f4d\u7f6e \u4f2a\u4ee3\u7801 Object \u65b9\u6cd5 public synchronized void method() {   ......   } \u4ee3\u7801\u5757 public void method() {   synchronized (this) {  ......   } } \u4ee3\u7801\u5757 public void method() {   synchronized (object) { ......  } } Class \u65b9\u6cd5 public static synchronized void method() {  ......} \u4ee3\u7801\u5757 public void method() {     synchronized (SynchronizedDemo.class) {  ......   } } <ol> <li> <p>\u67e5\u770b\u65b9\u6cd5\u4e0a\u7684\u9501\uff0c\u901a\u8fc7\u53cd\u7f16\u8bd1\u67e5\u770b\u5b57\u8282\u7801</p> <pre><code>    public int i = 0;\n\npublic synchronized void add() {\ni++;\n}\n</code></pre> <pre><code>  public synchronized void add();\n    descriptor: ()V\n    flags: ACC_PUBLIC, ACC_SYNCHRONIZED\n    Code:\n      stack=3, locals=1, args_size=1\n         0: aload_0\n         1: dup\n         2: getfield      #2                  // Field i:I\n         5: iconst_1\n         6: iadd\n         7: putfield      #2                  // Field i:I\n        10: return\n</code></pre> <p>flags\u91cc\u9762\u6709\u4e00\u4e2a<code>ACC_SYNCHRONIZED</code>\u6807\u5fd7,\u8fd9\u4e2a\u6807\u8bc6\u8868\u793aJVM\u662f\u540c\u6b65\u65b9\u6cd5</p> </li> <li> <p>\u540c\u6b65\u4ee3\u7801\u5757\u7684\u9501</p> <pre><code>public int i = 0;\npublic void decrement() {\nsynchronized (this) {\ni--;\n}\n}\n</code></pre> <pre><code>  public void decrement();\n    descriptor: ()V\n    flags: ACC_PUBLIC\n    Code:\n      stack=3, locals=3, args_size=1\n         0: aload_0\n         1: dup\n         2: astore_1\n         3: monitorenter\n         4: aload_0\n         5: dup\n         6: getfield      #2                  // Field i:I\n         9: iconst_1\n        10: isub\n        11: putfield      #2                  // Field i:I\n        14: aload_1\n        15: monitorexit\n        16: goto          24\n        19: astore_2\n        20: aload_1\n        21: monitorexit\n        22: aload_2\n        23: athrow\n        24: return\n</code></pre> <p>\u540c\u6b65\u65b9\u6cd5\u4f7f\u7528\u4e86 monitorenter\u4e0a\u9501\uff0cmonitorexit\u89e3\u9501 \u7b2c\u4e8c\u4e2amonitorexit\u662f\u629b\u51fa\u5f02\u5e38\u540e\u89e3\u9501</p> </li> <li> </li> </ol> JAVA\u5b9e\u4f8b\u5bf9\u8c61 \u5bf9\u8c61\u5934 mark word \u9501,\u5e74\u9f84,hashcode,\u7ebf\u7a0bID ... klass word 32\u4f4d\u5b58\u653e32bit64\u4f4d\u9ed8\u8ba4\u5f00\u542f\u6307\u9488\u538b\u7f29\u662f32bit \u4e0d\u5f00\u542f\u662f64bit    \u5f00\u542f -XX:+UseCompressedOops \u5173\u95ed -XX:-UseCompressedOops \u5b9e\u4f8b\u6570\u636e Java\u81ea\u5b9a\u4e49\u5b57\u6bb5\uff0c\u53c2\u6570\u7c7b\u578b\u7684\u957f\u5ea6 \u5bf9\u9f50\u586b\u5145 \u5bf9\u8c61\u95f4\u9ed8\u8ba4\u6309\u71678byte\u5bf9\u9f50\uff0c\u5bf9\u9f50\u5219\u4e0d\u9700\u8981padding\uff0c\u5426\u5219\u9700\u8981padding\u8865\u51458byte\u5bf9\u9f50 <pre><code>\n</code></pre> <ul> <li>"},{"location":"java/synchronized/#_1","title":"\u7528\u6cd5","text":""},{"location":"java/synchronized/#_2","title":"\u9501\u7684\u5b9e\u73b0","text":""},{"location":"java/synchronized/#java","title":"Java\u5bf9\u8c61\u4fe1\u606f","text":""},{"location":"java/synchronized/#ordinary-object-pointersoops","title":"Ordinary Object Pointers\uff08OOPs\uff09\u666e\u901a\u5bf9\u8c61\u6307\u9488","text":"<p>oopDesc \u4f7f\u7528\u4e86\u4ee5\u4e0b\u4fe1\u606f\u63cf\u8ff0\u6307\u9488:</p> <pre><code>class oopDesc {\nfriend class VMStructs;\nprivate:\n// mark word\nvolatile markOop  _mark;\n// klass word\nunion _metadata {\nKlass*      _klass;\nnarrowKlass _compressed_klass;\n} _metadata;\n</code></pre> <pre><code>#### 64\u4f4d mark word \u683c\u5f0f\u5982\u4e0b\uff1a\n</code></pre> <p> \u9501\u72b6\u6001 57bit 4bit 1bit 2bit 25bit 29bit 2bit 1bit \u662f\u5426\u504f\u5411\u9501 \u9501\u6807\u8bc6\u4f4d \u65e0\u9501 25\u4f4d\u672a\u4f7f\u7528 31\u4f4dhasecode 1\u4f4d\u672a\u4f7f\u7528 \u5bf9\u8c61\u7684\u5206\u5e26\u5e74\u9f84 0 01 \u504f\u5411\u9501 54\u4f4d\u7ebf\u7a0bID 2\u4f4depoch 1\u4f4d\u672a\u4f7f\u7528 \u5bf9\u8c61\u5206\u5e26\u5e74\u9f84 1 01 \u8f7b\u91cf\u7ea7\u9501 \u6307\u5411\u6808\u4e2d\u8bb0\u5f55\u7684\u6307\u948862\u4f4d 00&lt;/td         \u91cd\u91cf\u7ea7\u9501 \u6307\u5411\u91cd\u91cf\u7ea7\u9501\u7684\u6307\u948862\u4f4d 10 GC\u6807\u8bb0 \u7a7a 11 <p>\u200b               ObjectMonitor::wait</p> <p>\u200b               ObjectMonitor::notify</p> <p>\u200b               ObjectMonitor::notifyAll</p> <p>\u53c2\u8003:</p> <p>https://github.com/farmerjohngit/myblog/issues/15</p> <p>https://www.baeldung.com/java-memory-layout</p> <p>https://docs.oracle.com/javase/specs/jvms/se8/html/index.html</p>"},{"location":"java/synchronized/#_3","title":"\u9501\u4f18\u5316","text":"<p>\u9501\u72b6\u6001\u8f6c\u6362\u7684\u6d41\u7a0b\u56fe: </p> <p></p>"},{"location":"java/synchronized/#lock-record","title":"Lock Record\uff08\u9501\u8bb0\u5f55\uff09","text":"<p>\u5f53\u5b57\u8282\u7801\u89e3\u91ca\u5668\u6267\u884c monitorenter \u5b57\u8282\u7801\u8f7b\u91cf\u7ea7\u9501\u9501\u4f4f\u4e00\u4e2a\u5bf9\u8c61\u65f6\uff0c\u5c31\u4f1a\u5728\u83b7\u53d6\u9501\u7684\u7ebf\u7a0b\u7684\u6808\u4e0a\u663e\u5f0f\u6216\u8005\u9690\u5f0f\u5206\u914d\u4e00\u4e2a Lock Record \u7a7a\u95f4\u3002</p> <pre><code>  class BasicLock VALUE_OBJ_CLASS_SPEC {\nfriend class VMStructs;\nprivate:\nvolatile markOop _displaced_header;  // \u88ab\u9501\u7684\u5bf9\u8c61\u5934\u4fe1\u606f\n}\nclass BasicObjectLock VALUE_OBJ_CLASS_SPEC {\nfriend class VMStructs;\nprivate:\nBasicLock _lock;\noop       _obj; // \u6301\u6709\u9501\u7ebf\u7a0b\u5bf9\u8c61   \n}\n</code></pre> <p></p>"},{"location":"java/synchronized/#_4","title":"\u504f\u5411\u9501","text":"<p>\u200b     \u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u9501\u4e0d\u4ec5\u4e0d\u5b58\u5728\u591a\u7ebf\u7a0b\u7ade\u4e89\uff0c\u800c\u4e14\u603b\u662f\u7531\u540c\u4e00\u7ebf\u7a0b\u591a\u6b21\u83b7\u5f97\uff0c\u4e3a\u4e86\u8ba9\u7ebf\u7a0b\u83b7\u5f97\u9501\u7684\u4ee3\u4ef7\u66f4\u4f4e\uff0c\u5f15\u8fdb\u4e86\u504f\u5411\u9501</p> <pre><code>#\u504f\u5411\u9501\u9ed8\u8ba4\u662f\u5728\u7a0b\u5e8f\u542f\u52a84\u79d2\u540e\u624d\u6fc0\u6d3b\uff0c\n#\u5f00\u542f\u504f\u5411\u9501 \n-XX:+UseBiasedLocking -XX:BiasedLockingStartupDelay=0 \n#\u5173\u95ed\u53d8\u5411\u9501\n-XX:-UseBiasedLocking\n</code></pre> <pre><code> #####  \u504f\u5411\u9501\u7684\u83b7\u53d6 [bytecodeInterpreter.cpp](https://github.com/openjdk/jdk8u/blob/4a4236a366eeb961baf157f0938634c1647c447f/hotspot/src/share/vm/interpreter/bytecodeInterpreter.cpp#L1814)\n</code></pre> <pre><code>CASE(_monitorenter): {\n// \u9501\u5bf9\u8c61\noop lockee = STACK_OBJECT(-1);\n// \u83b7\u53d6\u9501\u8bb0\u5f55\nBasicObjectLock* limit = istate-&gt;monitor_base();\nBasicObjectLock* most_recent = (BasicObjectLock*) istate-&gt;stack_base();\nBasicObjectLock* entry = NULL;\nwhile (most_recent != limit ) {\nif (most_recent-&gt;obj() == NULL) entry = most_recent;\nelse if (most_recent-&gt;obj() == lockee) break;\nmost_recent++;\n}\n// \u6210\u529f\u5206\u914d\u4e00\u4e2alock record\nif (entry != NULL) {\n// \u5c06lock record\u7684Object \u6307\u9488\u6307\u5411\u9501\u5bf9\u8c61\nentry-&gt;set_obj(lockee);\nint success = false;\n// \u8bfb\u53d6class\u4e2d\u7684epoch\u503c\nuintptr_t epoch_mask_in_place =(uintptr_t)markOopDesc::epoch_mask_in_place;\n// \u5bf9\u8c61\u7684mark word\nmarkOop mark = lockee-&gt;mark();\nintptr_t hash = (intptr_t) markOopDesc::no_hash;\n// \u5982\u679c\u9501\u5bf9\u8c61\u662f\u504f\u5411\u6a21\u5f0f\nif (mark-&gt;has_bias_pattern()) {\nuintptr_t thread_ident;\nuintptr_t anticipated_bias_locking_value;\nthread_ident = (uintptr_t)istate-&gt;thread();\n// \u5224\u65ad\u662f\u5426\u83b7\u53d6\u504f\u5411\u9501\n// (uintptr_t)lockee-&gt;klass()-&gt;prototype_header() \n// class \u5bf9\u8c61\u5934\u4fe1\u606f\n// \u504f\u5411     epoch            \u7ebf\u7a0bID\n// 00000101 00000001 00000000 ... 00000000  klass\u7684\u5bf9\u8c61\u5934\n// 00000101 00000001 10010001 ... 10010001  or \u7ebf\u7a0bID\n// 00001101 00000001 10010001 ... 10010001  \u5b9e\u4f8b\u5bf9\u8c61\u5934\n// 00001000 00000000 00000000 ... 00000000  \u5f02\u6216\u64cd\u4f5c\u53ea\u5269\u5206\u5e26\u5e74\u9f84\n// 01110000 00000000 00000000 ... 00000000  \u5e74\u9f84\u53bband \n// 00000000 00000000 00000000 ... 00000000  \u7ebf\u7a0b\u76f8\u540c\u6700\u7ec8\u8fd4\u56de\u6210\u529f\nanticipated_bias_locking_value =\n(((uintptr_t)lockee-&gt;klass()-&gt;prototype_header() | thread_ident) ^ (uintptr_t)mark) &amp;\n~((uintptr_t) markOopDesc::age_mask_in_place);\n// \u5df2\u504f\u5411\u5f53\u524d\u7ebf\u7a0b \u6210\u529f\u83b7\u53d6\u504f\u5411\u9501\nif  (anticipated_bias_locking_value == 0) {\nsuccess = true;\n}\n// \u5982\u679c\u504f\u5411\u6a21\u5f0f\u5173\u95ed\uff0c\u5219\u5c1d\u8bd5\u64a4\u9500\u504f\u5411\u9501\nelse if((anticipated_bias_locking_value&amp;\nmarkOopDesc::biased_lock_mask_in_place)  != 0) { ........\n}\n// \u5982\u679cepoch\u4e0d\u7b49\u4e8eclass\u4e2d\u7684epoch\uff0c\u5219\u5c1d\u8bd5\u91cd\u504f\u5411\nelse if ((anticipated_bias_locking_value &amp; epoch_mask_in_place) !=0)              { .......\n} else {\n// \u533f\u540d\u504f\u5411\u7684mark word\uff0c\u5c1d\u8bd5\u7528CAS\u6307\u4ee4\u66ff\u6362\u6389\u9501\u5bf9\u8c61\u7684mark word\nmarkOop header = (markOop) ((uintptr_t) mark &amp;((uintptr_t)markOopDesc::biased_lock_mask_in_place |(uintptr_t)markOopDesc::age_mask_in_place | epoch_mask_in_place));\nif (hash != markOopDesc::no_hash) {\nheader = header-&gt;copy_set_hash(hash);\n}\n// \u884c\u7684\u5bf9\u8c61\u5934\u4fe1\u606f\nmarkOop new_header = (markOop) ((uintptr_t) header | thread_ident);\n// \u66ff\u6362\u5bf9\u8c61\u5934\u4fe1\u606f\nif (Atomic::cmpxchg_ptr((void*)new_header, lockee-&gt;mark_addr(), header) == header) {\nif (PrintBiasedLockingStatistics)\n(* BiasedLocking::anonymously_biased_lock_entry_count_addr())++;\n}\nelse {\n// \u5982\u679c\u4fee\u6539\u5931\u8d25\u8bf4\u660e\u5b58\u5728\u591a\u7ebf\u7a0b\u7ade\u4e89\uff0c\u6240\u4ee5\u8fdb\u5165monitorenter\u65b9\u6cd5\nCALL_VM(InterpreterRuntime::monitorenter(\nTHREAD, entry),handle_exception);\n}\nsuccess = true;\n}\n}\n}\n</code></pre> <p>##### \u504f\u5411\u9501\u91cd\u504f\u5411 bytecodeInterpreter.cpp</p> <p>\u5982\u679cepoch\u5df2\u8fc7\u671f\uff0c\u5219\u9700\u8981\u91cd\u504f\u5411</p> <pre><code>// \u5982\u679cepoch\u4e0d\u7b49\u4e8eclass\u4e2d\u7684epoch\uff0c\u5219\u5c1d\u8bd5\u91cd\u504f\u5411\nelse if ((anticipated_bias_locking_value &amp; epoch_mask_in_place) !=0) {\n// \u6784\u9020\u4e00\u4e2a\u504f\u5411\u5f53\u524d\u7ebf\u7a0b\u7684mark word\nmarkOop new_header = (markOop) ( (intptr_t) lockee-&gt;klass()-&gt;prototype_header() | thread_ident);\nif (hash != markOopDesc::no_hash) {\nnew_header = new_header-&gt;copy_set_hash(hash);\n}\n// CAS\u66ff\u6362\u5bf9\u8c61\u5934\u7684mark word  \nif (Atomic::cmpxchg_ptr((void*)new_header, lockee-&gt;mark_addr(), mark) == mark)    {\nif (PrintBiasedLockingStatistics)\n(* BiasedLocking::rebiased_lock_entry_count_addr())++;\n}\nelse {\n// \u91cd\u504f\u5411\u5931\u8d25\uff0c\u4ee3\u8868\u5b58\u5728\u591a\u7ebf\u7a0b\u7ade\u4e89\uff0c\u5219\u8c03\u7528monitorenter\u65b9\u6cd5\u8fdb\u884c\u9501\u5347\u7ea7\nCALL_VM(InterpreterRuntime::monitorenter(THREAD, entry), handle_exception);\n}\nsuccess = true;\n}\n</code></pre> <p>##### \u504f\u5411\u9501\u91cd\u7684\u64a4\u9500 interpreterRuntime.cpp</p> <pre><code>IRT_ENTRY_NO_ASYNC(void, InterpreterRuntime::monitorenter(JavaThread* thread, BasicObjectLock* elem)){\n// \u5982\u679c\u5f00\u542f\u4e86\u504f\u5411\u9501 \u8d70fast_enter\u65b9\u6cd5\nif (UseBiasedLocking) {\n// Retry fast entry if bias is revoked to avoid unnecessary inflation\nObjectSynchronizer::fast_enter(h_obj, elem-&gt;lock(), true, CHECK);\n} else {\nObjectSynchronizer::slow_enter(h_obj, elem-&gt;lock(), CHECK);\n}\n}\n</code></pre> <p>ObjectSynchronizer::fast_enter</p> <pre><code>void ObjectSynchronizer::fast_enter(Handle obj, BasicLock* lock, bool attempt_rebias, TRAPS) {\nif (UseBiasedLocking) {\nif (!SafepointSynchronize::is_at_safepoint()) {\n// \u64a4\u9500\u548c\u91cd\u504f\u5411\nBiasedLocking::Condition cond = BiasedLocking::revoke_and_rebias(obj, attempt_rebias, THREAD);\nif (cond == BiasedLocking::BIAS_REVOKED_AND_REBIASED) {\nreturn;\n}\n} else {\nassert(!attempt_rebias, \"can not rebias toward VM thread\");\n// \u5b89\u5168\u64a4\u9500\nBiasedLocking::revoke_at_safepoint(obj);\n}\nassert(!obj-&gt;mark()-&gt;has_bias_pattern(), \"biases should be revoked by now\");\n}\n\nslow_enter (obj, lock, THREAD) ;\n}\n</code></pre> <p>BiasedLocking::revoke_and_rebias BiasedLocking::revoke_at_safepoint</p> <pre><code>static BiasedLocking::Condition revoke_bias(oop obj, bool allow_rebias, bool is_bulk, JavaThread* requesting_thread, JavaThread** biased_locker) {\n........\nuint age = mark-&gt;age();\n// \u6784\u5efa\u4e24\u4e2amark word\uff0c\u4e00\u4e2a\u662f\u533f\u540d\u504f\u5411\u6a21\u5f0f\uff08101\uff09\uff0c\u4e00\u4e2a\u662f\u65e0\u9501\u6a21\u5f0f\uff08001\uff09\nmarkOop biased_prototype = markOopDesc::biased_locking_prototype()-&gt;set_age(age);\nmarkOop unbiased_prototype = markOopDesc::prototype()-&gt;set_age(age);\n\nJavaThread* biased_thread = mark-&gt;biased_locker();\nif (biased_thread == NULL) {\n// \u5bf9\u8c61\u533f\u540d\u504f\u5411 \u5982\u679c\u6211\u4eec\u8d70\u5230\u8fd9\u91cc\n// \u53d6\u6d88\u4e86\u504f\u5411\u9501\u56e0\u4e3a\u6211\u4eec\u8c03\u7528\u4e86hash code\nif (!allow_rebias) {\nobj-&gt;set_mark(unbiased_prototype);\n}\nif (TraceBiasedLocking &amp;&amp; (Verbose || !is_bulk)) {\ntty-&gt;print_cr(\"  Revoked bias of anonymously-biased object\");\n}\nreturn BiasedLocking::BIAS_REVOKED;\n}\n// \u5224\u8bfb\u504f\u5411\u7ebf\u7a0b\u662f\u5426\u5b58\u6d3b\nbool thread_is_alive = false;\n// \u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u5c31\u662f\u504f\u5411\u7ebf\u7a0b \nif (requesting_thread == biased_thread) {\nthread_is_alive = true;\n} else {\n// \u904d\u5386\u5f53\u524djvm\u7684\u6240\u6709\u7ebf\u7a0b\uff0c\u5982\u679c\u80fd\u627e\u5230\uff0c\u5219\u8bf4\u660e\u504f\u5411\u7684\u7ebf\u7a0b\u8fd8\u5b58\u6d3b\nfor (JavaThread* cur_thread = Threads::first(); cur_thread != NULL; cur_thread = cur_thread-&gt;next()) {\nif (cur_thread == biased_thread) {\nthread_is_alive = true;\nbreak;\n}\n}\n}\n// \u5982\u679c\u504f\u5411\u7684\u7ebf\u7a0b\u5df2\u7ecf\u4e0d\u5b58\u6d3b\u4e86\nif (!thread_is_alive) {\nif (allow_rebias) {\nobj-&gt;set_mark(biased_prototype);\n} else {\nobj-&gt;set_mark(unbiased_prototype);\n}\n// \u5141\u8bb8\u91cd\u504f\u5411\u5219\u5c06\u5bf9\u8c61mark word\u8bbe\u7f6e\u4e3a\u533f\u540d\u504f\u5411\u72b6\u6001\uff0c\u5426\u5219\u8bbe\u7f6e\u4e3a\u65e0\u9501\u72b6\u6001\nif (TraceBiasedLocking &amp;&amp; (Verbose || !is_bulk)) {\ntty-&gt;print_cr(\"  Revoked bias of object biased toward dead thread\");\n}\nreturn BiasedLocking::BIAS_REVOKED;\n}\n// \u7ebf\u7a0b\u8fd8\u5b58\u6d3b\u5219\u904d\u5386\u7ebf\u7a0b\u6808\u4e2d\u6240\u6709\u7684Lock Record\nGrowableArray&lt;MonitorInfo*&gt;* cached_monitor_info =get_or_compute_monitor_info\n(biased_thread);\nBasicLock* highest_lock = NULL;\nfor (int i = 0; i &lt; cached_monitor_info-&gt;length(); i++) {\nMonitorInfo* mon_info = cached_monitor_info-&gt;at(i);\n// \u5982\u679c\u80fd\u627e\u5230\u5bf9\u5e94\u7684Lock Record\u8bf4\u660e\u504f\u5411\u7684\u7ebf\u7a0b\u8fd8\u5728\u6267\u884c\u540c\u6b65\u4ee3\u7801\u5757\u4e2d\u7684\u4ee3\u7801\nif (mon_info-&gt;owner() == obj) {\nif (TraceBiasedLocking &amp;&amp; Verbose) {\n......\n// Assume recursive case and fix up highest lock later\n// \u7b2c\u4e00\u6b21\u9501\u8bb0\u5f55\u8bbe\u7f6e\u4e3anull\nmarkOop mark = markOopDesc::encode((BasicLock*) NULL);\nhighest_lock = mon_info-&gt;lock();\nhighest_lock-&gt;set_displaced_header(mark);\n} else {\nif (TraceBiasedLocking &amp;&amp; Verbose) {\ntty-&gt;print_cr(\"   mon_info-&gt;owner (\" PTR_FORMAT \") != obj (\" PTR_FORMAT \")\",\np2i((void *) mon_info-&gt;owner()),\np2i((void *) obj));\n}\n}\n}\nif (highest_lock != NULL) {\n// \u4fee\u6539\u7b2c\u4e00\u4e2aLock Record\u4e3a\u65e0\u9501\u72b6\u6001\uff0c\u7136\u540e\u5c06obj\u7684mark word\u8bbe\u7f6e\u4e3a\u6307\u5411\u8be5Lock Record\u7684\u6307\u9488\nhighest_lock-&gt;set_displaced_header(unbiased_prototype);\nobj-&gt;release_set_mark(markOopDesc::encode(highest_lock));\nassert(!obj-&gt;mark()-&gt;has_bias_pattern(), \"illegal mark state: stack lock used bias bit\");\nif (TraceBiasedLocking &amp;&amp; (Verbose || !is_bulk)) {\ntty-&gt;print_cr(\"  Revoked bias of currently-locked object\");\n}\n} else {\n// \u504f\u5411\u9501\u5df2\u7ecf\u4e0d\u518d\u540c\u6b65\u4ee3\u7801\u5757\u4e2d\u4e86\nif (TraceBiasedLocking &amp;&amp; (Verbose || !is_bulk)) {\ntty-&gt;print_cr(\"  Revoked bias of currently-unlocked object\");\n}\nif (allow_rebias) {\n//\u8bbe\u7f6e\u4e3a\u533f\u540d\u504f\u5411\u72b6\u6001\nobj-&gt;set_mark(biased_prototype);\n} else {\n// \u5c06mark word\u8bbe\u7f6e\u4e3a\u65e0\u9501\u72b6\u6001\nobj-&gt;set_mark(unbiased_prototype);\n}\n}\n</code></pre>"},{"location":"java/synchronized/#_5","title":"\u8f7b\u91cf\u7ea7\u9501","text":"<p>##### \u8f7b\u91cf\u7ea7\u9501\u7684\u83b7\u53d6 bytecodeInterpreter.cpp</p> <pre><code>CASE(_monitorenter): {\n..........\n// \u8f7b\u91cf\u7ea7\u9501\u91cd\u5165\u903b\u8f91\nif (!success) {\n// \u6784\u5efa\u4e00\u4e2a\u65e0\u9501\u72b6\u6001\u7684Displaced Mark Word\nmarkOop displaced = lockee-&gt;mark()-&gt;set_unlocked();\nentry-&gt;lock()-&gt;set_displaced_header(displaced);\n// \u5982\u679c\u6307\u5b9a\u4e86-XX:+UseHeavyMonitors\uff0c\u5219call_vm=true\uff0c\u4ee3\u8868\u7981\u7528\u504f\u5411\u9501\u548c\u8f7b\u91cf\u7ea7\u9501\nbool call_vm = UseHeavyMonitors;\n// \u5229\u7528CAS\u5c06\u5bf9\u8c61\u5934\u7684mark word\u66ff\u6362\u4e3a\u6307\u5411Lock Record\u7684\u6307\u9488\nif (call_vm || Atomic::cmpxchg_ptr(entry, lockee-&gt;mark_addr(), displaced) != displaced) {\n// \u5224\u65ad\u662f\u4e0d\u662f\u9501\u91cd\u5165\nif (!call_vm &amp;&amp; THREAD-&gt;is_lock_owned((address) displaced-&gt;clear_lock_bits())) {\n// \u5982\u679c\u662f\u9501\u91cd\u5165\uff0c\u5219\u76f4\u63a5\u5c06Displaced Mark Word\u8bbe\u7f6e\u4e3anul\nentry-&gt;lock()-&gt;set_displaced_header(NULL);\n} else {\nCALL_VM(InterpreterRuntime::monitorenter(THREAD, entry), handle_exception);\n}\n}\n}\n</code></pre> <pre><code>IRT_ENTRY_NO_ASYNC(void, InterpreterRuntime::monitorenter(JavaThread* thread, BasicObjectLock* elem)){\n// \u5982\u679c\u5f00\u542f\u4e86\u504f\u5411\u9501 \u8d70fast_enter\u65b9\u6cd5\nif (UseBiasedLocking) {\n// Retry fast entry if bias is revoked to avoid unnecessary inflation\nObjectSynchronizer::fast_enter(h_obj, elem-&gt;lock(), true, CHECK);\n} else {\nObjectSynchronizer::slow_enter(h_obj, elem-&gt;lock(), CHECK);\n}\n}\n</code></pre> <p>\u5173\u95ed\u4e86\u504f\u5411\u9501\u76f4\u63a5\u8fdb\u5165\u8f7b\u91cf\u7ea7\u9501 ObjectSynchronizer::slow_enter</p> <p><code>c++   void ObjectSynchronizer::slow_enter(Handle obj, BasicLock* lock, TRAPS) {     markOop mark = obj-&gt;mark();     // \u5982\u679c\u662f\u65e0\u9501\u72b6\u6001     if (mark-&gt;is_neutral()) {       // Anticipate successful CAS -- the ST of the displaced mark must       // be visible &lt;= the ST performed by the CAS.       // \u8bbe\u7f6eDisplaced Mark Word\u5e76\u66ff\u6362\u5bf9\u8c61\u5934\u7684mark word       lock-&gt;set_displaced_header(mark);       if (mark == (markOop) Atomic::cmpxchg_ptr(lock, obj()-&gt;mark_addr(), mark)) {         TEVENT (slow_enter: release stacklock) ;         return ;       }       // Fall through to inflate() ...     } else if (mark-&gt;has_locker() &amp;&amp; THREAD-&gt;is_lock_owned((address)mark-&gt;locker()))   {       // \u5982\u679c\u662f\u91cd\u5165\uff0c\u5219\u8bbe\u7f6eDisplaced Mark Word\u4e3anull       lock-&gt;set_displaced_header(NULL);       return;     }     // \u9501\u81a8\u80c0\u8fdb\u5165\u91cd\u91cf\u7ea7\u9501     lock-&gt;set_displaced_header(markOopDesc::unused_mark());     ObjectSynchronizer::inflate(THREAD, obj())-&gt;enter(THREAD);   }</code></p> <p>##### \u8f7b\u91cf\u7ea7\u9501\u7684\u9000\u51fa</p> <p>ObjectSynchronizer::slow_exit</p> <pre><code>void ObjectSynchronizer::slow_exit(oop object, BasicLock* lock, TRAPS) {\nfast_exit (object, lock, THREAD) ;\n}\nvoid ObjectSynchronizer::fast_exit(oop object, BasicLock* lock, TRAPS) {\nmarkOop dhw = lock-&gt;displaced_header();\nmarkOop mark ;\nif (dhw == NULL) {\n// \u91cd\u5165\u9501\n// Recursive stack-lock.\n// Diagnostics -- Could be: stack-locked, inflating, inflated.\nmark = object-&gt;mark() ;\n......\nif (mark-&gt;has_monitor()) {\nObjectMonitor * m = mark-&gt;monitor() ;\n}\nreturn ;\n}\nmark = object-&gt;mark() ;\n\n// If the object is stack-locked by the current thread, try to\n// swing the displaced header from the box back to the mark.\nif (mark == (markOop) lock) {\nassert (dhw-&gt;is_neutral(), \"invariant\") ;\nif ((markOop) Atomic::cmpxchg_ptr (dhw, object-&gt;mark_addr(), mark) == mark) {\nTEVENT (fast_exit: release stacklock) ;\nreturn;\n}\n}\n</code></pre>"},{"location":"java/synchronized/#_6","title":"\u91cd\u91cf\u7ea7\u9501","text":"<p>ObjectMonitor</p> <pre><code>  ObjectMonitor() {\n    _header       = NULL;\n    _count        = 0;\n    _waiters      = 0,    // \u7b49\u5f85\u4e2d\u7684\u7ebf\u7a0b\u6570\n    _recursions   = 0;    // \u7ebf\u7a0b\u91cd\u5165\u6b21\u6570\n    _object       = NULL; // \u5b58\u50a8\u8be5 monitor \u7684\u5bf9\u8c61\n    _owner        = NULL; // \u6307\u5411\u62e5\u6709\u8be5 monitor \u7684\u7ebf\u7a0b\n    _WaitSet      = NULL; // \u7b49\u5f85\u7ebf\u7a0b \u53cc\u5411\u5faa\u73af\u94fe\u8868_WaitSet \u6307\u5411\u7b2c\u4e00\u4e2a\u8282\u70b9\n    _WaitSetLock  = 0 ;\n    _Responsible  = NULL ;\n    _succ         = NULL ;\n    _cxq          = NULL ;// \u591a\u7ebf\u7a0b\u7ade\u4e89\u9501\u65f6\u7684\u5355\u5411\u94fe\u8868\n    FreeNext      = NULL ;\n    _EntryList    = NULL ;// _owner \u4ece\u8be5\u53cc\u5411\u5faa\u73af\u94fe\u8868\u4e2d\u5524\u9192\u7ebf\u7a0b\uff0c\n    _SpinFreq     = 0 ;\n    _SpinClock    = 0 ;\n    OwnerIsThread = 0 ;\n    _previous_owner_tid = 0;// \u524d\u4e00\u4e2a\u62e5\u6709\u6b64\u76d1\u89c6\u5668\u7684\u7ebf\u7a0b ID\n }\n</code></pre> <p>##### \u9501\u81a8\u80c0\u4e3a\u91cd\u91cf\u7ea7\u9501ObjectSynchronizer::inflate</p> <pre><code> ObjectMonitor * ATTR ObjectSynchronizer::inflate (Thread * Self, oop object) {\n.......\nfor (;;) {\nconst markOop mark = object-&gt;mark() ;\nassert (!mark-&gt;has_bias_pattern(), \"invariant\") ;\n\n// The mark can be in one of the following states:\n// *  Inflated(\u91cd\u91cf\u7ea7\u9501\u72b6\u6001\uff09    - just return\n// *  Stack-locked\uff08\u8f7b\u91cf\u7ea7\u9501\u72b6\u6001\uff09- coerce it to inflated\n// *  INFLATING\uff08\u81a8\u80c0\u4e2d\uff09        - busy wait for conversion to complete\n// *  Neutral\uff08\u65e0\u9501\u72b6\u6001\uff09        - aggressively inflate the object.\n// *  BIASED\uff08\u504f\u5411\u9501\uff09           - Illegal.  We should never see this\n\n// CASE: inflated\nif (mark-&gt;has_monitor()) {\n// \u91cd\u91cf\u7ea7\u72b6\u6001\nObjectMonitor * inf = mark-&gt;monitor() ;\n.......\nreturn inf ;\n}\n// \u53ea\u6709\u8be5\u7ebf\u7a0b\u624d\u80fd\u5b8c\u6210\u81a8\u80c0 \u5176\u4ed6\u7ebf\u7a0b\u5fc5\u987b\u7b49\u5f85\nif (mark == markOopDesc::INFLATING()) {\n\nTEVENT (Inflate: spin while INFLATING) ;\n// \u5728\u8be5\u65b9\u6cd5\u4e2d\u4f1a\u8fdb\u884cspin/yield/park\u7b49\u64cd\u4f5c\u5b8c\u6210\u81ea\u65cb\u52a8\u4f5c \nReadStableMark(object) ;\ncontinue ;\n}\n\nif (mark-&gt;has_locker()) {\n// \u5f53\u524d\u8f7b\u91cf\u7ea7\u9501\u72b6\u6001\uff0c\u5148\u5206\u914d\u4e00\u4e2aObjectMonitor\u5bf9\u8c61\uff0c\u5e76\u521d\u59cb\u5316\u503c\nObjectMonitor * m = omAlloc (Self) ;\n// Optimistically prepare the objectmonitor - anticipate successful CAS\n// We do this before the CAS in order to minimize the length of time\n// in which INFLATING appears in the mark.\nm-&gt;Recycle();\nm-&gt;_Responsible  = NULL ;\nm-&gt;OwnerIsThread = 0 ;\nm-&gt;_recursions   = 0 ;\nm-&gt;_SpinDuration = ObjectMonitor::Knob_SpinLimit ;\n// \u5c06\u9501\u5bf9\u8c61\u7684mark word\u8bbe\u7f6e\u4e3aINFLATING (0)\u72b6\u6001 \nmarkOop cmp = (markOop) Atomic::cmpxchg_ptr (markOopDesc::INFLATING(), object-&gt;mark_addr(), mark) ;\nif (cmp != mark) {\nomRelease (Self, m, true) ;\ncontinue ;       // Interference -- just retry\n}\nmarkOop dmw = mark-&gt;displaced_mark_helper() ;\nassert (dmw-&gt;is_neutral(), \"invariant\") ;\n\n// Setup monitor fields to proper values -- prepare the monitor\nm-&gt;set_header(dmw) ;\nm-&gt;set_owner(mark-&gt;locker());\nm-&gt;set_object(object);\nguarantee (object-&gt;mark() == markOopDesc::INFLATING(), \"invariant\") ;\n// \u5c06\u9501\u5bf9\u8c61\u5934\u8bbe\u7f6e\u4e3a\u91cd\u91cf\u7ea7\u9501\u72b6\u6001\nobject-&gt;release_set_mark(markOopDesc::encode(m));\n......\n}\n// \u5206\u914d\u4ee5\u53ca\u521d\u59cb\u5316ObjectMonitor\u5bf9\u8c61\nObjectMonitor * m = omAlloc (Self) ;\nm-&gt;Recycle();\nm-&gt;set_header(mark);\nm-&gt;set_owner(NULL);\nm-&gt;set_object(object);\nm-&gt;OwnerIsThread = 1 ;\nm-&gt;_recursions   = 0 ;\nm-&gt;_Responsible  = NULL ;\nm-&gt;_SpinDuration = ObjectMonitor::Knob_SpinLimit ;\n// \u7528CAS\u66ff\u6362\u5bf9\u8c61\u5934\u7684mark word\u4e3a\u91cd\u91cf\u7ea7\u9501\u72b6\u6001\nif (Atomic::cmpxchg_ptr (markOopDesc::encode(m), object-&gt;mark_addr(), mark) != mark) {\nm-&gt;set_object (NULL) ;\nm-&gt;set_owner  (NULL) ;\nm-&gt;OwnerIsThread = 0 ;\nm-&gt;Recycle() ;\nomRelease (Self, m, true) ;\nm = NULL ;\ncontinue ;\n}\n...........\nreturn m ;\n}\n}\n</code></pre> <p>##### \u91cd\u91cf\u7ea7\u9501\u7684\u5165\u53e3 ([ObjectMonitor::enter)</p> <pre><code>void ATTR ObjectMonitor::enter(TRAPS) {\nThread * const Self = THREAD ;\nvoid * cur ;\n// \u901a\u8fc7CAS\u64cd\u4f5c\u628amonitor \u7684_owner \u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u5f53\u524d\u7ebf\u7a0b\ncur = Atomic::cmpxchg_ptr (Self, &amp;_owner, NULL) ;\nif (cur == NULL) {\n......\nreturn ;\n}\n// \u5982\u679c\u662f\u91cd\u5165\u9501\nif (cur == Self) {\n// TODO-FIXME: check for integer overflow!  BUGID 6557169.\n_recursions ++ ;\nreturn ;\n}\n// \u6210\u529f\u83b7\u53d6\u9501\nif (Self-&gt;is_lock_owned ((address)cur)) {\nassert (_recursions == 0, \"internal state error\");\n_recursions = 1 ;\n// Commute owner from a thread-specific on-stack BasicLockObject address to\n// a full-fledged \"Thread *\".\n_owner = Self ;\nOwnerIsThread = 1 ;\nreturn ;\n}\n// \u5c1d\u8bd5\u81ea\u9009\u83b7\u53d6\u9501\nif (Knob_SpinEarly &amp;&amp; TrySpin (Self) &gt; 0) {\nSelf-&gt;_Stalled = 0 ;\nreturn ;\n}\n// \nfor (;;) {\njt-&gt;set_suspend_equivalent();\n// \u672a\u83b7\u53d6\u9501\u5b58\u653e\u9501\u5230\u7b49\u5230\u961f\u5217\u4e2d\nEnterI (THREAD) ;\nif (!ExitSuspendEquivalent(jt)) break ;\nrecursions = 0 ;\n_succ = NULL ;\nexit (false, Self) ;\n\njt-&gt;java_suspend_self();\n}\n}\n</code></pre> <p>#####\u9501\u7684\u7b49\u5f85(EnterI\u9501\u5bf9\u8c61\u7684\u5b58\u653e)</p> <pre><code>void ATTR ObjectMonitor::EnterI (TRAPS) {\nThread * Self = THREAD ;\n// Try the lock  \u518d\u6b21\u5c1d\u8bd5\u83b7\u53d6\u9501\nif (TryLock (Self) &gt; 0) {\nreturn ;\n}\n// \u5c1d\u8bd5\u81ea\u65cb\u83b7\u53d6\u9501\nif (TrySpin (Self) &gt; 0) {\nreturn ;\n}\n// \u5f53\u524d\u7ebf\u7a0b\u88ab\u5c01\u88c5\u6210 ObjectWaiter \nObjectWaiter node(Self) ;\nSelf-&gt;_ParkEvent-&gt;reset() ;\nnode._prev   = (ObjectWaiter *) 0xBAD ;\nnode.TState  = ObjectWaiter::TS_CXQ ;\n\nObjectWaiter * nxt ;\n//\u5c06node\u8282\u70b9\u63d2\u5165\u5230_cxq\u961f\u5217\u7684\u5934\u90e8\uff0ccxq\u662f\u4e00\u4e2a\u5355\u5411\u94fe\u8868\nfor (;;) {\nnode._next = nxt = _cxq ;\nif (Atomic::cmpxchg_ptr (&amp;node, &amp;_cxq, nxt) == nxt) break ;\n// \u518d\u6b21\u81ea\u65cb\nif (TryLock (Self) &gt; 0) {\nreturn ;\n}\n}\nfor (;;) {\n// \u518d\u6b21\u5c1d\u8bd5\nif (TryLock (Self) &gt; 0) break ;\nif ((SyncFlags &amp; 2) &amp;&amp; _Responsible == NULL) {\nAtomic::cmpxchg_ptr (Self, &amp;_Responsible, NULL) ;\n}\n\n// park self\nif (_Responsible == Self || (SyncFlags &amp; 1)) {\nTEVENT (Inflated enter - park TIMED) ;\n// \u963b\u585e\u7ebf\u7a0b\u4e00\u6bb5\u65f6\u95f4\nSelf-&gt;_ParkEvent-&gt;park ((jlong) RecheckInterval) ;\n// Increase the RecheckInterval, but clamp the value.\nRecheckInterval *= 8 ;\nif (RecheckInterval &gt; 1000) RecheckInterval = 1000 ;\n} else {\nTEVENT (Inflated enter - park UNTIMED) ;\n// \u76f4\u63a5\u6302\u8d77\u7ebf\u7a0b,\u7b49\u5f85\u88ab\u5524\u9192\nSelf-&gt;_ParkEvent-&gt;park() ;\n}\n// \u518d\u6b21\u5c1d\u8bd5\nif (TryLock(Self) &gt; 0) break ;\n}\n}\n</code></pre> <p>#####  \u9501\u7684\u91ca\u653e(ObjectMonitor::exit)</p> <pre><code>void ATTR ObjectMonitor::exit(bool not_suspended, TRAPS) {\n.......\nif (_recursions != 0) {\n_recursions--;        // this is simple recursive enter\nTEVENT (Inflated exit - recursive) ;\nreturn ;\n}\n....\n\nObjectWaiter * w = NULL ;\nint QMode = Knob_QMode ;\n// \u4ece cxq \u961f\u5217\u4e2d\u83b7\u53d6\u7ebf\u7a0b\u7528\u4e8e\u7ade\u4e89\u9501\nif (QMode == 2 &amp;&amp; _cxq != NULL) {\nw = _cxq ;\nassert (w != NULL, \"invariant\") ;\nassert (w-&gt;TState == ObjectWaiter::TS_CXQ, \"Invariant\") ;\nExitEpilog (Self, w) ;\nreturn ;\n}\n// cxq \u961f\u5217\u63d2\u5165 EntryList \u5c3e\u90e8\nif (QMode == 3 &amp;&amp; _cxq != NULL) {\nw = _cxq ;\nfor (;;) {\nObjectWaiter * u = (ObjectWaiter *) Atomic::cmpxchg_ptr (NULL, &amp;_cxq, w) ;\nif (u == w) break ;\nw = u ;\n}\nObjectWaiter * q = NULL ;\nObjectWaiter * p ;\nfor (p = w ; p != NULL ; p = p-&gt;_next) {\nguarantee (p-&gt;TState == ObjectWaiter::TS_CXQ, \"Invariant\") ;\np-&gt;TState = ObjectWaiter::TS_ENTER ;\np-&gt;_prev = q ;\nq = p ;\n}\nObjectWaiter * Tail ;\nfor (Tail = _EntryList ; Tail != NULL &amp;&amp; Tail-&gt;_next != NULL ; Tail = Tail-&gt;_next) ;\nif (Tail == NULL) {\n_EntryList = w ;\n} else {\nTail-&gt;_next = w ;\nw-&gt;_prev = Tail ;\n}\n}\n// cxq \u961f\u5217\u63d2\u5165\u5230_EntryList \u5934\u90e8\nif (QMode == 4 &amp;&amp; _cxq != NULL) {\nw = _cxq ;\nfor (;;) {\nassert (w != NULL, \"Invariant\") ;\nObjectWaiter * u = (ObjectWaiter *) Atomic::cmpxchg_ptr (NULL, &amp;_cxq, w) ;\nif (u == w) break ;\nw = u ;\n}\nassert (w != NULL              , \"invariant\") ;\n\nObjectWaiter * q = NULL ;\nObjectWaiter * p ;\nfor (p = w ; p != NULL ; p = p-&gt;_next) {\nguarantee (p-&gt;TState == ObjectWaiter::TS_CXQ, \"Invariant\") ;\np-&gt;TState = ObjectWaiter::TS_ENTER ;\np-&gt;_prev = q ;\nq = p ;\n}\n\n// Prepend the RATs to the EntryList\nif (_EntryList != NULL) {\nq-&gt;_next = _EntryList ;\n_EntryList-&gt;_prev = q ;\n}\n_EntryList = w ;\n\n// Fall thru into code that tries to wake a successor from EntryList\n}\nw = _EntryList  ;\nif (w != NULL) {\n// \u5982\u679cEntryList\u4e0d\u4e3a\u7a7a\uff0c\u4eceEntryList\u7684\u961f\u9996\u83b7\u53d6\u9501\nExitEpilog (Self, w) ;\nreturn ;\n}\n.......\nif (QMode == 1) {\n// QMode == 1 : drain cxq to EntryList, reversing order\n// QMode == 1 : \u5c06cxq\u4e2d\u7684\u5143\u7d20\u8f6c\u79fb\u5230EntryList\uff0c\u5e76\u53cd\u8f6c\u987a\u5e8f\n// We also reverse the order of the list.\nObjectWaiter * s = NULL ;\nObjectWaiter * t = w ;\nObjectWaiter * u = NULL ;\nwhile (t != NULL) {\nguarantee (t-&gt;TState == ObjectWaiter::TS_CXQ, \"invariant\") ;\nt-&gt;TState = ObjectWaiter::TS_ENTER ;\nu = t-&gt;_next ;\nt-&gt;_prev = u ;\nt-&gt;_next = s ;\ns = t;\nt = u ;\n}\n_EntryList  = s ;\nassert (s != NULL, \"invariant\") ;\n} else {\n// QMode == 0 or QMode == 2\n// \u5c06cxq\u4e2d\u7684\u5143\u7d20\u8f6c\u79fb\u5230EntryList\n_EntryList = w ;\nObjectWaiter * q = NULL ;\nObjectWaiter * p ;\nfor (p = w ; p != NULL ; p = p-&gt;_next) {\nguarantee (p-&gt;TState == ObjectWaiter::TS_CXQ, \"Invariant\") ;\np-&gt;TState = ObjectWaiter::TS_ENTER ;\np-&gt;_prev = q ;\nq = p ;\n}\n}\n// _succ\u4e0d\u4e3anull\uff0c\u8bf4\u660e\u5df2\u7ecf\u6709\u4e2a\u7ee7\u627f\u4eba\u4e86\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u5f53\u524d\u7ebf\u7a0b\u53bb\u5524\u9192\nif (_succ != NULL) continue;\nw = _EntryList  ;\nif (w != NULL) {\nguarantee (w-&gt;TState == ObjectWaiter::TS_ENTER, \"invariant\") ;\n// \u5524\u9192EntryList\u7b2c\u4e00\u4e2a\u5143\u7d20\nExitEpilog (Self, w) ;\nreturn ;\n}\n}\n</code></pre>"},{"location":"java/thread-local/","title":"ThreadLocal\u6e90\u7801\u89e3\u8bfb","text":"<p>ThreadLocal\u6bcf\u6b21\u521d\u59cb\u540ethreadLocalHashCode\u589e\u52a0HASH_INCREMENT</p> <pre><code>public class MyThreadLocal { private final int threadLocalHashCode = nextHashCode();\n\nprivate static AtomicInteger nextHashCode = new AtomicInteger();\n\nprivate static final int HASH_INCREMENT = 0x61c88647;\n\nprivate static int nextHashCode() {\nreturn nextHashCode.getAndAdd(HASH_INCREMENT);\n}\n\npublic static void main(String[] args) {\nSystem.out.println(MyThreadLocal.nextHashCode());\nSystem.out.println(MyThreadLocal.nextHashCode());\nSystem.out.println(MyThreadLocal.nextHashCode());\nSystem.out.println(MyThreadLocal.nextHashCode());\n}\n}\n</code></pre> <p>##### \u8f93\u51fa\u7ed3\u679c</p> <pre><code>0\n1640531527\n-1013904242\n626627285\n</code></pre> <p>##### \u54c8\u5e0c\u7b97\u6cd5</p> <pre><code>public class MyThreadLocal {\n\n    private final int threadLocalHashCode = nextHashCode();\n\n    private static final int INITIAL_CAPACITY = 16;\n\n    private static AtomicInteger nextHashCode = new AtomicInteger();\n\n    private static final int HASH_INCREMENT = 0x61c88647;\n\n    private static int nextHashCode() {\n        return nextHashCode.getAndAdd(HASH_INCREMENT);\n    }\n\n    public static void main(String[] args) {\n        System.out.println(MyThreadLocal.nextHashCode() &amp; (INITIAL_CAPACITY - 1));\n        System.out.println(MyThreadLocal.nextHashCode() &amp; (INITIAL_CAPACITY - 1));\n        System.out.println(MyThreadLocal.nextHashCode() &amp; (INITIAL_CAPACITY - 1));\n        System.out.println(MyThreadLocal.nextHashCode() &amp; (INITIAL_CAPACITY - 1));\n    }\n}\n</code></pre> <p>##### \u8f93\u51fa\u7ed3\u679c</p> <pre><code>0\n7\n14\n5\n</code></pre> <p>##### \u65b9\u6cd5</p> <pre><code> public T get() {\nThread t = Thread.currentThread();\n// \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0bThreadLocalMap\nThreadLocalMap map = getMap(t);\nif (map != null) {\n// \u901a\u8fc7\u5f53\u524dThreadLocal\u7684threadLocalHashCode\u54c8\u5e0c\u503c\u83b7\u53d6Entry\nThreadLocalMap.Entry e = map.getEntry(this);\nif (e != null) {\n@SuppressWarnings(\"unchecked\")\nT result = (T)e.value;\nreturn result;\n}\n}\nreturn setInitialValue();\n}\n\npublic void set(T value) {\nThread t = Thread.currentThread();\n// \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0bThreadLocalMap\nThreadLocalMap map = getMap(t);\nif (map != null)\n// \u901a\u8fc7\u5f53\u524dThreadLocal\u7684threadLocalHashCode\u54c8\u5e0c\u503c\u8bbe\u7f6eEntry\nmap.set(this, value);\nelse\n// \u5f53\u524d\u7ebf\u7a0b\u6ca1\u6709ThreadLocalMap \u573a\u666fThreadLocalMap\u8d4b\u503c\u7ed9Tread\ncreateMap(t, value);\n}\n\npublic void remove() {\n// \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0bThreadLocalMap\nThreadLocalMap m = getMap(Thread.currentThread());\nif (m != null)\n// \u5220\u9664\u5f53\u524d\u7ebf\u7a0b\u7684ThreadLocal\u7684entry\nm.remove(this);\n} </code></pre> <p>ThreadlocalMap\u4f7f\u7528   \u7ebf\u6027\u63a2\u6d4b  \u89e3\u51b3hash\u51b2\u7a81</p> <p>##### \u6210\u5458\u53d8\u91cf</p> <pre><code>        static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; {\n/** The value associated with this ThreadLocal. */\nObject value;\n\nEntry(ThreadLocal&lt;?&gt; k, Object v) {\nsuper(k);\nvalue = v;\n}\n}\n\n/**\n         * The initial capacity -- MUST be a power of two.\n         */\nprivate static final int INITIAL_CAPACITY = 16;\n\n/**\n         * The table, resized as necessary.\n         * table.length MUST always be a power of two.\n         */\nprivate Entry[] table;\n/**\n         * The number of entries in the table.\n         */\nprivate int size = 0;\n\n/**\n         * The next size value at which to resize.\n         */\nprivate int threshold; // Default to 0\n</code></pre> <p>##### \u6784\u9020\u51fd\u6570</p> <pre><code> ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) {\n// \u521d\u59cb\u6570\u7ec4\u5316\u5927\u5c0f\ntable = new Entry[INITIAL_CAPACITY];\n// \u83b7\u53d6\u6563\u5217\u503c\nint i = firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - 1);\ntable[i] = new Entry(firstKey, firstValue);\nsize = 1;\n// \u8bbe\u7f6e\u9619\u503c  len * 2 / 3;\nsetThreshold(INITIAL_CAPACITY);\n}\n</code></pre> <p>##### get\u65b9\u6cd5</p> <pre><code> private Entry getEntry(ThreadLocal&lt;?&gt; key) {\n// \u83b7\u53d6\u6563\u5217\u503c\nint i = key.threadLocalHashCode &amp; (table.length - 1);\nEntry e = table[i];\nif (e != null &amp;&amp; e.get() == key)\nreturn e;\nelse\nreturn getEntryAfterMiss(key, i, e);\n}\n\n/**\n * \u67e5\u627e\u6570\u7ec4i\u4e4b\u540e\u7684entry\n */\nprivate Entry getEntryAfterMiss(ThreadLocal&lt;?&gt; key, int i, Entry e) {\nEntry[] tab = table;\nint len = tab.length;\n\nwhile (e != null) {\nThreadLocal&lt;?&gt; k = e.get();\nif (k == key)\nreturn e;\nif (k == null)\n// entrty\u7684key\u88ab\u56de\u6536\u4e86\nexpungeStaleEntry(i);\nelse\n// \u83b7\u53d6\u4e0b\u4e00\u4e2a\u6570\u7ec4\u7684\u5750\u6807\ni = nextIndex(i, len);\ne = tab[i];\n}\nreturn null;\n}\n\nprivate int expungeStaleEntry(int staleSlot) {\nThreadLocal.ThreadLocalMap.Entry[] tab = table;\nint len = tab.length;\n\n// expunge entry at staleSlot\n// \u6e05\u7a7a\u8be5\u6570\u7ec4\u4f4d\u7f6e\u7684entry\ntab[staleSlot].value = null;\ntab[staleSlot] = null;\nsize--;\n\n// Rehash until we encounter null\nThreadLocal.ThreadLocalMap.Entry e;\nint i;\n// \u5faa\u73afstaleSlot\u4e4b\u540e\u7684entry\nfor (i = nextIndex(staleSlot, len); (e = tab[i]) != null; i = nextIndex(i, len)) {\nThreadLocal&lt;?&gt; k = e.get();\n// \u6e05\u7406\u6ca1\u6709\u88ab\u5e94\u7528\u7684entry\nif (k == null) {\ne.value = null;\ntab[i] = null;\nsize--;\n} else {\n// \u91cd\u65b0\u8ba1\u7b97\u5f53\u524d\u4f4d\u7f6eThreadLocal\u7684\u6563\u5217\u503c\nint h = k.threadLocalHashCode &amp; (len - 1);\n// \u8ba1\u7b97\u540e\u7684\u6563\u5217\u503c\u4e0e\u5f53\u524d\u6563\u5217\u503c\u4e0d\u76f8\u540c\nif (h != i) {\n// \u5f53\u524d\u4f4d\u7f6e\u7684\u6570\u7ec4\u8bbe\u7f6enull\ntab[i] = null;\n// Unlike Knuth 6.4 Algorithm R, we must scan until\n// null because multiple entries could have been stale.\n// \u5f53\u524dh\u4f4d\u7f6e==null\u8bbe\u7f6eentey\nwhile (tab[h] != null) // h\u4f4d\u7f6e\u5411\u540e\u79fb\u52a81\u4f4d\nh = nextIndex(h, len);\ntab[h] = e;\n}\n}\n}\nreturn i;\n}\n</code></pre> <p>##### set\u65b9\u6cd5</p> <pre><code>private void set(ThreadLocal&lt;?&gt; key, Object value) {\nThreadLocal.ThreadLocalMap.Entry[] tab = table;\nint len = tab.length;\n// \u83b7\u53d6\u6563\u5217\u503c\nint i = key.threadLocalHashCode &amp; (len-1);\n// \u67e5\u8be2i\u4e4b\u540eentry\n// tab[i]\u4f4d\u7f6e\u6709\u6570\u636e\u5904\u7406\nfor (ThreadLocal.ThreadLocalMap.Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) {\nThreadLocal&lt;?&gt; k = e.get();\nif (k == key) {\n// \u4e4b\u524d\u7684key\u5728\u503c\u91cd\u65b0\u8d4b\u503c\ne.value = value;\nreturn;\n}\n// tab[i]\u4f4d\u7f6e\u6ca1\u6709ThreadLocal\u88ab\u4f7f\u7528\u4e86\nif (k == null) {\nreplaceStaleEntry(key, value, i);\nreturn;\n}\n}\n// \u8be5\u4f4d\u7f6e\u8bbe\u7f6e\u6700\u65b0entrty\ntab[i] = new ThreadLocal.ThreadLocalMap.Entry(key, value);\nint sz = ++size;\nif (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold)\n// \u91cd\u65b0\u6574\u7406table\nrehash();\n}\nprivate void replaceStaleEntry(ThreadLocal&lt;?&gt; key, Object value, int staleSlot) {\nThreadLocal.ThreadLocalMap.Entry[] tab = table;\nint len = tab.length;\nThreadLocal.ThreadLocalMap.Entry e;\nint slotToExpunge = staleSlot;\n// staleSlot \u4e4b\u524d\u4f4d\u7f6e\u7684entrty\nfor (int i = prevIndex(staleSlot, len); (e = tab[i]) != null; i = prevIndex(i, len))\nif (e.get() == null)\nslotToExpunge = i;\n\n// \u91cd\u65b0\u8bbe\u7f6e\nfor (int i = nextIndex(staleSlot, len); (e = tab[i]) != null; i = nextIndex(i, len)) {\n// \u627e\u89c1\u4e4b\u524d\u8bbe\u7f6eentry\u8bbe\u7f6e\u7684\u4f4d\u7f6e\nThreadLocal&lt;?&gt; k = e.get();\nif (k == key) {\ne.value = value;\n\ntab[i] = tab[staleSlot];\ntab[staleSlot] = e;\n\n// Start expunge at preceding stale entry if it exists\nif (slotToExpunge == staleSlot)\nslotToExpunge = i;\n// \u6e05\u7406\u65e0\u6548\u6570\u7ec4\u6570\u636e\ncleanSomeSlots(expungeStaleEntry(slotToExpunge), len);\nreturn;\n}\nif (k == null &amp;&amp; slotToExpunge == staleSlot)\nslotToExpunge = i;\n}\n\n// If key not found, put new entry in stale slot\ntab[staleSlot].value = null;\ntab[staleSlot] = new ThreadLocal.ThreadLocalMap.Entry(key, value);\n\n// If there are any other stale entries in run, expunge them\nif (slotToExpunge != staleSlot)\ncleanSomeSlots(expungeStaleEntry(slotToExpunge), len);\n}\n\n// \u6e05\u7406\u8be5tabl\u7684\u6570\u636e\nprivate int expungeStaleEntry(int staleSlot) {\nThreadLocal.ThreadLocalMap.Entry[] tab = table;\nint len = tab.length;\n\n// expunge entry at staleSlot\ntab[staleSlot].value = null;\ntab[staleSlot] = null;\nsize--;\n\n// Rehash until we encounter null\nThreadLocal.ThreadLocalMap.Entry e;\nint i;\n// \u6e05\u7406taba[staleSlot]\u4e4b\u540e\u7684\u6570\u636e\nfor (i = nextIndex(staleSlot, len); (e = tab[i]) != null; i = nextIndex(i, len)) {\nThreadLocal&lt;?&gt; k = e.get();\n// tab[i]\u4f4d\u7f6e\u6ca1\u6709ThreadLocal\u88ab\u4f7f\u7528\u4e86\nif (k == null) {\ne.value = null;\ntab[i] = null;\nsize--;\n} else {\n// \u91cd\u65b0\u8ba1\u7b97\u6563\u5217\u503c\u5b58\u653e\u5230\u4e0b\u4e00\u4e2a\u4f4d\u7f6e\nint h = k.threadLocalHashCode &amp; (len - 1);\nif (h != i) {\ntab[i] = null;\n\n// Unlike Knuth 6.4 Algorithm R, we must scan until\n// null because multiple entries could have been stale.\nwhile (tab[h] != null)\nh = nextIndex(h, len);\ntab[h] = e;\n}\n}\n}\nreturn i;\n}\n/**\n  * \u6e05\u7406\u90e8\u5206\u6570\u636e n = n/2 \n  */\nprivate boolean cleanSomeSlots(int i, int n) {\nboolean removed = false;\nEntry[] tab = table;\nint len = tab.length;\ndo {\ni = nextIndex(i, len);\nEntry e = tab[i];\nif (e != null &amp;&amp; e.get() == null) {\nn = len;\nremoved = true;\ni = expungeStaleEntry(i);\n}\n//n = n/2 \n} while ( (n &gt;&gt;&gt;= 1) != 0);\nreturn removed;\n}\n/**\n  * \u6574\u7406\u6570\u7ec4\n  */\nprivate void rehash() {\n// \u6e05\u7406\u5168\u90e8\u6570\u7ec4\nexpungeStaleEntries();\n\n// Use lower threshold for doubling to avoid hysteresis\n// \u5224\u65adsize\u7684\u503c\u662f\u5426\u5927\u4e8e\u9619\u503c\nif (size &gt;= threshold - threshold / 4)\n// \u6269\u5bb9\nresize();\n}\n\n/**\n         * Double the capacity of the table.\n         */\nprivate void resize() {\nEntry[] oldTab = table;\nint oldLen = oldTab.length;\nint newLen = oldLen * 2;\nEntry[] newTab = new Entry[newLen];\nint count = 0;\n// \u65e7\u7684\u4f4d\u7f6e\u62f7\u8d1d\u5230\u884c\u65b0\u7684\u4f4d\u7f6e\nfor (int j = 0; j &lt; oldLen; ++j) {\nEntry e = oldTab[j];\nif (e != null) {\nThreadLocal&lt;?&gt; k = e.get();\nif (k == null) {\ne.value = null; // Help the GC\n} else {\nint h = k.threadLocalHashCode &amp; (newLen - 1);\nwhile (newTab[h] != null)\nh = nextIndex(h, newLen);\nnewTab[h] = e;\ncount++;\n}\n}\n}\n\nsetThreshold(newLen);\nsize = count;\ntable = newTab;\n}\n\n/**\n         * Expunge all stale entries in the table.\n         * \u5168\u90e8\u6e05\u7406\u6570\u7ec4\n         */\nprivate void expungeStaleEntries() {\nEntry[] tab = table;\nint len = tab.length;\nfor (int j = 0; j &lt; len; j++) {\nEntry e = tab[j];\nif (e != null &amp;&amp; e.get() == null)\nexpungeStaleEntry(j);\n}\n}\n}\n</code></pre> <p>##### remove\u65b9\u6cd5</p> <pre><code>private void remove(ThreadLocal&lt;?&gt; key) {\nEntry[] tab = table;\nint len = tab.length;\nint i = key.threadLocalHashCode &amp; (len-1);\n// \u67e5\u8be2I\u4e4b\u540e\u7b49\u4e8ekey\u7684\u503c\u5e76\u6e05\u7406\nfor (Entry e = tab[i]; e != null;e = tab[i = nextIndex(i, len)]) {\nif (e.get() == key) {\ne.clear();\nexpungeStaleEntry(i);\nreturn;\n}\n}\n}\n</code></pre>"},{"location":"java/thread-local/#thread-threadlocalmap-threadlocal","title":"Thread ThreadLocalMap ThreadLocal \u5173\u7cfb\u56fe","text":""},{"location":"java/thread-local/#threadlocal_1","title":"ThreadLocal","text":""},{"location":"java/thread-local/#threadlocalmap","title":"ThreadLocalMap","text":""},{"location":"other/cert-generation/","title":"\u81ea\u7b7e\u540d\u8bc1\u4e66","text":"<ul> <li>\u751f\u6210\u81ea\u7b7e\u540d\u8bc1\u4e66</li> </ul> <pre><code>openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365   </code></pre> <ul> <li>\u751f\u6210p12\u683c\u5f0f</li> </ul> <pre><code>openssl pkcs12 -export -in cert.pem -inkey key.pem -certfile cert.pem -out keystore.p12\n</code></pre> <ul> <li>\u4e3a\u5ba2\u6237\u7aef\u521b\u5efajks\u6587\u4ef6\uff08\u5b83\u5c06\u5305\u62ec\u8bc1\u4e66\uff09</li> </ul> <pre><code>keytool -import -v -trustcacerts -alias client-alias -file cert.pem -keystore client.jks -keypass 123456 -storepass 123456  </code></pre> <ul> <li>\u4e3a\u670d\u52a1\u5668\u521b\u5efajks\u6587\u4ef6\uff08\u9700\u8981\u5305\u542b\u79c1\u94a5\uff09</li> </ul> <pre><code>keytool -importkeystore -srckeystore keystore.p12 -srcstoretype pkcs12 -destkeystore server.jks -deststoretype JKS\n</code></pre> <ul> <li>\u751f\u6210Android bks</li> </ul> <p>bcprov-ext-jdk15on-166.jar</p> <pre><code>keytool -importkeystore -srckeystore keystore.p12 -srcstoretype pkcs12 -destkeystore ./android.bks -deststoretype bks -provider org.bouncycastle.jce.provider.BouncyCastleProvider -providerpath /usr/local/jdk1.8.0_201/jre/lib/ext/bcprov-ext-jdk15on-166.jar\n</code></pre>"},{"location":"other/install/","title":"\u5b89\u88c5\u547d\u4ee4","text":""},{"location":"other/install/#java","title":"java","text":"<p>\u5b98\u7f51\u5730\u5740\uff1ahttps://www.oracle.com/technetwork/java/javase/downloads/index.html\u3001</p> <p>\u534e\u4e3a\u5f00\u6e90\u955c\u50cf\u7ad9\uff1ahttps://repo.huaweicloud.com/java/jdk/</p> <ol> <li>\u4e0b\u8f7djdk</li> </ol> <pre><code>wget https://repo.huaweicloud.com/java/jdk/8u151-b12/jdk-8u151-linux-x64.tar.gz\n</code></pre> <ol> <li>\u5b89\u88c5</li> </ol> <pre><code>tar -zxvf jdk-8u151-linux-x64.tar.gz\n</code></pre> <ol> <li>\u73af\u5883\u53d8\u91cf\u914d\u7f6e</li> </ol> <pre><code>echo 'export JAVA_HOME=/opt/jdk1.8.0_151' &gt;&gt; /etc/profile\necho 'export CLASSPATH=.:${JAVA_HOME}/jre/lib/rt.jar:${JAVA_HOME}/lib/dt.jar:${JAVA_HOME}/lib/tools.jar' &gt;&gt; /etc/profile\necho 'export PATH=$PATH:${JAVA_HOME}/bin' &gt;&gt; /etc/profile\nsource /etc/profile\n</code></pre>"},{"location":"other/install/#maven","title":"maven","text":"<p>\u5b98\u65b9\u5730\u5740\uff1ahttp://maven.apache.org/download.cgi</p> <ol> <li>\u4e0b\u8f7dgz\u5305</li> </ol> <pre><code>wget http://mirror.bit.edu.cn/apache/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gz\n</code></pre> <ol> <li>\u89e3\u538b</li> </ol> <pre><code>tar -zxvf apache-maven-3.6.3-bin.tar.gz\n</code></pre> <ol> <li>\u914d\u7f6e\u73af\u5883\u53d8\u91cf</li> </ol> <pre><code>echo 'export M2_HOME=/opt/apache-maven-3.6.3' &gt;&gt; /etc/profile\necho 'export PATH=$PATH:${M2_HOME}/bin' &gt;&gt; /etc/profile\nsource /etc/profile\n</code></pre>"},{"location":"other/internet/","title":"\u7f51\u7edc\u534f\u8bae","text":"<pre><code>route -n\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n0.0.0.0         172.21.21.1     0.0.0.0         UG    0      0        0 eth0\n169.254.0.0     0.0.0.0         255.255.0.0     U     1002   0        0 eth0\n172.21.21.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0\nping www.baidu.com\n64 bytes from 110.242.68.3 (110.242.68.3): icmp_seq=1 ttl=251 time=9.16 ms\n#ip \u4e0e Genmask\n#\u4e0b\u4e00\u8df3 172.21.21.1 \u8def\u7531\u5730\u5740\n\narp -a #\u94fe\u8def\u5c42mac\u5730\u5740\n? (169.254.0.23) at fe:ee:ec:79:b4:be [ether] on eth0\n? (169.254.0.4) at fe:ee:ec:79:b4:be [ether] on eth0\ngateway (172.21.21.1) at fe:ee:ec:79:b4:be [ether] on eth0\n? (169.254.0.80) at fe:ee:ec:79:b4:be [ether] on eth0\n? (169.254.128.11) at fe:ee:ec:79:b4:be [ether] on eth0\n? (169.254.0.79) at fe:ee:ec:79:b4:be [ether] on eth0\n? (169.254.0.55) at fe:ee:ec:79:b4:be [ether] on eth0\n? (169.254.0.81) at fe:ee:ec:79:b4:be [ether] on eth0\n? (169.254.0.2) at fe:ee:ec:79:b4:be [ether] on eth0\n? (169.254.0.15) at fe:ee:ec:79:b4:be [ether] on eth0\n? (169.254.0.82) at fe:ee:ec:79:b4:be [ether] on eth0\n? (169.254.0.3) at fe:ee:ec:79:b4:be [ether] on eth0\n? (169.254.0.83) at fe:ee:ec:79:b4:be [ether] on eth0\n? (169.254.128.5) at fe:ee:ec:79:b4:be [ether] on eth0\n\n#arp\u534f\u8bae   \u7f51\u5173 ff:ff:ff:ff:ff:ff  \u83b7\u53d6\u4ea4\u6362\u673a\u6240\u6709mac\u5730\u5740\n</code></pre>"},{"location":"other/internet/#ping","title":"ping","text":""},{"location":"other/internet/#lvs","title":"LVS","text":""},{"location":"other/internet/#nat","title":"NAT","text":"<p>\u57fa\u4e8e\u4e09\u5c42\u534f\u8bae</p>"},{"location":"other/internet/#dr","title":"DR","text":"<p>\u57fa\u4e8e\u4e8c\u5c42\u534f\u8bae</p> <p></p> <p>node1 192.168.0.107</p> <p>node2 192.168.0.108</p> <p>node3 192.168.0.109</p> <p>node4 192.168.0.110</p> <p>\u9690\u85cfIP 192.168.0.100</p> <p>\u5185\u6838\u914d\u7f6e</p> <pre><code>```\n#/proc/sys/net/ipv4/conf/eth0\n# arp_ignore   ARP \u67e5\u8be2\u54cd\u5e94\n   0 \u53ea\u8981\u672c\u673a\u6709\u6b64mac\u5730\u5740\u7684\u7f51\u5361\uff0c\u5c31\u7ed9\u4e88\u56de\u5e94\u3002\n   1 \u53ea\u6709\u8bf7\u6c42\u7684mac\u5730\u5740\u662f\u81ea\u5df1\u7684\u7f51\u5361\uff0c\u624d\u7ed9\u4e88\u56de\u5e94\u3002\n# arp_announce \u542f\u52a8\u901a\u544a\n   0 \u53d1\u73b0\u672c\u673a\u6709\u8bf7\u6c42\u7684mac\uff0c\u5c31\u4f1a\u54cd\u5e94\n   1 \u54cd\u5e94\u5339\u914d\u7684\u7684\u5730\u5740\n   2 \u53ea\u54cd\u5e94\u81ea\u5df1\u8bf7\u6c42\u7684mac\u5730\u5740\n```\n</code></pre> <p>\u914d\u7f6e</p> <pre><code>node2 ,node3\necho 1 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore\necho 2 &gt; /proc/sys/net/ipv4/conf/all/arp_announce\necho 1 &gt; /proc/sys/net/ipv4/conf/eth0/arp_ignore\necho 2 &gt; /proc/sys/net/ipv4/conf/eth0/arp_announce\n# node1 \nifconfig eth0:1 192.168.0.100/24\n# node2 \nifconfig lo:1 192.168.0.100 netmast 255.255.255.255\n# node3 \nifconfig lo:1 192.168.0.100 netmask 255.255.255.255\n\n#node1 ipvsadm\nyum install ipvsadm -y\n# \u5165\u5305\u89c4\u5219\nipvsadm -A -t 192.168.0.100:80 -s rr # \u51fa\u5305\u89c4\u5219\nipvsadm -a -t 192.168.0.100:80 -r 192.168.0.108 -g -w 1\nipvsadm -a -t 192.168.0.100:80 -r 192.168.0.109 -g -w 1\n#node1 keepalived\nyum install keepalived -y\n# \u914d\u7f6e\u5730\u5740/etc/keepalived/keepalived.conf\nvrrp_instance VI_1 {\nstate MASTER # BACKUP\ninterface eth0\n    virtual_router_id 51\npriority 100\nadvert_int 1\nauthentication {\nauth_type PASS\n        auth_pass 1111\n}\nvirtual_ipaddress {\n192.168.0.100/24 dev eth0 lable etho:1\n    }\n}\nvirtual_server 192.168.0.100 80 {\ndelay_loop 6\nlb_algo rr\n    lb_kind DR\n    persistence_timeout 50\nprotocol TCP\n\n    real_server 192.168.0.108 80 {\nweight 1\nHTTP_GET {\nurl {\npath /\n              status_code 200\n}\nconnect_timeout 3\nnb_get_retry 3\ndelay_before_retry 3\n}\n}\n\nreal_server 192.168.0.109 80 {\nweight 1\nHTTP_GET {\nurl {\npath /\n              status_code 200\n}\nconnect_timeout 3\nnb_get_retry 3\ndelay_before_retry 3\n}\n}\n}\n#\u670d\u52a1\u542f\u52a8\nservice keepalived start\n</code></pre>"},{"location":"other/internet/#tun","title":"TUN\u96a7\u9053","text":"<p><code>\u8de8\u7f51\u7edc \u7f51\u7edc\u7a7f\u900f</code></p>"},{"location":"other/ipv4/","title":"IPv4","text":"<p>IPv4\u5730\u5740\u4e00\u517132\u4f4d\uff0c\u56db\u4e2a\u5b57\u8282</p>"},{"location":"other/ipv4/#1-ip","title":"1. IP\u5730\u5740\u7684\u5206\u7c7b","text":"\u7c7b\u522b \u524d\u7f00 IP\u8303\u56f4 \u7f51\u7edc\u6570\u91cf \u4e3b\u673a\u6570\u91cf A 00000000 0.0.0.0-127.255.255.255 128(8\u4f4d\uff09 16,777,214(24\u4f4d) B 10000000 128.0.0.0-191.255.255.255 16,384(16\u4f4d) 65,534(16\u4f4d) C 11000000 192.0.0.0-223.255.255.255 2,097,152(24\u4f4d) 254(8\u4f4d) D 11100000 224.0.0.0-239.255.255.255 \u672a\u5b9a\u4e49 \u672a\u5b9a\u4e49 E 11110000 240.0.0.0-255.255.255.255 \u672a\u5b9a\u4e49 \u672a\u5b9a\u4e49"},{"location":"other/ipv4/#2","title":"2. \u5355\u64ad,\u5e7f\u64ad,\u7ec4\u64ad","text":"<ul> <li> <p>\u5355\u64ad\uff1a \u4e00\u5bf9\u4e00\u7684\u901a\u4fe1      </p> </li> <li> <p>\u5e7f\u64ad\uff1a \u4e00\u5bf9\u6240\u6709\u7684\u901a\u4fe1       </p> <p>eg: C\u7c7b 192.168.11.0 \u5b50\u7f51\u7edc\u91cc \u5e7f\u64ad\u5730\u5740\u662f192.168.11.255 </p> </li> <li> <p>\u7ec4\u64ad\uff1a \u4e00\u5bf9\u591a\u7684\u901a\u4fe1      </p> <p>D\u7c7b\u5730\u5740\u505a\u7ec4\u64ad\u7ec4\u7684\u7fa4\u540d\uff0c\u6240\u6709\u7684\u4e3b\u673a\u90fd\u52a0\u5165\u4e86\u540c\u4e00\u4e2aD\u7c7b\u5730\u5740, D\u7c7b\u5730\u5740\u662f\u865a\u62df\u7684\u5e76\u6ca1\u6709\u4e00\u4e2a\u4e3b\u673a\u662f\u8fd9\u4e2aIP\u5730\u5740</p> </li> </ul>"}]}